<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEET | Executive Access</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
    
    <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js"></script>

    <style>
        /* --- Executive Color Palette (Dark Mode First) --- */
        :root {
            --primary-bg: #0A1128; /* Deep Navy Blue */
            --secondary-bg: #1B263B; /* Darker Slate */
            --accent: #FFD700; /* Gold/Amber */
            --text-light: #E0E1E6;
            --text-muted: #9BB8D0;
            --error: #E53935;
            --success: #66BB6A;
            --border-color: #34495E;
            --radius: 8px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background: var(--primary-bg);
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* --- Container and Header --- */
        .container {
            width: 100%;
            max-width: 520px;
            background: var(--secondary-bg);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid var(--border-color);
        }
        .logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            font-weight: 800;
            color: var(--accent);
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        .logo-tagline {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 30px;
            display: block;
        }
        h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        p.subtitle {
            color: var(--text-muted);
            margin-bottom: 30px;
            font-size: 15px;
        }

        /* --- Buttons and Navigation --- */
        .btn-group {
            margin-bottom: 35px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .btn {
            padding: 14px 25px;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            border: none;
            font-family: inherit;
            font-size: 16px;
            width: 100%;
            transition: all 0.2s;
            position: relative;
            text-align: center;
        }
        .btn-primary {
            background: var(--accent);
            color: var(--primary-bg);
            font-weight: 700;
        }
        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        .btn-secondary {
            background: var(--border-color);
            color: var(--text-light);
        }
        .btn-secondary:hover {
            background: #4A6572;
        }
        .login-separator {
            border-top: 1px solid var(--border-color);
            padding-top: 25px;
            margin-top: 20px;
        }

        /* --- Forms --- */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: var(--text-light);
        }
        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
            background: var(--primary-bg);
            color: var(--text-light);
            font-family: inherit;
            font-size: 15px;
            transition: border-color 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent);
        }
        .name-fields {
            display: flex;
            gap: 10px;
        }
        .name-fields > div {
            flex: 1;
        }
        
        /* --- Toggle Switch --- */
        .toggle-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 14px;
        }
        .slider {
            background-color: var(--border-color);
        }
        .toggle-switch input:checked + .slider {
            background-color: var(--accent);
        }

        /* --- Messages --- */
        #messageContainer {
            min-height: 40px; /* Reserve space */
        }
        .message {
            padding: 12px;
            border-radius: var(--radius);
            font-size: 14px;
            text-align: left;
            margin-bottom: 15px;
        }
        .message.error {
            background: rgba(229, 57, 53, 0.2);
            color: var(--error);
            border: 1px solid var(--error);
        }
        .message.success {
            background: rgba(102, 187, 106, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        /* --- Spinner --- */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* --- Approval Wait Screen --- */
        .approval-wait-card {
            padding: 20px;
            text-align: center;
        }
        .wait-icon {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--accent);
        }
        .wait-quote {
            padding: 15px;
            background: var(--primary-bg);
            border-radius: var(--radius);
            color: var(--text-muted);
            font-style: italic;
            font-size: 14px;
            margin-top: 20px;
        }
        .wait-note {
            font-size: 12px; 
            color: var(--error); 
            margin-top: 20px;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div class="container" id="mainContainer">
        <div class="logo">MEET</div>
        <span class="logo-tagline">Secure Executive Access Portal</span>
        
        <div id="messageContainer"></div>
        
        <div id="loginSection">
            <h2>Organization Login</h2>
            <p class="subtitle">Access your organization portal using your custom credentials.</p>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="showSignup('CEO')">üöÄ Sign up as CEO (New Organization)</button>
                <button class="btn btn-secondary" onclick="showSignup('BOD')">üë• Sign up as Board Member</button>
                <button class="btn btn-secondary" onclick="showSignup('Employee')">üßë‚Äçüíª Sign up as Employee/Staff</button>
            </div>

            <div class="login-separator">
                <h3 style="margin-top: 0; font-size: 18px; color: var(--text-light);">Existing User Sign In</h3>
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail" class="form-label">Email Address</label>
                        <input type="email" id="loginEmail" class="form-input" required placeholder="name@company.com">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword" class="form-label">Custom Password</label>
                        <input type="password" id="loginPassword" class="form-input" required placeholder="********">
                    </div>
                    <button type="submit" id="loginBtn" class="btn btn-primary">
                        <span id="loginText">Secure Login</span>
                        <span id="loginSpinner" class="spinner" style="display: none;"></span>
                    </button>
                </form>
            </div>
        </div>

        <div id="ceoSignupSection" style="display: none;">
            <h2>CEO/Founder Registration</h2>
            <p class="subtitle">Establish your organization and set your immediate access credentials.</p>
            <form id="ceoSignupForm" onsubmit="handleCeoSignup(event)">
                <div class="form-group">
                    <label class="form-label">CEO Name</label>
                    <div class="name-fields">
                        <div>
                            <input type="text" id="ceoFirstName" class="form-input" required placeholder="First Name">
                        </div>
                        <div>
                            <input type="text" id="ceoSurname" class="form-input" required placeholder="Surname">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="orgName" class="form-label">Official Organization Name</label>
                    <input type="text" id="orgName" class="form-input" required placeholder="Acme Corp LLC">
                </div>
                <div class="form-group">
                    <label for="orgType" class="form-label">Type of Organization</label>
                    <select id="orgType" class="form-select" required>
                        <option value="">Select Type</option>
                        <option value="Commercial">Commercial (LLC/Ltd)</option>
                        <option value="Non-Profit">Non-Profit Organization (NGO)</option>
                        <option value="Government">Government/Public Sector</option>
                        <option value="Educational">Educational Institution</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="govID" class="form-label">Government Issued ID Upload (for verification)</label>
                    <div class="name-fields">
                        <select id="govIDType" class="form-select" style="flex: 0.5;" required>
                            <option value="">ID Type</option>
                            <option value="Passport">Passport</option>
                            <option value="Driver's License">Driver's License</option>
                            <option value="National ID">National ID Card</option>
                            <option value="Business Registration">Business Registration Doc</option>
                        </select>
                        <input type="file" id="govID" class="form-input" style="flex: 1.5; padding: 10px;" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="ceoEmail" class="form-label">Official CEO Email</label>
                    <input type="email" id="ceoEmail" class="form-input" required placeholder="ceo@acmecorp.com">
                </div>
                <div class="form-group">
                    <label for="ceoPassword" class="form-label">Create Password (Immediate Access)</label>
                    <input type="password" id="ceoPassword" class="form-input" required placeholder="Minimum 6 characters">
                </div>
                <div class="form-group">
                    <label for="orgTaxID" class="form-label">Tax ID / Registration Number</label>
                    <input type="text" id="orgTaxID" class="form-input" required placeholder="e.g., 123456789">
                </div>
                
                <label class="toggle-switch">
                    <span>Includes a Board of Directors/Executives?</span>
                    <input type="checkbox" id="hasBoardToggle">
                    <span class="slider"></span>
                </label>
                
                <button type="submit" id="ceoSignupBtn" class="btn btn-primary" style="margin-top: 20px;">
                    <span id="ceoSignupText">Establish Organization & Log In</span>
                    <span id="ceoSignupSpinner" class="spinner" style="display: none;"></span>
                </button>
                <button type="button" class="btn btn-secondary" onclick="showSection('login')">‚Üê Back to Main Access</button>
            </form>
        </div>

        <div id="memberSignupSection" style="display: none;">
            <h2 id="memberSignupTitle">Member Sign Up</h2>
            <p class="subtitle">Join your organization. Your access and password are subject to CEO approval.</p>
            <form id="memberSignupForm" onsubmit="handleMemberSignup(event)">
                <input type="hidden" id="memberRole">
                <div class="form-group">
                    <label class="form-label">Organization Name</label>
                    <input type="text" id="memberOrgName" class="form-input" required placeholder="Acme Corp LLC">
                    <small style="color:var(--text-muted)">Please enter the exact name of your organization.</small>
                </div>
                <div class="form-group">
                    <label for="memberName" class="form-label">Full Name</label>
                    <input type="text" id="memberName" class="form-input" required placeholder="Timi Jones">
                </div>
                <div class="form-group">
                    <label for="memberEmail" class="form-label">Official Email Address (Mandatory for Password)</label>
                    <input type="email" id="memberEmail" class="form-input" required placeholder="timi.jones@acmecorp.com">
                </div>
                <div class="form-group">
                    <label for="memberPhone" class="form-label">Phone Number (+Country Code)</label>
                    <input type="tel" id="memberPhone" class="form-input" required placeholder="+2348012345678">
                </div>
                <div class="form-group" id="memberPositionGroup">
                    <label for="memberPosition" class="form-label">Current Position/Title</label>
                    <input type="text" id="memberPosition" class="form-input" required placeholder="e.g., HR Director, Senior Analyst">
                </div>

                <button type="submit" id="memberSignupBtn" class="btn btn-primary" style="margin-top: 20px;">
                    <span id="memberSignupText">Submit Request for Approval</span>
                    <span id="memberSignupSpinner" class="spinner" style="display: none;"></span>
                </button>
                <button type="button" class="btn btn-secondary" onclick="showSection('login')">‚Üê Back to Main Access</button>
            </form>
        </div>

        <div id="approvalWaitSection" class="approval-wait-card" style="display: none;">
            <div class="wait-icon">üëë</div>
            <h2>Approval Pending</h2>
            <p class="subtitle">Your request has been securely submitted to your CEO/Admin.</p>
            <p>A **custom, secure password** will be sent to your official email (<span id="waitEmail" style="font-weight: 700; color: var(--accent);"></span>) once your membership is approved.</p>
            <p class="wait-quote">"Trust is the glue of life. It‚Äôs the most essential ingredient in effective communication. It‚Äôs the foundational principle that holds all relationships." - Stephen Covey</p>
            <p class="wait-note">**Do not attempt to log in until you receive your custom password.**</p>
            <button type="button" class="btn btn-primary" onclick="showSection('login')">Return to Login Screen</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword
        } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            getDoc, 
            query, 
            where, 
            getDocs, 
            addDoc,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

        // =======================================================
        // üõë IMPORTANT: REPLACE THESE PLACEHOLDERS WITH YOUR ACTUAL CONFIGURATION
        // =======================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDtqM_pMGIYkUgy0OWGsQbfS9MtYQhrgZM",
            authDomain: "meet-6e159.firebaseapp.com",
            projectId: "meet-6e159",
            storageBucket: "meet-6e159.firebasestorage.app",
            messagingSenderId: "252353608421",
            appId: "1:252353608421:web:6706056048e9a8f12db20c",
            measurementId: "G-9BFPPVMMRF",
            databaseURL: "https://meet-6e159-default-rtdb.firebaseio.com/"
        };
        const CLOUDINARY_UPLOAD_PRESET = "meet_org_id_preset"; 
        const CLOUDINARY_CLOUD_NAME = "your_cloud_name"; // REPLACE
        // =======================================================

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM elements
        const messageContainer = document.getElementById('messageContainer');

        // --- Utility Functions (Adopted and refined) ---

        function sanitizeInput(input) {
            // Simple sanitization for display/storage
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }

        function showMessage(message, type = 'error') {
            messageContainer.innerHTML = `<div class="message ${type}">${message}</div>`;
        }

        function clearMessage() { 
            messageContainer.innerHTML = ''; 
        }

        function setLoading(buttonId, isLoading) {
            const button = document.getElementById(buttonId);
            const text = button.querySelector('span:first-child');
            const spinner = button.querySelector('.spinner');
            
            if (!button || !text || !spinner) return;
            
            if (isLoading) { 
                button.disabled = true;
                text.style.display = 'none';
                spinner.style.display = 'inline-block';
            } else { 
                button.disabled = false;
