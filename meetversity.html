<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MEET ‚Äî Meetversity</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  /* --- CSS STYLES --- */
  :root{
    --primary:#0061FF;
    --accent:#5AE4A8;
    --bg:#f7f9fb;
    --card:#fff;
    --text:#111827;
    --muted:#6b7280;
    --radius:12px;
    --shadow: 0 6px 18px rgba(16,24,40,0.06);
    --edu-gradient: linear-gradient(135deg, #0061FF 0%, #5AE4A8 100%);
    --error: #EF4444;
    --success: #10B981;
  }
  body.dark {
    --bg:#081226;
    --card:#0b1726;
    --text:#e6eef8;
    --muted:#93a3bd;
    --shadow: 0 6px 18px rgba(0,0,0,0.6);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Arial;
    background:var(--bg);
    color:var(--text);
    height:100vh;
    display:flex;
    flex-direction:column;
    transition:background .35s,color .35s;
  }

  /* header */
  header{
    display:flex;
    align-items:center;
    gap:16px;
    padding:12px 20px;
    background:var(--card);
    box-shadow:var(--shadow);
    position:sticky;
    top:0;
    z-index:50;
  }
  .left { display:flex; align-items:center; gap:12px; }
  .logo-icon{
    width:44px;height:44px;border-radius:8px;
    background:linear-gradient(135deg,var(--primary),var(--accent));
    display:flex;align-items:center;justify-content:center;
    -webkit-mask:url('#m-mask');mask:url('#m-mask') center/contain no-repeat;
  }
  .brand { font-weight:700;font-size:18px;color:var(--primary); }
  .search {
    flex:1;display:flex;align-items:center;gap:10px;background:#eef3ff;border-radius:10px;padding:8px 12px;
    max-width:600px;
  }
  body.dark .search{background:#0f2134}
  .search input{border:0;background:transparent;outline:none;width:100%;color:var(--text)}
  .header-right{display:flex;align-items:center;gap:10px}

  /* layout */
  .layout{display:flex;flex:1;overflow:hidden}
  aside{
    width:240px;background:var(--card);padding:18px;border-right:1px solid rgba(0,0,0,0.03);
    display:flex;flex-direction:column;gap:8px;box-shadow:var(--shadow);
    transition: width 0.3s ease;
  }
  aside button{
    border:0;background:transparent;padding:12px 14px;border-radius:10px;text-align:left;font-weight:600;color:var(--muted);cursor:pointer;
    display: flex; align-items: center; gap: 12px; text-decoration: none; width: 100%; font-family: inherit; font-size: inherit;
  }
  aside button.active{color:var(--primary);background:linear-gradient(90deg, rgba(0,97,255,0.06), rgba(90,228,168,0.03));}
  main{flex:1;padding:20px;overflow:auto}

  /* Meetversity Styles */
  .meetversity-container { max-width: 1200px; margin: 0 auto; width: 100%; }
  .meetversity-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
  .meetversity-title {
    font-size: 28px; font-weight: 700; background: var(--edu-gradient);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0;
  }
  
  .create-btn {
    background: linear-gradient(90deg, var(--primary), var(--accent)); color: white; border: 0;
    padding: 12px 20px; border-radius: 10px; font-weight: 700; cursor: pointer;
    display: flex; align-items: center; gap: 8px; transition: transform 0.2s;
  }
  .create-btn:hover { transform: translateY(-2px); }

  /* Stats */
  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
  .stat-card { background: var(--card); border-radius: var(--radius); padding: 20px; text-align: center; box-shadow: var(--shadow); }
  .stat-value { font-size: 28px; font-weight: 700; margin-bottom: 5px; background: var(--edu-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .stat-label { font-size: 14px; color: var(--muted); }

  /* Content Types Cards (Top) */
  .content-types { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
  .content-type-card {
    background: var(--card); border-radius: var(--radius); padding: 25px; text-align: center;
    box-shadow: var(--shadow); transition: transform 0.3s; cursor: pointer; border: 2px solid transparent;
  }
  .content-type-card:hover { transform: translateY(-5px); border-color: var(--primary); }
  .content-icon { font-size: 40px; margin-bottom: 15px; display: block; }

  /* Grids */
  .courses-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 40px; }
  
  /* Course Card */
  .course-card { background: var(--card); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); transition: transform 0.3s; display:flex; flex-direction:column; }
  .course-card:hover { transform: translateY(-5px); }
  .course-thumbnail { width: 100%; height: 160px; object-fit: cover; background: #eee; }
  .course-details { padding: 15px; flex:1; display:flex; flex-direction:column; }
  .course-category { font-size: 12px; color: var(--primary); font-weight: 600; margin-bottom: 5px; text-transform: uppercase; }
  .course-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; line-height: 1.3; }
  .course-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
  .course-instructor { display: flex; align-items: center; gap: 8px; }
  .instructor-avatar { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; background:var(--primary); color:white; font-size:10px; display:flex; align-items:center; justify-content:center; }
  .course-stats-row { display:flex; gap:10px; font-size:13px; color:var(--muted); margin-bottom:10px; }
  
  .course-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top:10px; border-top:1px solid rgba(0,0,0,0.05); }
  .course-price { font-weight: 700; color: var(--primary); }
  .certificate-badge { background: rgba(90,228,168,0.1); color: #10b981; font-size: 11px; padding: 3px 8px; border-radius: 20px; font-weight: 600; }
  
  /* Action Buttons on Card */
  .card-actions { display:flex; gap:8px; margin-top:10px; }
  .join-btn { flex:1; background: var(--primary); color:white; border:none; padding:8px; border-radius:6px; font-weight:600; cursor:pointer; font-size:13px; }
  .join-btn.joined { background: var(--success); cursor: default; }
  .review-btn { background: transparent; border:1px solid var(--muted); color:var(--muted); padding:8px; border-radius:6px; cursor:pointer; font-size:13px; }
  .review-btn:hover { border-color:var(--primary); color:var(--primary); }

  /* Quick Videos Style */
  .quick-videos { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 40px; }
  .quick-video-card { background: var(--card); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); transition: transform 0.3s; cursor:pointer; }
  .quick-video-thumbnail { height: 120px; position: relative; }
  .play-icon-overlay { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:30px; color:white; text-shadow:0 2px 4px rgba(0,0,0,0.5); }

  /* Document Style */
  .documents-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
  .document-card { background: var(--card); border-radius: var(--radius); padding: 15px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 15px; cursor:pointer; }
  .document-icon { width: 50px; height: 50px; background: rgba(0,97,255,0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--primary); flex-shrink: 0; }

  /* Modal */
  .modal-wrap { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(2,6,23,0.8); z-index: 100; padding: 20px; }
  .modal { width: 100%; max-width: 800px; border-radius: 12px; background: var(--card); box-shadow: var(--shadow); max-height: 90vh; overflow-y: auto; }
  .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid rgba(0,0,0,0.1); }
  .modal-body { padding: 20px; }
  .content-type-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 15px; }
  .content-type-tab { background: transparent; border: 0; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; color: var(--muted); }
  .content-type-tab.active { background: rgba(0,97,255,0.1); color: var(--primary); }
  .form-group { margin-bottom: 20px; }
  .form-label { display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px; }
  .form-input, .form-textarea, .form-select { width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1); background: var(--bg); font-family: inherit; font-size: 14px; }
  
  /* File Upload */
  .file-upload { border: 2px dashed rgba(0,0,0,0.1); border-radius: 8px; padding: 30px; text-align: center; cursor: pointer; transition: border 0.2s; }
  .file-upload:hover { border-color: var(--primary); }
  .file-preview img { width: 100%; max-height: 200px; object-fit: cover; margin-top:10px; border-radius:8px; }

  .modal-footer { display: flex; justify-content: flex-end; gap: 15px; padding: 20px; border-top: 1px solid rgba(0,0,0,0.1); }
  .submit-btn { background: linear-gradient(90deg, var(--primary), var(--accent)); color: white; border: 0; padding: 12px 24px; border-radius: 8px; font-weight: 700; cursor: pointer; }

  .loading { text-align:center; padding:40px; color:var(--muted); font-style:italic; }

  @media (max-width:900px){ aside { width: 70px; } aside button span.menu-text { display:none; } }
  @media (max-width:768px){ .meetversity-header { flex-direction: column; align-items: flex-start; gap: 15px; } .content-types { grid-template-columns: 1fr; } .stats-grid { grid-template-columns: 1fr 1fr; } }
</style>
</head>
<body>

<svg style="position:absolute;width:0;height:0" aria-hidden>
  <defs><mask id="m-mask" viewBox="0 0 100 100"><path fill="white" d="M10 80 L10 20 L30 60 L50 20 L70 60 L90 20 L90 80 L70 40 L50 80 L30 40 Z"/></mask></defs>
</svg>

<header>
  <div class="left">
    <div class="logo-icon" title="MEET"></div>
    <div class="brand">MEET</div>
  </div>
  <div class="search">
    <span>üîç</span>
    <input id="search" placeholder="Search courses, videos, documents..." onkeyup="filterCourses()" />
  </div>
  <div class="header-right">
    <button id="darkToggle" title="Toggle dark mode" style="background:none;border:none;cursor:pointer;font-size:20px;">üåô</button>
    <div style="display:flex;align-items:center;gap:8px">
      <div id="userAvatarDisplay" style="width:36px;height:36px;border-radius:50%;background:var(--primary);color:white;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px;">U</div>
      <div style="font-weight:700;font-size:14px;" id="userNameDisplay">Guest</div>
    </div>
  </div>
</header>

<div class="layout">
  <aside>
    <button onclick="location.href='feed.html'">üè† <span class="menu-text">Feed</span></button>
    <button onclick="location.href='chat.html'">üí¨ <span class="menu-text">Chat</span></button>
    <button class="active" onclick="location.href='meetversity.html'">üéì <span class="menu-text">Meetversity</span></button>
    <button onclick="location.href='profile.html'">üë§ <span class="menu-text">Profile</span></button>
  </aside>

  <main>
    <div class="meetversity-container">
      <div class="meetversity-header">
        <h1 class="meetversity-title">MEETVERSITY</h1>
        <button class="create-btn" id="createContentBtn"><span>+</span> Create Course</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="statCourses">0</div>
          <div class="stat-label">Total Content</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statVideos">0</div>
          <div class="stat-label">Videos</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statDocs">0</div>
          <div class="stat-label">Documents</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statLearners">0</div>
          <div class="stat-label">Total Learners</div>
        </div>
      </div>

      <div class="section-header" style="display:flex;justify-content:space-between;margin-bottom:20px;">
        <h2 style="font-size:22px;font-weight:700;">Latest Courses</h2>
      </div>
      <div class="courses-grid" id="coursesGrid">
        <div class="loading">Loading courses from real-time database...</div>
      </div>

      <div class="section-header" style="display:flex;justify-content:space-between;margin-bottom:20px;margin-top:40px;">
        <h2 style="font-size:22px;font-weight:700;">Quick Videos</h2>
      </div>
      <div class="quick-videos" id="quickVideosGrid">
        <div class="loading">Loading videos...</div>
      </div>

      <div class="section-header" style="display:flex;justify-content:space-between;margin-bottom:20px;margin-top:40px;">
        <h2 style="font-size:22px;font-weight:700;">Documents & Resources</h2>
      </div>
      <div class="documents-grid" id="documentsGrid">
        <div class="loading">Loading documents...</div>
      </div>
    </div>
  </main>
</div>

<div class="modal-wrap" id="createContentModal">
  <div class="modal" role="dialog">
    <div class="modal-header">
      <h2 class="modal-title" style="font-size:22px;font-weight:700;">Create Educational Content</h2>
      <button id="closeCreateModal" style="background:none;border:0;font-size:24px;cursor:pointer;color:var(--muted);">‚úï</button>
    </div>
    
    <div class="modal-body">
      <div class="content-type-tabs">
        <button class="content-type-tab active" data-type="long-video">Long Video Course</button>
        <button class="content-type-tab" data-type="quick-video">Quick Video</button>
        <button class="content-type-tab" data-type="document">Document</button>
      </div>
      
      <form id="createContentForm">
        <div class="form-group">
          <label class="form-label">Content Title</label>
          <input type="text" class="form-input" id="cTitle" placeholder="e.g., Advanced React Patterns" required>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
            <div class="form-group">
              <label class="form-label">Category</label>
              <select class="form-select" id="cCategory">
                <option value="Technology">Technology</option>
                <option value="Design">Design</option>
                <option value="Business">Business</option>
                <option value="Marketing">Marketing</option>
                <option value="Science">Science</option>
                <option value="Arts">Arts</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Duration / Pages</label>
              <input type="text" class="form-input" id="cDuration" placeholder="e.g. 2h 30m or 15 pages" required>
            </div>
        </div>

        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-textarea" id="cDesc" placeholder="What will students learn?"></textarea>
        </div>

        <div class="form-group">
            <label class="form-label">Cover Image / Thumbnail</label>
            <div class="file-upload" id="thumbnailUploadTrigger">
                <span style="font-size:24px;">üñºÔ∏è</span>
                <p>Click to upload cover image</p>
            </div>
            <input type="file" id="cThumbnail" accept="image/*" style="display:none">
            <div class="file-preview" id="thumbPreview"></div>
        </div>

        <div class="form-group">
            <label class="form-label" id="mediaLabel">Video/Document File URL or Name</label>
            <input type="text" class="form-input" id="cMediaUrl" placeholder="Paste video link or filename (Simulated upload)">
        </div>
        
        <div class="form-group">
          <div style="display:flex;align-items:center;gap:10px;">
            <input type="checkbox" id="cCertificate">
            <label for="cCertificate" style="font-size:14px;font-weight:600;">Offer MEET Certificate upon completion</label>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="submit-btn" id="submitContent">üöÄ Publish Content</button>
    </div>
  </div>
</div>

<script type="module">
  // --- FIREBASE SETUP ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { 
      getFirestore, collection, addDoc, doc, updateDoc, arrayUnion, onSnapshot, query, orderBy, serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

  const firebaseConfig = {
      apiKey: "AIzaSyDtqM_pMGIYkUgy0OWGsQbfS9MtYQhrgZM",
      authDomain: "meet-6e159.firebaseapp.com",
      databaseURL: "https://meet-6e159-default-rtdb.firebaseio.com",
      projectId: "meet-6e159",
      storageBucket: "meet-6e159-firebasestorage.app",
      messagingSenderId: "252353608421",
      appId: "1:252353608421:web:6706056048e9a8f12db20c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let currentUser = null;
  let currentContentType = 'long-video';
  let thumbnailBase64 = null;
  let allCoursesData = []; // for client-side search

  // --- UI INITIALIZATION ---
  const modal = document.getElementById('createContentModal');
  const form = document.getElementById('createContentForm');
  
  // Dark Mode
  const darkToggle = document.getElementById('darkToggle');
  if(localStorage.getItem('meet_theme') === 'dark') document.body.classList.add('dark');
  darkToggle.addEventListener('click', ()=>{
    document.body.classList.toggle('dark');
    localStorage.setItem('meet_theme', document.body.classList.contains('dark') ? 'dark' : 'light');
  });

  // Modal Controls
  document.getElementById('createContentBtn').onclick = () => {
      if(!currentUser) { alert("Please login first"); return; }
      modal.style.display = 'flex';
  };
  document.getElementById('closeCreateModal').onclick = () => modal.style.display = 'none';
  
  // Tabs Logic
  document.querySelectorAll('.content-type-tab').forEach(tab => {
    tab.addEventListener('click', (e) => {
        document.querySelectorAll('.content-type-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        currentContentType = e.target.dataset.type;
        
        // Adjust label based on type
        const label = document.getElementById('mediaLabel');
        if(currentContentType === 'document') label.textContent = "Document URL (PDF/Link)";
        else label.textContent = "Video URL or File Name";
    });
  });

  // --- AUTH LOGIC ---
  onAuthStateChanged(auth, (user) => {
    if (user) {
        currentUser = user;
        const initial = user.displayName ? user.displayName.charAt(0).toUpperCase() : 'U';
        if(user.photoURL) {
             document.getElementById('userAvatarDisplay').innerHTML = `<img src="${user.photoURL}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
        } else {
             document.getElementById('userAvatarDisplay').innerText = initial;
        }
        document.getElementById('userNameDisplay').innerText = user.displayName || 'User';
    } else {
        // For demo purposes, we allow viewing but prompt for login on action
        document.getElementById('userNameDisplay').innerText = "Guest (Login required)";
        // In real app: window.location.href = 'login.html';
    }
  });

  // --- IMAGE COMPRESSION (Same as Meetrader) ---
  const compressImage = (file) => {
      return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (event) => {
              const img = new Image();
              img.onload = () => {
                  const canvas = document.createElement('canvas');
                  const MAX_WIDTH = 600; // Smaller for thumbnails
                  const scaleFactor = Math.min(MAX_WIDTH / img.width, 1);
                  canvas.width = img.width * scaleFactor;
                  canvas.height = img.height * scaleFactor;
                  const ctx = canvas.getContext('2d');
                  ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                  resolve(canvas.toDataURL('image/jpeg', 0.7)); 
              };
              img.src = event.target.result;
          };
          reader.readAsDataURL(file);
      });
  };

  document.getElementById('thumbnailUploadTrigger').onclick = () => document.getElementById('cThumbnail').click();
  document.getElementById('cThumbnail').onchange = async (e) => {
      const file = e.target.files[0];
      if(file) {
          thumbnailBase64 = await compressImage(file);
          document.getElementById('thumbPreview').innerHTML = `<img src="${thumbnailBase64}">`;
      }
  };

  // --- REAL-TIME DATA FETCHING ---
  const loadContent = () => {
      const q = query(collection(db, "meetversity_courses"), orderBy("createdAt", "desc"));
      
      onSnapshot(q, (snapshot) => {
          allCoursesData = [];
          let courses = [], videos = [], docs = [];
          let totalLearners = 0;

          snapshot.forEach(doc => {
              const data = { id: doc.id, ...doc.data() };
              allCoursesData.push(data);
              
              // Count learners
              const learnerCount = data.learners ? data.learners.length : 0;
              totalLearners += learnerCount;

              if(data.type === 'long-video') courses.push(data);
              else if(data.type === 'quick-video') videos.push(data);
              else if(data.type === 'document') docs.push(data);
          });

          // Update Stats
          document.getElementById('statCourses').innerText = allCoursesData.length;
          document.getElementById('statVideos').innerText = videos.length;
          document.getElementById('statDocs').innerText = docs.length;
          document.getElementById('statLearners').innerText = totalLearners;

          renderCourses(courses);
          renderQuickVideos(videos);
          renderDocuments(docs);
      });
  };

  // --- RENDERING FUNCTIONS ---
  function renderCourses(list) {
      const grid = document.getElementById('coursesGrid');
      grid.innerHTML = '';
      if(list.length === 0) { grid.innerHTML = '<div style="color:var(--muted)">No courses yet. Create one!</div>'; return; }

      list.forEach(item => {
          const learnerCount = item.learners ? item.learners.length : 0;
          const isJoined = currentUser && item.learners && item.learners.includes(currentUser.uid);
          const reviewCount = item.reviews ? item.reviews.length : 0;
          
          // Calc rating
          let avgRating = 0;
          if(reviewCount > 0) {
              const total = item.reviews.reduce((sum, r) => sum + parseInt(r.rating), 0);
              avgRating = (total / reviewCount).toFixed(1);
          }

          const el = document.createElement('div');
          el.className = 'course-card';
          el.innerHTML = `
            <img src="${item.thumbnail || 'https://via.placeholder.com/300x160?text=No+Image'}" class="course-thumbnail">
            <div class="course-details">
                <div class="course-category">${item.category}</div>
                <h3 class="course-title">${item.title}</h3>
                <div class="course-meta">
                    <div class="course-instructor">
                        <div class="instructor-avatar">${item.instructorName ? item.instructorName.charAt(0) : 'U'}</div>
                        <span style="font-size:13px;color:var(--muted)">${item.instructorName}</span>
                    </div>
                </div>
                <div class="course-stats-row">
                    <span>‚è±Ô∏è ${item.duration}</span>
                    <span>üë• ${learnerCount} Learners</span>
                    <span>‚≠ê ${avgRating > 0 ? avgRating : 'New'} (${reviewCount})</span>
                </div>
                <div class="course-footer">
                    ${item.hasCertificate ? '<span class="certificate-badge">üèÜ Certificate</span>' : '<span></span>'}
                </div>
                <div class="card-actions">
                    <button class="join-btn ${isJoined ? 'joined' : ''}" onclick="window.handleJoin('${item.id}')">
                        ${isJoined ? 'Joined ‚úì' : 'Join Course'}
                    </button>
                    <button class="review-btn" onclick="window.handleReview('${item.id}')">Review</button>
                </div>
            </div>
          `;
          grid.appendChild(el);
      });
  }

  function renderQuickVideos(list) {
      const grid = document.getElementById('quickVideosGrid');
      grid.innerHTML = '';
      list.forEach(item => {
          const el = document.createElement('div');
          el.className = 'quick-video-card';
          el.innerHTML = `
             <div class="quick-video-thumbnail">
                <img src="${item.thumbnail || 'https://via.placeholder.com/200x120'}" style="width:100%;height:100%;object-fit:cover">
                <div class="play-icon-overlay">‚ñ∂</div>
             </div>
             <div style="padding:10px;">
                <h4 style="margin:0;font-size:14px;line-height:1.3;margin-bottom:5px;">${item.title}</h4>
                <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--muted)">
                    <span>${item.duration}</span>
                    <span>${item.learners?.length || 0} views</span>
                </div>
             </div>
          `;
          // Quick videos automatically "Join/View" on click in a real app
          el.onclick = () => window.handleJoin(item.id); 
          grid.appendChild(el);
      });
  }

  function renderDocuments(list) {
      const grid = document.getElementById('documentsGrid');
      grid.innerHTML = '';
      list.forEach(item => {
          const el = document.createElement('div');
          el.className = 'document-card';
          el.innerHTML = `
             <div class="document-icon">üìÑ</div>
             <div style="flex:1">
                <h4 style="margin:0 0 5px 0;font-size:15px;">${item.title}</h4>
                <div style="font-size:12px;color:var(--muted);display:flex;gap:10px;">
                    <span>${item.category}</span>
                    <span>${item.duration}</span> <span>‚¨á ${item.learners?.length || 0}</span>
                </div>
             </div>
             <button style="background:transparent;border:1px solid var(--primary);color:var(--primary);border-radius:4px;cursor:pointer;">Get</button>
          `;
          el.onclick = () => window.handleJoin(item.id);
          grid.appendChild(el);
      });
  }

  // --- ACTIONS (JOIN & REVIEW) ---
  window.handleJoin = async (docId) => {
      if(!currentUser) { alert("Please login to join/view courses."); return; }
      try {
          const docRef = doc(db, "meetversity_courses", docId);
          await updateDoc(docRef, {
              learners: arrayUnion(currentUser.uid)
          });
          // No alert needed, UI updates automatically via snapshot
      } catch(e) { console.error(e); }
  };

  window.handleReview = async (docId) => {
      if(!currentUser) { alert("Please login."); return; }
      const rating = prompt("Rate this course (1-5 stars):", "5");
      const text = prompt("Write a short review:", "");
      
      if(rating && text) {
          try {
              const reviewObj = {
                  uid: currentUser.uid,
                  user: currentUser.displayName || 'User',
                  rating: parseInt(rating),
                  text: text,
                  date: new Date().toISOString()
              };
              const docRef = doc(db, "meetversity_courses", docId);
              await updateDoc(docRef, {
                  reviews: arrayUnion(reviewObj)
              });
              alert("Review submitted!");
          } catch(e) { console.error(e); alert("Error submitting review"); }
      }
  };

  // --- SUBMIT NEW CONTENT ---
  document.getElementById('submitContent').addEventListener('click', async () => {
      if(!currentUser) { alert("Please login."); return; }
      
      const title = document.getElementById('cTitle').value;
      const category = document.getElementById('cCategory').value;
      const duration = document.getElementById('cDuration').value;
      const desc = document.getElementById('cDesc').value;
      const hasCert = document.getElementById('cCertificate').checked;
      const mediaUrl = document.getElementById('cMediaUrl').value;

      if(!title || !duration) { alert("Please fill required fields"); return; }

      const btn = document.getElementById('submitContent');
      btn.innerText = "Publishing..."; btn.disabled = true;

      try {
          await addDoc(collection(db, "meetversity_courses"), {
              type: currentContentType,
              title,
              category,
              duration,
              description: desc,
              hasCertificate: hasCert,
              mediaUrl: mediaUrl,
              thumbnail: thumbnailBase64, // Might be null
              instructorId: currentUser.uid,
              instructorName: currentUser.displayName || "Instructor",
              learners: [],
              reviews: [],
              createdAt: serverTimestamp()
          });
          
          alert("Course Created Successfully!");
          modal.style.display = 'none';
          form.reset();
          document.getElementById('thumbPreview').innerHTML = '';
          thumbnailBase64 = null;
      } catch(e) {
          console.error("Error adding doc: ", e);
          alert("Failed to create course. (Note: Image might be too large for this demo setup)");
      } finally {
          btn.innerText = "üöÄ Publish Content"; btn.disabled = false;
      }
  });
  
  // --- SEARCH ---
  window.filterCourses = () => {
      const term = document.getElementById('search').value.toLowerCase();
      // Filter locally for speed, real app might query db
      const filtered = allCoursesData.filter(c => c.title.toLowerCase().includes(term) || c.category.toLowerCase().includes(term));
      
      // Re-sort into buckets
      let c=[], v=[], d=[];
      filtered.forEach(data => {
          if(data.type === 'long-video') c.push(data);
          else if(data.type === 'quick-video') v.push(data);
          else if(data.type === 'document') d.push(data);
      });
      renderCourses(c);
      renderQuickVideos(v);
      renderDocuments(d);
  };

  // Start
  loadContent();

</script>
</body>
</html>
