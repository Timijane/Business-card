<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MEET | Meetversity</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  /* --- BASE STYLES FROM FEED.HTML (DO NOT CHANGE) --- */
  :root {
    --primary: #0080FF;
    --primary-dark: #0066CC;
    --error: #EF4444;
    --success: #10B981;
    --warning: #F59E0B;
    --bg-color: #f0f2f5;
    --card-bg: #fff;
    --text-color: #111;
    --secondary-text: #65676b;
    --border-color: #dddfe2;
    --online: #10B981;
    --offline: #EF4444;
  }

  body.dark-mode {
    --bg-color: #18191a;
    --card-bg: #242526;
    --text-color: #e4e6eb;
    --secondary-text: #b0b3b8;
    --border-color: #3e4042;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; overflow-x: hidden; font-size: 18px; }
  body { font-family: 'Poppins', sans-serif; background: var(--bg-color); color: var(--text-color); transition: all 0.3s ease; min-height: 100vh; }
  
  .app-container { display: flex; min-height: 100vh; position: relative; }

  /* --- SIDEBAR (MATCHING FEED) --- */
  .sidebar {
    position: fixed; left: 0; top: 0; height: 100vh; width: 180px;
    background: linear-gradient(180deg, #0080FF 0%, #00C6FF 100%);
    border-right: 1px solid var(--border-color); overflow-y: auto; z-index: 100; padding: 15px; color: white;
  }
  .sidebar-header { padding: 5px 0 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.2); margin-bottom: 15px; }
  .sidebar-menu { list-style: none; }
  .sidebar-menu li { margin-bottom: 6px; }
  .sidebar-menu a {
    display: flex; align-items: center; padding: 10px; text-decoration: none; color: white;
    border-radius: 8px; transition: background 0.3s; min-height: 40px; font-size: 16px;
  }
  .sidebar-menu a:hover { background: rgba(255, 255, 255, 0.2); }
  .sidebar-menu i { margin-right: 10px; font-size: 18px; width: 22px; text-align: center; }

  /* Icons Colors */
  .sidebar-menu a[href="feed.html"] i { color: #fff; }
  .sidebar-menu a[onclick*="viewProfile"] i { color: #f4d03f; }
  .sidebar-menu a[href="chat.html"] i { color: #4CAF50; }
  .sidebar-menu a[href="meetrader.html"] i { color: #FF5722; }
  .sidebar-menu a[href="meetversity.html"] i { color: #9C27B0; }
  .sidebar-menu a[href="organization.html"] i { color: #00BCD4; }
  .sidebar-menu a[onclick*="openUsersModal"] i { color: #e91e63; }

  .main-content { flex: 1; margin-left: 180px; padding: 15px; min-height: 100vh; font-size: 18px; }

  /* --- NAVBAR (MATCHING FEED) --- */
  .navbar {
    background: linear-gradient(135deg, #0080FF 0%, #00C6FF 100%);
    padding: 10px 15px; border-radius: 10px; margin-bottom: 15px;
    display: flex; justify-content: space-between; align-items: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1); color: white; flex-wrap: wrap; gap: 8px;
  }
  .nav-controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .search-bar {
    display: flex; align-items: center; background: rgba(255, 255, 255, 0.2);
    border-radius: 20px; padding: 6px 12px; margin-right: 10px;
  }
  .search-bar input { background: transparent; border: none; color: white; outline: none; width: 180px; font-size: 16px; }
  .search-bar input::placeholder { color: rgba(255, 255, 255, 0.7); }
  
  .user-profile-nav {
    display: flex; align-items: center; gap: 8px; padding: 4px 8px;
    border-radius: 20px; background: rgba(255, 255, 255, 0.2);
    cursor: pointer; position: relative; min-height: 36px;
  }
  .user-avatar {
    width: 36px; height: 36px; border-radius: 50%; background: var(--primary);
    color: white; display: flex; align-items: center; justify-content: center;
    font-weight: bold; cursor: pointer; position: relative; min-width: 36px; font-size: 16px; overflow: hidden;
  }
  .user-avatar.small { width: 28px; height: 28px; font-size: 14px; min-width: 28px; }
  .user-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }

  .btn {
    background: rgba(255, 255, 255, 0.2); color: white; border: none;
    padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 600;
    transition: background 0.3s; display: flex; align-items: center; gap: 6px;
    font-size: 16px; min-height: 36px;
  }
  .btn i { font-size: 18px; }
  #notificationsBtn i { color: #FFC107; }
  #nightToggleBtn i { color: #9C27B0; }
  #logoutBtn i { color: #EF4444; }
  .btn:hover { background: rgba(255, 255, 255, 0.3); }
  
  .unread-badge {
    background: var(--error); color: white; border-radius: 50%;
    padding: 2px 5px; font-size: 10px; display: none;
    min-width: 16px; justify-content: center; align-items: center;
  }

  /* --- MEETVERSITY SPECIFIC STYLES --- */
  
  /* Filter Section */
  .filters-container {
    background: var(--card-bg); padding: 15px; border-radius: 10px; margin-bottom: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1); display: flex; flex-wrap: wrap; gap: 15px; align-items: center;
  }
  .filter-group { display: flex; flex-direction: column; gap: 5px; flex: 1; min-width: 150px; }
  .filter-label { font-size: 14px; color: var(--secondary-text); font-weight: 600; }
  .filter-select, .filter-input {
    padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-color);
    background: var(--bg-color); color: var(--text-color); outline: none; font-size: 15px;
  }
  .filter-btn {
    background: var(--primary); color: white; border: none; padding: 10px 20px;
    border-radius: 8px; cursor: pointer; font-weight: 600; height: 40px; align-self: flex-end;
  }

  /* Course Grid */
  .courses-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }

  /* Course Card */
  .course-card {
    background: var(--card-bg); border-radius: 10px; overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.3s;
    display: flex; flex-direction: column; position: relative;
  }
  .course-card:hover { transform: translateY(-5px); }

  /* Instagram-like Carousel */
  .ad-carousel { position: relative; width: 100%; height: 250px; background: #000; overflow: hidden; }
  .ad-images-container { display: flex; width: 100%; height: 100%; transition: transform 0.3s ease-in-out; }
  .ad-img { min-width: 100%; width: 100%; height: 100%; object-fit: cover; }

  /* Counter Badge (1/3) */
  .ad-counter {
    position: absolute; top: 10px; right: 10px;
    background: rgba(0, 0, 0, 0.6); color: white;
    padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; z-index: 10;
  }

  /* Navigation Arrows */
  .ad-nav-btn {
    position: absolute; top: 50%; transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.8); color: #333; border: none;
    width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
    display: flex; align-items: center; justify-content: center; z-index: 10;
    opacity: 0.7; transition: opacity 0.2s;
  }
  .ad-nav-btn:hover { opacity: 1; background: white; }
  .ad-prev { left: 10px; }
  .ad-next { right: 10px; }

  /* Course Details */
  .course-details { padding: 15px; flex: 1; display: flex; flex-direction: column; }
  .course-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
  .course-title { font-weight: 700; font-size: 18px; color: var(--text-color); }
  .course-price { color: var(--success); font-weight: 700; font-size: 18px; }
  .course-instructor { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; font-size: 14px; color: var(--secondary-text); }
  .instructor-avatar { width: 24px; height: 24px; border-radius: 50%; background: #ccc; display: flex; align-items: center; justify-content: center; font-size: 12px; color: white; overflow: hidden; }
  .instructor-avatar img { width: 100%; height: 100%; object-fit: cover; }
  .course-desc { font-size: 14px; color: var(--secondary-text); margin-bottom: 15px; flex: 1; line-height: 1.4; }
  
  /* Rating Display */
  .course-rating { display: flex; align-items: center; gap: 5px; margin-bottom: 10px; font-size: 13px; color: gold; }
  .course-rating span { color: var(--secondary-text); font-weight: 600; }
  
  .course-actions { display: flex; gap: 10px; margin-top: auto; }
  .action-btn-course {
    flex: 1; padding: 8px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer;
    font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 6px;
  }
  .btn-msg { background: var(--bg-color); color: var(--text-color); border: 1px solid var(--border-color); }
  .btn-enroll { background: var(--primary); color: white; }

  /* Post Button */
  .post-course-btn {
    background: var(--primary); color: white; border: none; padding: 10px 20px;
    border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;
  }

  /* Loading & Modals */
  .loading { text-align: center; padding: 20px; color: var(--secondary-text); width: 100%; }
  .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 15px; }
  .modal-content { background: var(--card-bg); border-radius: 10px; width: 600px; max-width: 90%; max-height: 85vh; overflow-y: auto; display: flex; flex-direction: column; }
  .modal-header { padding: 14px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: var(--card-bg); z-index: 10; }
  .modal-body { padding: 14px; }
  .close-modal { background: none; border: none; font-size: 22px; cursor: pointer; color: var(--secondary-text); }

  /* Forms */
  .form-group { margin-bottom: 15px; }
  .form-label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; }
  .form-input, .form-select, .form-textarea {
    width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);
    background: var(--bg-color); color: var(--text-color); outline: none; font-size: 15px;
  }
  .form-textarea { resize: vertical; min-height: 80px; }
  
  /* Radio Group */
  .radio-group { display: flex; flex-direction: column; gap: 10px; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-color); }
  .radio-item { display: flex; align-items: center; gap: 10px; }
  .radio-item input[type="radio"] { accent-color: var(--primary); transform: scale(1.2); }
  
  /* Image Upload Grid */
  .image-upload-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-top: 5px; }
  .image-upload-box {
    height: 80px; border: 2px dashed var(--border-color); border-radius: 6px;
    display: flex; align-items: center; justify-content: center; cursor: pointer;
    position: relative; overflow: hidden;
  }
  .image-upload-box img { width: 100%; height: 100%; object-fit: cover; }
  .remove-img { position: absolute; top: 0; right: 0; background: rgba(0,0,0,0.5); color: white; padding: 2px 5px; font-size: 10px; cursor: pointer; }

  /* Details Modal Specifics */
  .detail-gallery { height: 300px; background: #000; display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 15px; border-radius: 8px; overflow: hidden; }
  .detail-img { max-width: 100%; max-height: 100%; object-fit: contain; }
  .nav-btn { position: absolute; background: rgba(255,255,255,0.3); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 50%; margin: 0 10px; }
  .nav-btn:hover { background: rgba(255,255,255,0.6); }
  
  .detail-info h2 { margin-bottom: 5px; font-size: 22px; }
  .detail-price { font-size: 20px; color: var(--primary); font-weight: 700; margin-bottom: 15px; }
  .detail-row { display: flex; justify-content: space-between; border-bottom: 1px solid var(--border-color); padding: 10px 0; font-size: 14px; }
  
  /* Reviews */
  .reviews-section { margin-top: 20px; border-top: 2px solid var(--border-color); padding-top: 15px; }
  .review-item { background: var(--bg-color); padding: 10px; border-radius: 8px; margin-bottom: 10px; }
  .review-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 13px; color: var(--secondary-text); }
  .delete-review { color: var(--error); cursor: pointer; font-size: 12px; }

  /* Notification Items */
  .notif-item { padding: 10px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; font-size: 16px; }
  .notif-unread { background: #f0f9ff; }
  .notif-actions { display: flex; gap: 8px; }
  .notif-btn { cursor: pointer; color: var(--secondary-text); font-size: 13px; }
  
  /* Users List */
  .user-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; background: var(--card-bg); border-radius: 6px; border: 1px solid var(--border-color); margin-bottom: 8px; }
  .association-btn { padding: 5px 10px; border-radius: 5px; border: none; cursor: pointer; font-size: 13px; font-weight: 600; }
  .associate-btn { background: var(--primary); color: white; }
  .disassociate-btn { background: var(--error); color: white; }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar { width: 60px; padding: 8px 4px; }
    .sidebar-header { display: none; }
    .sidebar-menu a { flex-direction: column; padding: 8px 4px; font-size: 12px; text-align: center; }
    .sidebar-menu i { margin-right: 0; margin-bottom: 4px; font-size: 18px; }
    .main-content { margin-left: 60px; padding: 8px; width: calc(100% - 60px); }
    .navbar { flex-direction: column; align-items: flex-start; gap: 10px; }
    .search-bar, .user-profile-nav span, .btn span { display: none; }
    .nav-controls { width: 100%; justify-content: space-between; }
    .btn { padding: 6px; flex: 1; justify-content: center; }
    .filters-container { flex-direction: column; align-items: stretch; }
    .filter-btn { width: 100%; }
    .courses-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .ad-carousel { height: 150px; }
  }
</style>
</head>
<body>

<div class="app-container">
  <div class="sidebar">
    <div class="sidebar-header">
      <h2 style="color: white; font-size: 20px;">MEET</h2>
    </div>
    <ul class="sidebar-menu">
      <li><a href="feed.html"><i class="fas fa-home"></i> <span>Feed</span></a></li>
      <li><a href="#" onclick="viewProfile(auth.currentUser.uid)"><i class="fas fa-user"></i> <span>Profile</span></a></li>
      <li><a href="chat.html"><i class="fas fa-comment"></i> <span>Chat</span></a></li>
      <li><a href="meetrader.html"><i class="fas fa-chart-line"></i> <span>Meetrader</span></a></li>
      <li><a href="meetversity.html"><i class="fas fa-graduation-cap"></i> <span>Meetversity</span></a></li>
      <li><a href="organization.html"><i class="fas fa-sitemap"></i> <span>Organization</span></a></li>
      <li><a href="#" onclick="openUsersModal()"><i class="fas fa-users"></i> <span>Find Associates</span></a></li>
    </ul>
  </div>

  <div class="main-content">
    <div class="navbar">
      <h2 style="color: white; font-size: 20px;">Meetversity</h2>
      <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 8px;">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search courses...">
        </div>
        <div class="nav-controls">
          <div class="user-profile-nav" onclick="viewProfile(auth.currentUser.uid)">
            <div class="user-avatar small" id="currentUserAvatar">U</div>
            <span id="userName" style="font-size: 15px;">User</span>
          </div>
          <button class="btn" id="notificationsBtn" onclick="openNotificationsModal()">
            <i class="fas fa-bell"></i> <span style="font-size: 15px;">Notifications</span>
            <span class="unread-badge" id="unreadBadge"></span>
          </button>
          <button class="btn" id="nightToggleBtn">
            <i class="fas fa-moon"></i> <span style="font-size: 15px;">Night Mode</span>
          </button>
          <button class="btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> <span style="font-size: 15px;">Logout</span>
          </button>
        </div>
      </div>
    </div>

    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h1 style="margin:0; font-size:24px;">Learning Marketplace</h1>
        <button class="post-course-btn" onclick="openPostModal()"><i class="fas fa-plus"></i> Post Course</button>
    </div>

    <div class="filters-container">
      <div class="filter-group">
        <label class="filter-label">Keywords</label>
        <input type="text" class="filter-input" id="filterKeywords" placeholder="e.g. Programming, Design...">
      </div>
      <div class="filter-group">
        <label class="filter-label">Category</label>
        <select class="filter-select" id="filterCategory">
          <option value="all">All Categories</option>
          <option value="Technology">Technology</option>
          <option value="Business">Business</option>
          <option value="Design">Design</option>
          <option value="Marketing">Marketing</option>
          <option value="Personal Development">Personal Development</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Max Price</label>
        <input type="number" class="filter-input" id="filterPrice" placeholder="Any price">
      </div>
      <button class="filter-btn" onclick="applyFilters()">Filter Results</button>
    </div>

    <div class="courses-grid" id="coursesContainer">
      <div class="loading">Loading courses...</div>
    </div>
  </div>
</div>

<div class="modal" id="postModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Post New Course</h3>
      <button class="close-modal" onclick="closePostModal()">&times;</button>
    </div>
    <div class="modal-body">
      <form id="postForm">
        <div class="form-group">
            <label class="form-label">Course Title</label>
            <input type="text" id="pTitle" class="form-input" required>
        </div>

        <div style="display:flex; gap:10px;">
            <div class="form-group" style="flex:1">
                <label class="form-label">Currency</label>
                <select id="pCurrency" class="form-select">
                    <option value="NGN">₦ NGN - Nigerian Naira</option>
                    <option value="USD">$ USD - US Dollar</option>
                    <option value="EUR">€ EUR - Euro</option>
                    <option value="GBP">£ GBP - British Pound</option>
                    <option value="JPY">¥ JPY - Japanese Yen</option>
                    <option value="CAD">$ CAD - Canadian Dollar</option>
                    <option value="AUD">$ AUD - Australian Dollar</option>
                </select>
            </div>
            <div class="form-group" style="flex:1">
                <label class="form-label">Price</label>
                <input type="number" id="pPrice" class="form-input" required>
            </div>
        </div>

        <div style="display:flex; gap:10px;">
             <div class="form-group" style="flex:1">
                <label class="form-label">Duration (weeks)</label>
                <input type="number" id="pDuration" class="form-input" required>
            </div>
            <div class="form-group" style="flex:1">
                <label class="form-label">Level</label>
                <select id="pLevel" class="form-select">
                    <option value="Beginner">Beginner</option>
                    <option value="Intermediate">Intermediate</option>
                    <option value="Advanced">Advanced</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Category</label>
            <select id="pCategory" class="form-select">
                <option value="Technology">Technology</option>
                <option value="Business">Business</option>
                <option value="Design">Design</option>
                <option value="Marketing">Marketing</option>
                <option value="Personal Development">Personal Development</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label">Course Description</label>
            <textarea id="pDesc" class="form-textarea" placeholder="Describe the course content, learning outcomes, and requirements..." required></textarea>
        </div>

        <div style="display:flex; gap:10px;">
            <div class="form-group" style="flex:1">
                <label class="form-label">Instructor Phone</label>
                <input type="tel" id="pPhone" class="form-input" required>
            </div>
            <div class="form-group" style="flex:1">
                <label class="form-label">Email</label>
                <input type="email" id="pEmail" class="form-input" required>
            </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Location/Delivery Method</label>
          <input type="text" class="form-input" id="pLocation" placeholder="Online, Physical location, or Hybrid" required>
        </div>
        
        <div class="form-group">
            <label class="form-label">Payment Method</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" name="pPayment" value="Meetpay" checked id="pay1">
                    <label for="pay1">Pay via Meetpay</label>
                </div>
                <div class="radio-item">
                    <input type="radio" name="pPayment" value="Pay Before Start" id="pay3">
                    <label for="pay3">Pay Before Course Start</label>
                </div>
                <div class="radio-item">
                    <input type="radio" name="pPayment" value="Installments" id="pay2">
                    <label for="pay2">Installments</label>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Course Format</label>
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" name="pFormat" value="Self-paced" checked id="fmt1">
                    <label for="fmt1">Self-paced</label>
                </div>
                <div class="radio-item">
                    <input type="radio" name="pFormat" value="Live Online" id="fmt2">
                    <label for="fmt2">Live Online</label>
                </div>
                <div class="radio-item">
                    <input type="radio" name="pFormat" value="In-person" id="fmt3">
                    <label for="fmt3">In-person</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Course Images (Max 5)</label>
            <div class="image-upload-grid" id="uploadGrid">
                <div class="image-upload-box" onclick="document.getElementById('pImages').click()">
                    <i class="fas fa-camera" style="font-size:24px; color:var(--secondary-text);"></i>
                </div>
            </div>
            <input type="file" id="pImages" accept="image/*" multiple style="display:none">
        </div>
        
        <button type="submit" class="post-course-btn" style="width:100%; justify-content:center;">Post Course</button>
      </form>
    </div>
  </div>
</div>

<div class="modal" id="detailModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Course Details</h3>
            <button class="close-modal" onclick="closeDetailModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="detail-gallery">
                <button class="nav-btn" style="left:0" onclick="swapDetailImage(-1)"><i class="fas fa-chevron-left"></i></button>
                <img id="dMainImg" class="detail-img" src="">
                <button class="nav-btn" style="right:0" onclick="swapDetailImage(1)"><i class="fas fa-chevron-right"></i></button>
            </div>
            
            <div class="detail-info">
                <h2 id="dTitle">Course Title</h2>
                <div class="detail-price" id="dPrice"></div>
                
                <div class="detail-row">
                    <span>Instructor:</span> <span id="dInstructor"></span>
                </div>
                 <div class="detail-row">
                    <span>Contact:</span> <span id="dContact"></span>
                </div>
                 <div class="detail-row">
                    <span>Email:</span> <span id="dEmail"></span>
                </div>
                <div class="detail-row">
                    <span>Level:</span> <span id="dLevel"></span>
                </div>
                 <div class="detail-row">
                    <span>Duration:</span> <span id="dDuration"></span>
                </div>
                <div class="detail-row">
                    <span>Format:</span> <span id="dFormat"></span>
                </div>
                <div class="detail-row">
                    <span>Payment:</span> <span id="dPayment"></span>
                </div>
                <div class="detail-row">
                    <span>Location/Delivery:</span> <span id="dLocation"></span>
                </div>
                <div style="margin-top:15px;">
                    <strong>Course Description:</strong>
                    <p id="dDesc" style="margin-top:5px; color:var(--secondary-text);"></p>
                </div>
            </div>

            <div class="reviews-section">
                <h4>Reviews & Ratings</h4>
                <div style="display:flex; gap:10px; margin-bottom:10px;">
                    <select id="newRating" class="form-select" style="width:100px;">
                        <option value="5">5 ★★★★★</option>
                        <option value="4">4 ★★★★</option>
                        <option value="3">3 ★★★</option>
                        <option value="2">2 ★★</option>
                        <option value="1">1 ★</option>
                    </select>
                    <input type="text" id="newReviewText" class="form-input" placeholder="Write a review...">
                    <button class="btn" style="background:var(--primary);" onclick="submitReview()">Post</button>
                </div>
                <div id="reviewsList"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="notificationsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 style="font-size: 18px;">Notifications</h3>
      <button class="close-modal" id="closeNotificationsModal">&times;</button>
    </div>
    <div class="modal-body">
      <div id="notificationsList"></div>
    </div>
  </div>
</div>

<div class="modal" id="usersModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 style="font-size: 18px;">Find Associates</h3>
      <button class="close-modal" id="closeUsersModal">&times;</button>
    </div>
    <div class="modal-body">
      <div id="usersList"><div class="loading">Loading users...</div></div>
    </div>
  </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { 
        getFirestore, collection, addDoc, deleteDoc, doc, getDoc, getDocs, 
        onSnapshot, query, where, orderBy, updateDoc, setDoc, arrayUnion, arrayRemove, serverTimestamp 
    } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDtqM_pMGIYkUgy0OWGsQbfS9MtYQhrgZM",
        authDomain: "meet-6e159.firebaseapp.com",
        databaseURL: "https://meet-6e159-default-rtdb.firebaseio.com",
        projectId: "meet-6e159",
        storageBucket: "meet-6e159-firebasestorage.app",
        messagingSenderId: "252353608421",
        appId: "1:252353608421:web:6706056048e9a8f12db20c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = null;
    let uploadedImages = [];
    let allCourses = []; // For filtering
    let currentCourse = null; // For details view
    let currentDetailImgIdx = 0; // For details view gallery

    // Cloudinary configuration
    const cloudinaryConfig = {
        cloudName: 'your-cloud-name', // Replace with your Cloudinary cloud name
        uploadPreset: 'meetversity_preset' // Replace with your upload preset
    };

    // --- HELPER FUNCTIONS ---
    function getAvatarHTML(photoURL, name, size = 'medium') {
        const initial = name ? name.charAt(0).toUpperCase() : 'U';
        const style = size === 'small' ? 'width:28px;height:28px;font-size:14px; min-width: 28px;' : 'width:36px;height:36px;font-size:16px; min-width: 36px;';
        if (photoURL) return `<img src="${photoURL}" alt="${name}" style="${style} border-radius:50%; object-fit:cover;">`;
        return `<div style="${style} background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">${initial}</div>`;
    }

    function calculateAverageRating(reviews) {
        if (!reviews || reviews.length === 0) return { avg: 0, count: 0 };
        const total = reviews.reduce((sum, r) => sum + r.rating, 0);
        return { avg: total / reviews.length, count: reviews.length };
    }

    window.viewProfile = (targetId) => { if(targetId) window.location.href = `profile.html?uid=${targetId}`; };

    // --- AUTH & INIT ---
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            currentUser = user;
            const userDoc = await getDoc(doc(db, "users", user.uid));
            const userData = userDoc.exists() ? userDoc.data() : {};
            
            // Update currentUser displayName/photoURL with data from Firestore
            currentUser.displayName = userData.displayName || user.displayName;
            currentUser.photoURL = userData.photoURL || user.photoURL;

            document.getElementById('currentUserAvatar').innerHTML = getAvatarHTML(currentUser.photoURL, currentUser.displayName || 'User', 'small');
            document.getElementById('userName').textContent = currentUser.displayName || 'User';
            
            setupNotificationsCount();
            loadCourses();
        } else {
            window.location.href = 'login.html';
        }
    });

    // --- LOAD COURSES & FILTERING ---
    function loadCourses() {
        // Listen to real-time updates for Meetversity courses
        const q = query(collection(db, "meetversity"), orderBy("createdAt", "desc"));
        onSnapshot(q, (snap) => {
            allCourses = [];
            snap.forEach(doc => allCourses.push({ id: doc.id, ...doc.data() }));
            renderCourses(allCourses);
        });
    }

    window.applyFilters = () => {
        const keyword = document.getElementById('filterKeywords').value.toLowerCase();
        const category = document.getElementById('filterCategory').value;
        const maxPrice = document.getElementById('filterPrice').value;

        const filtered = allCourses.filter(course => {
            const matchesKeyword = course.title.toLowerCase().includes(keyword) || course.description.toLowerCase().includes(keyword);
            const matchesCategory = category === 'all' || course.category === category;
            const matchesPrice = !maxPrice || (course.price && parseFloat(course.price) <= parseFloat(maxPrice));
            return matchesKeyword && matchesCategory && matchesPrice;
        });
        renderCourses(filtered);
    };
    
    // Renders the course card HTML
    function renderCourses(courses) {
        const container = document.getElementById('coursesContainer');
        container.innerHTML = '';

        if(courses.length === 0) {
            container.innerHTML = '<div class="loading">No courses found matching criteria.</div>';
            return;
        }

        courses.forEach(course => {
            const hasMultiple = course.images && course.images.length > 1;
            const imagesHTML = course.images ? course.images.map(img => `<img src="${img}" class="ad-img">`).join('') : '';
            const { avg, count } = calculateAverageRating(course.reviews);
            const stars = '★'.repeat(Math.round(avg)) + '☆'.repeat(5 - Math.round(avg));
            
            const card = document.createElement('div');
            card.className = 'course-card';
            card.innerHTML = `
                <div class="ad-carousel" id="carousel-${course.id}" data-index="0" data-total="${course.images ? course.images.length : 0}">
                    <div class="ad-images-container" style="width: ${course.images ? course.images.length * 100 : 100}%">
                        ${imagesHTML || '<div style="width:100%;height:100%;background:#eee;display:flex;align-items:center;justify-content:center;color:#888;">No Image</div>'}
                    </div>
                    ${hasMultiple ? `
                        <div class="ad-counter" id="counter-${course.id}">1/${course.images.length}</div>
                        <button class="ad-nav-btn ad-prev" onclick="event.stopPropagation(); slideImage('${course.id}', -1);">&#10094;</button>
                        <button class="ad-nav-btn ad-next" onclick="event.stopPropagation(); slideImage('${course.id}', 1);">&#10095;</button>
                    ` : ''}
                </div>
                <div class="course-details">
                    <div class="course-header">
                        <div class="course-title">${course.title}</div>
                        <div class="course-price">${course.currency} ${course.price}</div>
                    </div>
                    <div class="course-instructor">
                        <div class="instructor-avatar">${getAvatarHTML(course.instructorPhoto, course.instructorName, 'small')}</div>
                        <span>${course.instructorName}</span>
                    </div>
                    <div class="course-rating">
                        ${stars}
                        <span>(${count} reviews)</span>
                    </div>
                    <div class="course-desc">${course.description.length > 100 ? course.description.substring(0, 100) + '...' : course.description}</div>
                    <div class="course-actions">
                        <button class="action-btn-course btn-msg" onclick="viewProfile('${course.instructorId}')"><i class="fas fa-comment"></i> Contact</button>
                        <button class="action-btn-course btn-enroll" onclick="openDetail('${course.id}')"><i class="fas fa-search"></i> Details</button>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // --- CAROUSEL LOGIC ---
    window.slideImage = (id, direction) => {
        const carousel = document.getElementById(`carousel-${id}`);
        if (!carousel) return;

        const container = carousel.querySelector('.ad-images-container');
        const counter = document.getElementById(`counter-${id}`);
        
        let currentIndex = parseInt(carousel.dataset.index);
        const total = parseInt(carousel.dataset.total);
        
        let newIndex = currentIndex + direction;
        if (newIndex < 0) newIndex = total - 1; // Loop back
        if (newIndex >= total) newIndex = 0; // Loop forward

        container.style.transform = `translateX(-${newIndex * 100}%)`;
        if (counter) counter.innerText = `${newIndex + 1}/${total}`;
        carousel.dataset.index = newIndex;
    };

    // --- POST COURSE LOGIC ---
    window.openPostModal = () => document.getElementById('postModal').style.display = 'flex';
    window.closePostModal = () => {
        document.getElementById('postModal').style.display = 'none';
        uploadedImages = [];
        // Clear previews and reset the camera button
        const uploadGrid = document.getElementById('uploadGrid');
        uploadGrid.innerHTML = '';
        uploadGrid.innerHTML = `<div class="image-upload-box" onclick="document.getElementById('pImages').click()"><i class="fas fa-camera" style="font-size:24px; color:var(--secondary-text);"></i></div>`;
        document.getElementById('postForm').reset();
    };

    // Cloudinary Upload Function
    const uploadToCloudinary = (file) => {
        return new Promise((resolve, reject) => {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', cloudinaryConfig.uploadPreset);
            
            fetch(`https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/image/upload`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.secure_url) {
                    resolve(data.secure_url);
                } else {
                    reject('Upload failed');
                }
            })
            .catch(error => reject(error));
        });
    };

    // Image Upload Handler (Using Cloudinary)
    document.getElementById('pImages').onchange = async (e) => {
        const files = Array.from(e.target.files);
        const uploadGrid = document.getElementById('uploadGrid');

        for(const file of files) {
            if (uploadedImages.length >= 5) { alert("Max 5 images allowed."); break; }

            try {
                const imageUrl = await uploadToCloudinary(file);
                uploadedImages.push(imageUrl);

                // Add new image preview BEFORE the camera button
                const div = document.createElement('div');
                div.className = 'image-upload-box';
                div.innerHTML = `<img src="${imageUrl}"><div class="remove-img" data-index="${uploadedImages.length - 1}">&times;</div>`;
                uploadGrid.insertBefore(div, uploadGrid.lastElementChild);
                
                // Re-attach removal handler
                div.querySelector('.remove-img').onclick = function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    uploadedImages.splice(index, 1);
                    this.parentElement.remove();
                };
            } catch (error) {
                console.error('Error uploading image:', error);
                alert('Failed to upload image. Please try again.');
            }
        }
        e.target.value = null; // Clear file input
    };

    document.getElementById('postForm').onsubmit = async (e) => {
        e.preventDefault();
        if(uploadedImages.length === 0) { alert("Please add at least one image"); return; }
        
        const btn = e.target.querySelector('button');
        btn.innerText = "Posting..."; btn.disabled = true;

        try {
            const payment = document.querySelector('input[name="pPayment"]:checked').value;
            const format = document.querySelector('input[name="pFormat"]:checked').value;
            
            await addDoc(collection(db, "meetversity"), {
                instructorId: currentUser.uid,
                instructorName: currentUser.displayName || "User",
                instructorPhoto: currentUser.photoURL || null,
                title: document.getElementById('pTitle').value,
                price: document.getElementById('pPrice').value,
                currency: document.getElementById('pCurrency').value,
                duration: document.getElementById('pDuration').value,
                level: document.getElementById('pLevel').value,
                category: document.getElementById('pCategory').value,
                description: document.getElementById('pDesc').value,
                phone: document.getElementById('pPhone').value,
                email: document.getElementById('pEmail').value,
                location: document.getElementById('pLocation').value,
                payment: payment,
                format: format,
                images: uploadedImages,
                reviews: [], // Initialize reviews array
                createdAt: serverTimestamp()
            });
            
            alert("Course Posted Successfully!");
            closePostModal();
            // Note: loadCourses() is triggered by onSnapshot, which will handle the re-render.
        } catch (err) { 
            console.error("Error posting course:", err); 
            alert("Error posting course. Please try again."); 
        }
        finally { 
            btn.innerText = "Post Course"; 
            btn.disabled = false; 
        }
    };

    // --- DETAILS & REVIEWS ---
    window.openDetail = async (id) => {
        const course = allCourses.find(i => i.id === id);
        if(!course) return;
        currentCourse = course;
        currentDetailImgIdx = 0;

        document.getElementById('dMainImg').src = course.images ? course.images[0] : '';
        document.getElementById('dTitle').innerText = course.title;
        document.getElementById('dPrice').innerText = `${course.currency} ${course.price}`;
        document.getElementById('dInstructor').innerText = course.instructorName;
        document.getElementById('dContact').innerText = course.phone;
        document.getElementById('dEmail').innerText = course.email;
        document.getElementById('dLevel').innerText = course.level;
        document.getElementById('dDuration').innerText = course.duration + " weeks";
        document.getElementById('dFormat').innerText = course.format;
        document.getElementById('dPayment').innerText = course.payment;
        document.getElementById('dLocation').innerText = course.location;
        document.getElementById('dDesc').innerText = course.description;
        
        // Show/hide nav buttons
        const navBtns = document.querySelectorAll('.detail-gallery .nav-btn');
        navBtns.forEach(btn => btn.style.display = (course.images && course.images.length > 1) ? 'flex' : 'none');

        renderReviews();
        document.getElementById('detailModal').style.display = 'flex';
    };

    window.closeDetailModal = () => document.getElementById('detailModal').style.display = 'none';

    window.swapDetailImage = (dir) => {
        if(!currentCourse || !currentCourse.images || currentCourse.images.length === 0) return;
        currentDetailImgIdx += dir;
        if(currentDetailImgIdx < 0) currentDetailImgIdx = currentCourse.images.length - 1;
        if(currentDetailImgIdx >= currentCourse.images.length) currentDetailImgIdx = 0;
        document.getElementById('dMainImg').src = currentCourse.images[currentDetailImgIdx];
    };

    function renderReviews() {
        const list = document.getElementById('reviewsList');
        list.innerHTML = '';
        const reviews = currentCourse.reviews || [];
        
        if (reviews.length === 0) {
             list.innerHTML = '<div style="text-align:center; padding:10px; color:#888;">No reviews yet.</div>';
             return;
        }

        reviews.forEach((r, idx) => {
            const div = document.createElement('div');
            div.className = 'review-item';
            const stars = '★'.repeat(r.rating) + '☆'.repeat(5 - r.rating);
            div.innerHTML = `
                <div class="review-header">
                    <strong>${r.name} <span style="color:gold">${stars}</span></strong>
                    ${r.uid === currentUser.uid ? `<span class="delete-review" onclick="deleteReview('${currentCourse.id}', ${idx})">Delete</span>` : ''}
                </div>
                <div>${r.text}</div>
            `;
            list.appendChild(div);
        });
    }

    window.submitReview = async () => {
        const textInput = document.getElementById('newReviewText');
        const text = textInput.value.trim();
        const rating = document.getElementById('newRating').value;
        if(!text) return;
        if (!currentCourse || !currentCourse.id) return;

        const newReview = {
            uid: currentUser.uid,
            name: currentUser.displayName || 'User',
            text: text,
            rating: parseInt(rating),
            date: new Date().toISOString()
        };
        
        // Prevent duplicate review by the same user
        if (currentCourse.reviews && currentCourse.reviews.some(r => r.uid === currentUser.uid)) {
            alert("You have already reviewed this course.");
            return;
        }

        try {
            // Update Firestore
            await updateDoc(doc(db, "meetversity", currentCourse.id), {
                reviews: arrayUnion(newReview)
            });
            
            // Optimistic update for immediate display
            currentCourse.reviews = currentCourse.reviews || [];
            currentCourse.reviews.push(newReview);
            renderReviews();
            textInput.value = '';
            
            // Re-render courses to update the review count/stars on the main page
            loadCourses(); 

        } catch(e) { 
            console.error("Failed to submit review:", e); 
            alert("Failed to submit review. Please try again."); 
        }
    };
    
    // Expose deleteReview for onclick usage (needs window scope)
    window.deleteReview = async (courseId, idx) => {
        if(!confirm("Delete review?")) return;
        
        // Find the course in allCourses and the specific review
        const course = allCourses.find(i => i.id === courseId);
        if (!course || !course.reviews || !course.reviews[idx]) return;
        
        const reviewToDelete = course.reviews[idx];

        try {
            await updateDoc(doc(db, "meetversity", courseId), {
                reviews: arrayRemove(reviewToDelete)
            });
            
            // Update the local currentCourse and re-render reviews
            if (currentCourse && currentCourse.id === courseId) {
                currentCourse.reviews.splice(idx, 1);
                renderReviews();
            }
            
            // Re-render courses on main page
            loadCourses();

        } catch(e) { 
            console.error("Failed to delete review:", e); 
            alert("Failed to delete review. Please try again."); 
        }
    };

    // --- NOTIFICATIONS LOGIC (Copied from Feed) ---
    function setupNotificationsCount() {
        const q = query(collection(db, "notifications"), where("targetUserId", "==", currentUser.uid), where("read", "==", false));
        onSnapshot(q, (snap) => {
            const badge = document.getElementById('unreadBadge');
            if(!snap.empty) {
                badge.style.display = 'flex';
                badge.innerText = snap.size;
            } else {
                badge.style.display = 'none';
            }
        });
    }

    window.openNotificationsModal = () => {
        const modal = document.getElementById('notificationsModal');
        const list = document.getElementById('notificationsList');
        modal.style.display = 'flex';
        list.innerHTML = '<div class="loading">Loading...</div>';
        
        const q = query(collection(db, "notifications"), where("targetUserId", "==", currentUser.uid), orderBy("createdAt", "desc"));
        onSnapshot(q, (snap) => {
            list.innerHTML = '';
            if (snap.empty) {
                list.innerHTML = '<div style="text-align:center; padding:20px; color:#666;">No notifications.</div>';
                return;
            }
            snap.forEach(d => {
                const n = d.data();
                const id = d.id;
                list.innerHTML += `
                    <div class="notif-item ${!n.read ? 'notif-unread' : ''}">
                        <div style="flex:1;">
                            ${n.text}
                            <div style="font-size:12px; color:#888;">${n.createdAt?.toDate().toLocaleTimeString() || ''}</div>
                        </div>
                        <div class="notif-actions">
                            ${!n.read ? `<i class="fas fa-check notif-btn" title="Mark as read" onclick="markNotifRead('${id}')"></i>` : ''}
                            <i class="fas fa-trash notif-btn delete" title="Delete" onclick="deleteNotif('${id}')"></i>
                        </div>
                    </div>
                `;
            });
        });
    };

    window.markNotifRead = async (id) => await updateDoc(doc(db, "notifications", id), { read: true });
    window.deleteNotif = async (id) => await deleteDoc(doc(db, "notifications", id));

    // Basic controls
    document.getElementById('closeNotificationsModal').onclick = () => document.getElementById('notificationsModal').style.display = 'none';
    document.getElementById('closeUsersModal').onclick = () => document.getElementById('usersModal').style.display = 'none';
    document.getElementById('nightToggleBtn').onclick = () => document.body.classList.toggle('dark-mode');
    document.getElementById('logoutBtn').onclick = () => signOut(auth);
    
    // --- USERS MODAL (Reused) ---
    window.openUsersModal = async () => {
        document.getElementById('usersModal').style.display = 'flex';
        const list = document.getElementById('usersList');
        list.innerHTML = '<div class="loading">Loading users...</div>';
        
        try {
            const snap = await getDocs(collection(db, "users"));
            let html = '';
            // Fetch current user's associates for proper button display
            const associateDocs = await getDocs(collection(db, `users/${currentUser.uid}/associates`));
            const associates = new Set(associateDocs.docs.map(doc => doc.id));

            for (const userDoc of snap.docs) {
                if (userDoc.id === currentUser.uid) continue;
                const user = userDoc.data();
                const isAssoc = associates.has(userDoc.id);

                html += `
                  <div class="user-item">
                     <div style="display:flex; align-items:center; gap:10px;">
                        ${getAvatarHTML(user.photoURL, user.displayName, 'small')}
                        <span onclick="viewProfile('${userDoc.id}')" style="cursor:pointer; font-weight:600;">${user.displayName || 'User'}</span>
                     </div>
                     <button class="association-btn ${isAssoc ? 'disassociate-btn' : 'associate-btn'}" 
                        onclick="toggleAssociate('${userDoc.id}', ${isAssoc})">
                        ${isAssoc ? 'Disassociate' : 'Associate'}
                     </button>
                  </div>
                `;
            }
            list.innerHTML = html;
        } catch(e) {
            console.error("Error loading users:", e);
            list.innerHTML = '<div class="loading">Error loading users.</div>';
        }
    };
    
    window.toggleAssociate = async (targetId, isCurrentlyAssociated) => {
        try {
            if (isCurrentlyAssociated) {
                await deleteDoc(doc(db, `users/${currentUser.uid}/associates/${targetId}`));
                await deleteDoc(doc(db, `users/${targetId}/associatedWith/${currentUser.uid}`));
            } else {
                await setDoc(doc(db, `users/${currentUser.uid}/associates/${targetId}`), { timestamp: serverTimestamp() });
                // Note: associatedWith logic implies one-way following in some systems, but here it acts as mutual association.
                await setDoc(doc(db, `users/${targetId}/associatedWith/${currentUser.uid}`), { followerId: currentUser.uid, timestamp: serverTimestamp() });
            }
            // Re-open modal to refresh the list and buttons
            window.openUsersModal(); 
        } catch (e) { console.error("Error toggling associate:", e); }
    };

    window.auth = auth;
</script>
</body>
</html>
