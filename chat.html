<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>WhatsApp Web Clone</title>
<link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    /* WhatsApp Color Scheme */
    --whatsapp-green: #008069;
    --whatsapp-green-dark: #005c4b;
    --whatsapp-light-green: #00a884;
    --whatsapp-chat-bg: #efeae2;
    --whatsapp-dark-bg: #0c1317;
    --whatsapp-dark-panel: #111b21;
    --whatsapp-dark-chat-bg: #0b141a;
    --whatsapp-sent-bubble: #005c4b;
    --whatsapp-received-bubble: #ffffff;
    --whatsapp-dark-sent-bubble: #005c4b;
    --whatsapp-dark-received-bubble: #202c33;
    --whatsapp-text: #111b21;
    --whatsapp-secondary-text: #667781;
    --whatsapp-dark-text: #e9edef;
    --whatsapp-dark-secondary: #8696a0;
    --whatsapp-border: #e9edef;
    --whatsapp-dark-border: #2a3942;
    --whatsapp-blue-check: #53bdeb;
    --whatsapp-icon: #54656f;
    --whatsapp-dark-icon: #aebac1;
    --whatsapp-online: #4ad504;
    --whatsapp-typing: #d1f4cc;
    --whatsapp-input-bg: #f0f2f5;
    --whatsapp-dark-input-bg: #2a3942;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    font-family: 'Segoe UI', Helvetica Neue, Helvetica, Lucida Grande, Arial, sans-serif;
    background: var(--whatsapp-chat-bg);
    color: var(--whatsapp-text);
    height: 100vh;
    overflow: hidden;
    font-size: 15px;
    -webkit-font-smoothing: antialiased;
  }

  body.dark-mode {
    background: var(--whatsapp-dark-bg);
    color: var(--whatsapp-dark-text);
  }

  /* WhatsApp Main Container */
  .app-container {
    display: flex;
    height: 100vh;
    width: 100vw;
    max-width: 1600px;
    margin: 0 auto;
    background: #fff;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
  }

  body.dark-mode .app-container {
    background: var(--whatsapp-dark-bg);
  }

  /* Sidebar - WhatsApp Left Panel */
  .sidebar {
    width: 30%;
    min-width: 380px;
    max-width: 440px;
    border-right: 1px solid var(--whatsapp-border);
    display: flex;
    flex-direction: column;
    background: #fff;
    position: relative;
    z-index: 100;
  }

  body.dark-mode .sidebar {
    background: var(--whatsapp-dark-panel);
    border-right-color: var(--whatsapp-dark-border);
  }

  /* Profile Header */
  .profile-header {
    padding: 10px 16px;
    background: var(--whatsapp-input-bg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 60px;
  }

  body.dark-mode .profile-header {
    background: var(--whatsapp-dark-panel);
  }

  .profile-info {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .profile-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    cursor: pointer;
  }

  .profile-name {
    font-weight: 600;
    font-size: 16px;
    color: var(--whatsapp-text);
  }

  body.dark-mode .profile-name {
    color: var(--whatsapp-dark-text);
  }

  .header-actions {
    display: flex;
    gap: 20px;
    color: var(--whatsapp-icon);
  }

  body.dark-mode .header-actions {
    color: var(--whatsapp-dark-icon);
  }

  .header-actions i {
    font-size: 20px;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: background 0.2s;
  }

  .header-actions i:hover {
    background: rgba(0, 0, 0, 0.1);
  }

  body.dark-mode .header-actions i:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  /* Search Container */
  .search-container {
    padding: 8px 12px;
    background: var(--whatsapp-input-bg);
    border-bottom: 1px solid var(--whatsapp-border);
  }

  body.dark-mode .search-container {
    background: var(--whatsapp-dark-panel);
    border-bottom-color: var(--whatsapp-dark-border);
  }

  .search-box {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 8px;
    padding: 8px 16px;
  }

  body.dark-mode .search-box {
    background: var(--whatsapp-dark-input-bg);
  }

  .search-box i {
    color: var(--whatsapp-secondary-text);
    margin-right: 12px;
    font-size: 14px;
  }

  body.dark-mode .search-box i {
    color: var(--whatsapp-dark-secondary);
  }

  .search-box input {
    border: none;
    outline: none;
    flex: 1;
    font-size: 14px;
    background: transparent;
    color: var(--whatsapp-text);
  }

  body.dark-mode .search-box input {
    color: var(--whatsapp-dark-text);
  }

  .search-box input::placeholder {
    color: var(--whatsapp-secondary-text);
  }

  body.dark-mode .search-box input::placeholder {
    color: var(--whatsapp-dark-secondary);
  }

  /* Conversations List */
  .conversations-list {
    flex: 1;
    overflow-y: auto;
    background: #fff;
  }

  body.dark-mode .conversations-list {
    background: var(--whatsapp-dark-panel);
  }

  .conversation-item {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    cursor: pointer;
    border-bottom: 1px solid var(--whatsapp-border);
    transition: background 0.2s;
    position: relative;
  }

  body.dark-mode .conversation-item {
    border-bottom-color: var(--whatsapp-dark-border);
  }

  .conversation-item:hover {
    background: var(--whatsapp-input-bg);
  }

  body.dark-mode .conversation-item:hover {
    background: var(--whatsapp-dark-input-bg);
  }

  .conversation-item.active {
    background: var(--whatsapp-typing);
  }

  body.dark-mode .conversation-item.active {
    background: var(--whatsapp-dark-border);
  }

  .conversation-avatar {
    width: 49px;
    height: 49px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 15px;
    position: relative;
  }

  .conversation-avatar.online::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 0;
    width: 12px;
    height: 12px;
    background: var(--whatsapp-online);
    border-radius: 50%;
    border: 2px solid #fff;
  }

  body.dark-mode .conversation-avatar.online::after {
    border-color: var(--whatsapp-dark-panel);
  }

  .conversation-info {
    flex: 1;
    min-width: 0;
  }

  .conversation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2px;
  }

  .conversation-name {
    font-weight: 600;
    font-size: 16px;
    color: var(--whatsapp-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  body.dark-mode .conversation-name {
    color: var(--whatsapp-dark-text);
  }

  .conversation-time {
    font-size: 12px;
    color: var(--whatsapp-secondary-text);
    white-space: nowrap;
  }

  body.dark-mode .conversation-time {
    color: var(--whatsapp-dark-secondary);
  }

  .conversation-preview {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .conversation-message {
    font-size: 14px;
    color: var(--whatsapp-secondary-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    flex: 1;
  }

  body.dark-mode .conversation-message {
    color: var(--whatsapp-dark-secondary);
  }

  .message-status {
    color: var(--whatsapp-secondary-text);
    font-size: 12px;
  }

  .message-status.read {
    color: var(--whatsapp-blue-check);
  }

  .unread-badge {
    background: var(--whatsapp-green);
    color: white;
    font-size: 12px;
    font-weight: 600;
    min-width: 20px;
    height: 20px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 6px;
  }

  /* Chat Area - WhatsApp Right Panel */
  .chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--whatsapp-chat-bg);
    position: relative;
  }

  body.dark-mode .chat-area {
    background: var(--whatsapp-dark-chat-bg);
  }

  /* Chat Header */
  .chat-header {
    padding: 10px 16px;
    background: var(--whatsapp-input-bg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-left: 1px solid var(--whatsapp-border);
    min-height: 60px;
  }

  body.dark-mode .chat-header {
    background: var(--whatsapp-dark-panel);
    border-left-color: var(--whatsapp-dark-border);
  }

  .chat-user-info {
    display: flex;
    align-items: center;
    gap: 15px;
    flex: 1;
  }

  .chat-user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    position: relative;
  }

  .chat-user-avatar.online::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 0;
    width: 10px;
    height: 10px;
    background: var(--whatsapp-online);
    border-radius: 50%;
    border: 2px solid var(--whatsapp-input-bg);
  }

  body.dark-mode .chat-user-avatar.online::after {
    border-color: var(--whatsapp-dark-panel);
  }

  .chat-user-details {
    flex: 1;
  }

  .chat-user-name {
    font-weight: 600;
    font-size: 16px;
    color: var(--whatsapp-text);
  }

  body.dark-mode .chat-user-name {
    color: var(--whatsapp-dark-text);
  }

  .chat-user-status {
    font-size: 13px;
    color: var(--whatsapp-secondary-text);
    margin-top: 2px;
  }

  body.dark-mode .chat-user-status {
    color: var(--whatsapp-dark-secondary);
  }

  .chat-actions {
    display: flex;
    gap: 20px;
    color: var(--whatsapp-icon);
  }

  body.dark-mode .chat-actions {
    color: var(--whatsapp-dark-icon);
  }

  .chat-actions i {
    font-size: 20px;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: background 0.2s;
  }

  .chat-actions i:hover {
    background: rgba(0, 0, 0, 0.1);
  }

  body.dark-mode .chat-actions i:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  /* Messages Container */
  .messages-container {
    flex: 1;
    padding: 20px 80px;
    overflow-y: auto;
    background-image: url('https://web.whatsapp.com/img/bg-chat-tile-dark_9f39b5c5ddd5c19c0e2e4cf6b4b6c6d9.png');
    background-repeat: repeat;
    background-color: var(--whatsapp-chat-bg);
    display: flex;
    flex-direction: column;
    position: relative;
  }

  body.dark-mode .messages-container {
    background-image: url('https://web.whatsapp.com/img/bg-chat-tile-dark_9f39b5c5ddd5c19c0e2e4cf6b4b6c6d9.png');
    background-color: var(--whatsapp-dark-chat-bg);
  }

  .message-date {
    text-align: center;
    margin: 20px 0;
    position: relative;
  }

  .date-divider {
    background: rgba(0, 0, 0, 0.1);
    color: rgba(255, 255, 255, 0.9);
    padding: 5px 12px;
    border-radius: 7px;
    font-size: 12.5px;
    display: inline-block;
    backdrop-filter: blur(5px);
  }

  body.dark-mode .date-divider {
    background: rgba(255, 255, 255, 0.1);
  }

  /* WhatsApp Message Bubbles */
  .message-wrapper {
    display: flex;
    margin-bottom: 2px;
    max-width: 65%;
    position: relative;
  }

  .message-wrapper.sent {
    align-self: flex-end;
  }

  .message-wrapper.received {
    align-self: flex-start;
  }

  /* WhatsApp-style message bubble with tail */
  .message-bubble {
    padding: 6px 7px 8px 9px;
    border-radius: 7.5px;
    position: relative;
    box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
    max-width: 100%;
    word-wrap: break-word;
    font-size: 14.2px;
    line-height: 19px;
  }

  .message-bubble.sent {
    background-color: var(--whatsapp-sent-bubble);
    color: white;
    border-top-right-radius: 0;
  }

  body.dark-mode .message-bubble.sent {
    background-color: var(--whatsapp-dark-sent-bubble);
  }

  .message-bubble.received {
    background-color: var(--whatsapp-received-bubble);
    color: var(--whatsapp-text);
    border-top-left-radius: 0;
  }

  body.dark-mode .message-bubble.received {
    background-color: var(--whatsapp-dark-received-bubble);
    color: var(--whatsapp-dark-text);
  }

  /* Bubble tails */
  .message-bubble.sent::before {
    content: '';
    position: absolute;
    top: 0;
    right: -8px;
    width: 8px;
    height: 13px;
    background-color: var(--whatsapp-sent-bubble);
    clip-path: polygon(0 0, 100% 0, 0 100%);
  }

  body.dark-mode .message-bubble.sent::before {
    background-color: var(--whatsapp-dark-sent-bubble);
  }

  .message-bubble.received::before {
    content: '';
    position: absolute;
    top: 0;
    left: -8px;
    width: 8px;
    height: 13px;
    background-color: var(--whatsapp-received-bubble);
    clip-path: polygon(100% 0, 100% 100%, 0 0);
  }

  body.dark-mode .message-bubble.received::before {
    background-color: var(--whatsapp-dark-received-bubble);
  }

  .message-content {
    display: flex;
    flex-direction: column;
  }

  .message-text {
    white-space: pre-wrap;
    word-wrap: break-word;
    padding-right: 10px;
  }

  .message-meta {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 3px;
    margin-top: 2px;
    font-size: 11px;
    height: 15px;
    float: right;
    clear: both;
    margin-left: 4px;
  }

  .message-bubble.sent .message-meta {
    color: rgba(255, 255, 255, 0.7);
  }

  .message-bubble.received .message-meta {
    color: rgba(0, 0, 0, 0.45);
  }

  body.dark-mode .message-bubble.received .message-meta {
    color: rgba(255, 255, 255, 0.6);
  }

  .message-time {
    font-size: 11px;
    letter-spacing: 0.3px;
  }

  /* WhatsApp Read Receipts */
  .read-receipt {
    display: inline-flex;
    align-items: center;
    margin-left: 2px;
  }

  .read-receipt.single-check {
    color: rgba(255, 255, 255, 0.7);
  }

  .read-receipt.double-check {
    color: rgba(255, 255, 255, 0.7);
  }

  .read-receipt.blue-check {
    color: var(--whatsapp-blue-check);
  }

  .read-receipt i {
    font-size: 13px;
  }

  /* Voice Note Player - WhatsApp Style */
  .voice-note-player {
    display: flex;
    align-items: center;
    padding: 5px 0;
    min-width: 200px;
    max-width: 300px;
  }

  .voice-play-btn {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    margin-right: 10px;
    transition: background 0.2s;
  }

  .voice-play-btn:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .voice-play-btn i {
    font-size: 12px;
    margin-left: 1px;
  }

  .voice-waveform {
    flex: 1;
    height: 28px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 14px;
    position: relative;
    overflow: hidden;
  }

  .voice-progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: rgba(255, 255, 255, 0.3);
    width: 0%;
    transition: width 0.1s linear;
  }

  .voice-wave {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(255, 255, 255, 0.3) 50%, 
      transparent 100%);
    animation: wave 1.5s infinite linear;
    opacity: 0.5;
  }

  @keyframes wave {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  .voice-duration {
    color: white;
    font-size: 12px;
    margin-left: 10px;
    min-width: 35px;
  }

  .message-bubble.received .voice-play-btn {
    background: rgba(0, 0, 0, 0.1);
    color: var(--whatsapp-text);
  }

  .message-bubble.received .voice-play-btn:hover {
    background: rgba(0, 0, 0, 0.15);
  }

  .message-bubble.received .voice-waveform {
    background: rgba(0, 0, 0, 0.05);
  }

  .message-bubble.received .voice-progress {
    background: rgba(0, 0, 0, 0.1);
  }

  .message-bubble.received .voice-wave {
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(0, 0, 0, 0.1) 50%, 
      transparent 100%);
  }

  .message-bubble.received .voice-duration {
    color: var(--whatsapp-text);
  }

  /* Typing Indicator */
  .typing-indicator {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background: var(--whatsapp-received-bubble);
    border-radius: 7.5px;
    margin: 5px 0 5px 16px;
    align-self: flex-start;
    max-width: 65px;
    box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
  }

  body.dark-mode .typing-indicator {
    background: var(--whatsapp-dark-received-bubble);
  }

  .typing-indicator::before {
    content: '';
    position: absolute;
    top: 0;
    left: -8px;
    width: 8px;
    height: 13px;
    background-color: var(--whatsapp-received-bubble);
    clip-path: polygon(100% 0, 100% 100%, 0 0);
  }

  body.dark-mode .typing-indicator::before {
    background-color: var(--whatsapp-dark-received-bubble);
  }

  .typing-dots {
    display: flex;
    gap: 3px;
  }

  .typing-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--whatsapp-secondary-text);
    animation: typing 1.4s infinite both;
  }

  body.dark-mode .typing-dot {
    background: var(--whatsapp-dark-secondary);
  }

  .typing-dot:nth-child(1) { animation-delay: -0.32s; }
  .typing-dot:nth-child(2) { animation-delay: -0.16s; }

  @keyframes typing {
    0%, 80%, 100% { transform: scale(0.7); opacity: 0.5; }
    40% { transform: scale(1); opacity: 1; }
  }

  /* Message Input Area */
  .message-input-container {
    padding: 5px 16px;
    background: var(--whatsapp-input-bg);
    border-left: 1px solid var(--whatsapp-border);
    min-height: 62px;
    display: flex;
    align-items: center;
  }

  body.dark-mode .message-input-container {
    background: var(--whatsapp-dark-panel);
    border-left-color: var(--whatsapp-dark-border);
  }

  .input-wrapper {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 8px;
    padding: 9px 12px;
    flex: 1;
    margin: 5px 8px;
  }

  body.dark-mode .input-wrapper {
    background: var(--whatsapp-dark-input-bg);
  }

  .input-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-right: 8px;
  }

  .input-action {
    background: none;
    border: none;
    color: var(--whatsapp-icon);
    font-size: 24px;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
  }

  body.dark-mode .input-action {
    color: var(--whatsapp-dark-icon);
  }

  .input-action:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  body.dark-mode .input-action:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .message-input {
    flex: 1;
    border: none;
    outline: none;
    font-size: 15px;
    font-family: inherit;
    resize: none;
    max-height: 100px;
    min-height: 20px;
    line-height: 20px;
    padding: 10px 0;
    background: transparent;
    color: var(--whatsapp-text);
  }

  body.dark-mode .message-input {
    color: var(--whatsapp-dark-text);
  }

  .message-input::placeholder {
    color: var(--whatsapp-secondary-text);
  }

  body.dark-mode .message-input::placeholder {
    color: var(--whatsapp-dark-secondary);
  }

  .send-button {
    background: var(--whatsapp-green);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    margin-left: 8px;
    transition: background 0.2s;
  }

  .send-button:hover {
    background: var(--whatsapp-green-dark);
  }

  .send-button:disabled {
    background: var(--whatsapp-secondary-text);
    cursor: not-allowed;
  }

  /* Voice Recording UI */
  .voice-recording-ui {
    display: flex;
    align-items: center;
    background: #fff;
    border-radius: 8px;
    padding: 9px 12px;
    flex: 1;
    margin: 5px 8px;
  }

  body.dark-mode .voice-recording-ui {
    background: var(--whatsapp-dark-input-bg);
  }

  .recording-timer {
    font-size: 15px;
    font-weight: 600;
    color: var(--whatsapp-text);
    min-width: 45px;
    margin-right: 12px;
  }

  body.dark-mode .recording-timer {
    color: var(--whatsapp-dark-text);
  }

  .recording-wave {
    flex: 1;
    height: 4px;
    background: rgba(0, 128, 105, 0.2);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
  }

  .recording-wave::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 50%;
    background: var(--whatsapp-green);
    animation: recordingWave 1s infinite linear;
  }

  @keyframes recordingWave {
    0% { left: -50%; }
    100% { left: 100%; }
  }

  .recording-cancel {
    background: none;
    border: none;
    color: #f44336;
    font-size: 24px;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    margin-left: 12px;
  }

  /* Emoji Picker */
  .emoji-picker {
    position: absolute;
    bottom: 70px;
    left: 20px;
    width: 340px;
    height: 380px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 5px 40px rgba(0, 0, 0, 0.3);
    display: none;
    flex-direction: column;
    z-index: 1000;
    border: 1px solid var(--whatsapp-border);
  }

  body.dark-mode .emoji-picker {
    background: var(--whatsapp-dark-panel);
    border-color: var(--whatsapp-dark-border);
  }

  .emoji-header {
    padding: 10px;
    border-bottom: 1px solid var(--whatsapp-border);
    display: flex;
    gap: 5px;
    overflow-x: auto;
  }

  body.dark-mode .emoji-header {
    border-bottom-color: var(--whatsapp-dark-border);
  }

  .emoji-category-btn {
    background: none;
    border: none;
    font-size: 20px;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .emoji-category-btn:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  body.dark-mode .emoji-category-btn:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .emoji-category-btn.active {
    background: rgba(0, 128, 105, 0.1);
  }

  .emoji-content {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    gap: 5px;
  }

  .emoji-item {
    font-size: 24px;
    text-align: center;
    padding: 5px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .emoji-item:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  body.dark-mode .emoji-item:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  /* Scroll to Bottom Button */
  .scroll-bottom-btn {
    position: absolute;
    bottom: 80px;
    right: 30px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--whatsapp-green);
    color: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    z-index: 100;
    transition: all 0.3s;
  }

  .scroll-bottom-btn:hover {
    background: var(--whatsapp-green-dark);
    transform: scale(1.05);
  }

  /* Reply Preview */
  .reply-preview {
    display: flex;
    align-items: center;
    background: rgba(0, 128, 105, 0.1);
    padding: 8px 16px;
    margin: 0 16px 5px;
    border-left: 4px solid var(--whatsapp-green);
    border-radius: 4px;
  }

  .reply-content {
    flex: 1;
  }

  .reply-name {
    font-weight: 600;
    font-size: 13px;
    color: var(--whatsapp-text);
    margin-bottom: 2px;
  }

  body.dark-mode .reply-name {
    color: var(--whatsapp-dark-text);
  }

  .reply-text {
    font-size: 13px;
    color: var(--whatsapp-secondary-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  body.dark-mode .reply-text {
    color: var(--whatsapp-dark-secondary);
  }

  .reply-cancel {
    background: none;
    border: none;
    color: var(--whatsapp-secondary-text);
    font-size: 20px;
    cursor: pointer;
    padding: 5px;
    margin-left: 10px;
  }

  /* Message Context Menu */
  .context-menu {
    position: absolute;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.2);
    min-width: 180px;
    z-index: 1000;
    display: none;
    overflow: hidden;
  }

  body.dark-mode .context-menu {
    background: var(--whatsapp-dark-panel);
  }

  .context-item {
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: background 0.2s;
    font-size: 14px;
    color: var(--whatsapp-text);
  }

  body.dark-mode .context-item {
    color: var(--whatsapp-dark-text);
  }

  .context-item:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  body.dark-mode .context-item:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .context-item.delete {
    color: #f44336;
  }

  /* Empty Chat State */
  .empty-chat {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: var(--whatsapp-secondary-text);
    text-align: center;
    padding: 40px;
  }

  body.dark-mode .empty-chat {
    color: var(--whatsapp-dark-secondary);
  }

  .empty-chat-icon {
    font-size: 120px;
    margin-bottom: 30px;
    opacity: 0.3;
  }

  .empty-chat-title {
    font-size: 32px;
    font-weight: 300;
    margin-bottom: 10px;
    color: var(--whatsapp-text);
  }

  body.dark-mode .empty-chat-title {
    color: var(--whatsapp-dark-text);
  }

  .empty-chat-subtitle {
    font-size: 14px;
    line-height: 1.5;
    max-width: 500px;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .app-container {
      flex-direction: column;
    }
    
    .sidebar {
      width: 100%;
      max-width: 100%;
      min-width: 100%;
      position: absolute;
      z-index: 1000;
      height: 100%;
      display: none;
    }
    
    .sidebar.active {
      display: flex;
    }
    
    .chat-area {
      width: 100%;
      position: relative;
    }
    
    .messages-container {
      padding: 10px 20px;
    }
    
    .message-wrapper {
      max-width: 85%;
    }
    
    .emoji-picker {
      width: 90%;
      left: 5%;
      bottom: 60px;
    }
    
    .scroll-bottom-btn {
      bottom: 70px;
      right: 15px;
      width: 40px;
      height: 40px;
      font-size: 18px;
    }
    
    .conversation-item {
      padding: 10px 12px;
    }
    
    .conversation-avatar {
      width: 45px;
      height: 45px;
    }
  }

  /* WhatsApp Status Indicator */
  .status-indicator {
    font-size: 12px;
    color: var(--whatsapp-secondary-text);
    display: flex;
    align-items: center;
    gap: 3px;
  }

  body.dark-mode .status-indicator {
    color: var(--whatsapp-dark-secondary);
  }

  /* Loading Spinner */
  .loading-spinner {
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* File Attachment Preview */
  .file-preview {
    display: flex;
    align-items: center;
    padding: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    margin-top: 5px;
    max-width: 250px;
  }

  .message-bubble.received .file-preview {
    background: rgba(0, 0, 0, 0.05);
  }

  .file-icon {
    font-size: 24px;
    margin-right: 10px;
    color: var(--whatsapp-green);
  }

  .file-info {
    flex: 1;
    min-width: 0;
  }

  .file-name {
    font-size: 13px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .file-size {
    font-size: 11px;
    color: rgba(255, 255, 255, 0.7);
    margin-top: 2px;
  }

  .message-bubble.received .file-size {
    color: rgba(0, 0, 0, 0.6);
  }

  body.dark-mode .message-bubble.received .file-size {
    color: rgba(255, 255, 255, 0.6);
  }
</style>
</head>
<body>
<div class="app-container">
  <!-- Left Sidebar - Conversations List -->
  <div class="sidebar" id="sidebar">
    <!-- Profile Header -->
    <div class="profile-header">
      <div class="profile-info">
        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Profile" class="profile-avatar" id="profileAvatar">
        <span class="profile-name" id="profileName">You</span>
      </div>
      <div class="header-actions">
        <i class="fas fa-users" title="New group"></i>
        <i class="fas fa-circle-notch" title="Status"></i>
        <i class="fas fa-comment-alt" title="New chat" onclick="openNewChat()"></i>
        <i class="fas fa-ellipsis-v" title="Menu" onclick="toggleProfileMenu()"></i>
      </div>
    </div>

    <!-- Search Box -->
    <div class="search-container">
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search or start new chat" id="chatSearch">
      </div>
    </div>

    <!-- Conversations List -->
    <div class="conversations-list" id="conversationsList">
      <!-- Conversations will be dynamically added here -->
    </div>
  </div>

  <!-- Right Chat Area -->
  <div class="chat-area" id="chatArea">
    <!-- Default Empty State -->
    <div class="empty-chat" id="emptyChat">
      <div class="empty-chat-icon">
        <i class="fab fa-whatsapp"></i>
      </div>
      <h1 class="empty-chat-title">WhatsApp Web</h1>
      <p class="empty-chat-subtitle">
        Send and receive messages without keeping your phone online.<br>
        Use WhatsApp on up to 4 linked devices and 1 phone at the same time.
      </p>
    </div>

    <!-- Chat Header (hidden by default) -->
    <div class="chat-header" id="chatHeader" style="display: none;">
      <div class="chat-user-info">
        <div style="display: flex; align-items: center; gap: 15px;">
          <i class="fas fa-arrow-left" id="backButton" style="display: none; cursor: pointer; font-size: 18px;"></i>
          <img src="" alt="User" class="chat-user-avatar" id="chatUserAvatar">
          <div class="chat-user-details">
            <div class="chat-user-name" id="chatUserName">John Doe</div>
            <div class="chat-user-status" id="chatUserStatus">last seen today at 10:30 AM</div>
          </div>
        </div>
      </div>
      <div class="chat-actions">
        <i class="fas fa-video" title="Video call" onclick="startVideoCall()"></i>
        <i class="fas fa-phone-alt" title="Voice call" onclick="startVoiceCall()"></i>
        <i class="fas fa-ellipsis-v" title="Menu" onclick="toggleChatMenu()"></i>
      </div>
    </div>

    <!-- Messages Container -->
    <div class="messages-container" id="messagesContainer" style="display: none;">
      <!-- Messages will be dynamically added here -->
      <div class="message-date">
        <div class="date-divider">TODAY</div>
      </div>
      <!-- Example messages will be added by JavaScript -->
    </div>

    <!-- Typing Indicator -->
    <div class="typing-indicator" id="typingIndicator" style="display: none;">
      <div class="typing-dots">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    </div>

    <!-- Reply Preview -->
    <div class="reply-preview" id="replyPreview" style="display: none;">
      <div class="reply-content">
        <div class="reply-name" id="replyName">Replying to John</div>
        <div class="reply-text" id="replyText">Hello there!</div>
      </div>
      <button class="reply-cancel" onclick="cancelReply()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Message Input Area -->
    <div class="message-input-container" id="messageInputContainer" style="display: none;">
      <div class="input-actions">
        <button class="input-action" onclick="toggleEmojiPicker()" title="Emoji">
          <i class="far fa-smile"></i>
        </button>
        <button class="input-action" onclick="attachFile()" title="Attach">
          <i class="fas fa-paperclip"></i>
        </button>
      </div>
      
      <!-- Text Input -->
      <div class="input-wrapper" id="inputWrapper">
        <textarea class="message-input" id="messageInput" placeholder="Type a message" rows="1"></textarea>
      </div>
      
      <!-- Voice Recording UI -->
      <div class="voice-recording-ui" id="voiceRecordingUI" style="display: none;">
        <div class="recording-timer" id="recordingTimer">0:00</div>
        <div class="recording-wave"></div>
        <button class="recording-cancel" onclick="cancelRecording()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <!-- Send/Voice Button -->
      <button class="send-button" id="sendButton" onclick="sendMessage()" title="Send">
        <i class="fas fa-microphone" id="voiceButtonIcon"></i>
      </button>
    </div>

    <!-- Scroll to Bottom Button -->
    <button class="scroll-bottom-btn" id="scrollBottomBtn" style="display: none;">
      <i class="fas fa-chevron-down"></i>
    </button>

    <!-- Emoji Picker -->
    <div class="emoji-picker" id="emojiPicker">
      <div class="emoji-header" id="emojiHeader">
        <!-- Emoji categories will be added by JavaScript -->
      </div>
      <div class="emoji-content" id="emojiContent">
        <!-- Emojis will be added by JavaScript -->
      </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
      <div class="context-item" onclick="replyToMessage()">
        <i class="fas fa-reply"></i>
        <span>Reply</span>
      </div>
      <div class="context-item" onclick="copyMessage()">
        <i class="fas fa-copy"></i>
        <span>Copy</span>
      </div>
      <div class="context-item" onclick="forwardMessage()">
        <i class="fas fa-share"></i>
        <span>Forward</span>
      </div>
      <div class="context-item" onclick="starMessage()">
        <i class="far fa-star"></i>
        <span>Star</span>
      </div>
      <div class="context-item delete" onclick="deleteMessage()">
        <i class="fas fa-trash-alt"></i>
        <span>Delete</span>
      </div>
    </div>
  </div>
</div>

<!-- Hidden File Input -->
<input type="file" id="fileInput" style="display: none;" multiple accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.txt">

<!-- Ringtone Audio -->
<audio id="ringtone" loop style="display: none;">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-classic-alarm-995.mp3" type="audio/mpeg">
</audio>

<!-- Message Tone -->
<audio id="messageTone" style="display: none;">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
</audio>

<script>
  // WhatsApp Clone Application
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize the application
    initWhatsApp();
  });

  // Global variables
  let currentUser = {
    id: 'user1',
    name: 'You',
    avatar: 'https://randomuser.me/api/portraits/men/32.jpg',
    status: 'online'
  };

  let currentChat = null;
  let messages = [];
  let conversations = [];
  let emojiPickerVisible = false;
  let isRecording = false;
  let recordingTimer = null;
  let recordingStartTime = null;
  let replyToMessage = null;
  let contextMenuMessage = null;
  let mediaRecorder = null;
  let audioChunks = [];
  let currentlyPlayingAudio = null;

  // WhatsApp emoji categories
  const emojiCategories = {
    "Smileys": ["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ˜‚","ðŸ¤£","ðŸ¥²","â˜ºï¸","ðŸ˜Š","ðŸ˜‡","ðŸ™‚","ðŸ™ƒ","ðŸ˜‰","ðŸ˜Œ","ðŸ˜","ðŸ¥°","ðŸ˜˜","ðŸ˜—","ðŸ˜™","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜","ðŸ˜œ","ðŸ¤ª","ðŸ¤¨","ðŸ§","ðŸ¤“","ðŸ˜Ž","ðŸ¥¸","ðŸ¤©","ðŸ¥³"],
    "People": ["ðŸ‘‹","ðŸ¤š","ðŸ–","âœ‹","ðŸ––","ðŸ‘Œ","ðŸ¤Œ","ðŸ¤","âœŒï¸","ðŸ¤ž","ðŸ¤Ÿ","ðŸ¤˜","ðŸ¤™","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘†","ðŸ–•","ðŸ‘‡","ðŸ‘","ðŸ‘Ž","âœŠ","ðŸ‘Š","ðŸ¤›","ðŸ¤œ","ðŸ‘","ðŸ™Œ","ðŸ‘","ðŸ¤²","ðŸ¤","ðŸ™"],
    "Animals": ["ðŸ¶","ðŸ±","ðŸ­","ðŸ¹","ðŸ°","ðŸ¦Š","ðŸ»","ðŸ¼","ðŸ¨","ðŸ¯","ðŸ¦","ðŸ®","ðŸ·","ðŸ¸","ðŸµ","ðŸ™ˆ","ðŸ™‰","ðŸ™Š","ðŸ”","ðŸ§","ðŸ¦","ðŸ¤","ðŸ£","ðŸ¥","ðŸ¦†","ðŸ¦…","ðŸ¦‰","ðŸ¦‡"],
    "Food": ["ðŸ","ðŸŽ","ðŸ","ðŸŠ","ðŸ‹","ðŸŒ","ðŸ‰","ðŸ‡","ðŸ“","ðŸ«","ðŸˆ","ðŸ’","ðŸ‘","ðŸ¥­","ðŸ","ðŸ¥¥","ðŸ¥","ðŸ…","ðŸ†","ðŸ¥‘","ðŸ¥¦","ðŸ¥¬","ðŸ¥’","ðŸŒ¶","ðŸ«‘","ðŸŒ½","ðŸ¥•"],
    "Activities": ["âš½ï¸","ðŸ€","ðŸˆ","âš¾ï¸","ðŸ¥Ž","ðŸŽ¾","ðŸ","ðŸ‰","ðŸ¥","ðŸŽ±","ðŸª€","ðŸ“","ðŸ¸","ðŸ’","ðŸ‘","ðŸ¥","ðŸ","ðŸªƒ","ðŸ¥…","â›³ï¸","ðŸª","ðŸ¹","ðŸŽ£","ðŸ¤¿","ðŸ¥Š","ðŸ¥‹"],
    "Travel": ["ðŸš—","ðŸš•","ðŸš™","ðŸšŒ","ðŸšŽ","ðŸŽ","ðŸš“","ðŸš‘","ðŸš’","ðŸš","ðŸšš","ðŸš›","ðŸšœ","ðŸ›´","ðŸš²","ðŸ›µ","ðŸ","ðŸ›º","ðŸš¨","ðŸš”","ðŸš","ðŸš˜","ðŸš–","ðŸš¡","ðŸš ","ðŸšŸ","ðŸšƒ"],
    "Objects": ["âŒšï¸","ðŸ“±","ðŸ’»","âŒ¨ï¸","ðŸ–¥","ðŸ–¨","ðŸ–±","ðŸ–²","ðŸ•¹","ðŸ—œ","ðŸ’½","ðŸ’¾","ðŸ’¿","ðŸ“€","ðŸ“¼","ðŸ“·","ðŸ“¸","ðŸ“¹","ðŸŽ¥","ðŸ“½","ðŸŽž","ðŸ“ž","â˜Žï¸","ðŸ“Ÿ","ðŸ“ ","ðŸ“º"],
    "Symbols": ["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","â¤ï¸â€ðŸ”¥","â¤ï¸â€ðŸ©¹","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ","â˜®ï¸","âœï¸","â˜ªï¸","ðŸ•‰","â˜¸ï¸","âœ¡ï¸"]
  };

  // Sample conversations data
  const sampleConversations = [
    {
      id: 'chat1',
      userId: 'user2',
      userName: 'John Doe',
      userAvatar: 'https://randomuser.me/api/portraits/men/1.jpg',
      status: 'online',
      lastSeen: '10:30 AM',
      lastMessage: 'See you tomorrow!',
      lastMessageTime: '10:30 AM',
      unreadCount: 2,
      isOnline: true,
      lastMessageStatus: 'read'
    },
    {
      id: 'chat2',
      userId: 'user3',
      userName: 'Alice Smith',
      userAvatar: 'https://randomuser.me/api/portraits/women/2.jpg',
      status: 'last seen today at 9:15 AM',
      lastSeen: '9:15 AM',
      lastMessage: 'Can you send me the files?',
      lastMessageTime: 'Yesterday',
      unreadCount: 0,
      isOnline: false,
      lastMessageStatus: 'sent'
    },
    {
      id: 'chat3',
      userId: 'user4',
      userName: 'Bob Johnson',
      userAvatar: 'https://randomuser.me/api/portraits/men/3.jpg',
      status: 'last seen yesterday at 11:45 PM',
      lastSeen: 'Yesterday',
      lastMessage: 'Thanks for your help!',
      lastMessageTime: 'Yesterday',
      unreadCount: 1,
      isOnline: false,
      lastMessageStatus: 'delivered'
    },
    {
      id: 'chat4',
      userId: 'user5',
      userName: 'Emma Wilson',
      userAvatar: 'https://randomuser.me/api/portraits/women/4.jpg',
      status: 'typing...',
      lastSeen: 'Just now',
      lastMessage: 'ðŸ‘',
      lastMessageTime: '10:15 AM',
      unreadCount: 0,
      isOnline: true,
      lastMessageStatus: 'read'
    },
    {
      id: 'chat5',
      userId: 'user6',
      userName: 'Michael Brown',
      userAvatar: 'https://randomuser.me/api/portraits/men/5.jpg',
      status: 'last seen today at 8:00 AM',
      lastSeen: '8:00 AM',
      lastMessage: 'Meeting at 3 PM',
      lastMessageTime: 'Monday',
      unreadCount: 3,
      isOnline: false,
      lastMessageStatus: 'read'
    }
  ];

  // Sample messages for each chat
  const sampleMessages = {
    'chat1': [
      {
        id: 'msg1',
        senderId: 'user2',
        senderName: 'John Doe',
        text: 'Hey there! How are you doing?',
        time: '10:25 AM',
        status: 'read',
        isSent: false,
        type: 'text'
      },
      {
        id: 'msg2',
        senderId: 'user1',
        senderName: 'You',
        text: 'I\'m good! Just working on some projects. How about you?',
        time: '10:26 AM',
        status: 'read',
        isSent: true,
        type: 'text'
      },
      {
        id: 'msg3',
        senderId: 'user2',
        senderName: 'John Doe',
        text: 'Same here. Just finished a meeting. Want to grab lunch later?',
        time: '10:28 AM',
        status: 'read',
        isSent: false,
        type: 'text'
      },
      {
        id: 'msg4',
        senderId: 'user1',
        senderName: 'You',
        text: 'Sure! 1 PM works for me.',
        time: '10:29 AM',
        status: 'read',
        isSent: true,
        type: 'text'
      },
      {
        id: 'msg5',
        senderId: 'user2',
        senderName: 'John Doe',
        text: 'Perfect! See you tomorrow!',
        time: '10:30 AM',
        status: 'read',
        isSent: false,
        type: 'text'
      }
    ],
    'chat2': [
      {
        id: 'msg1',
        senderId: 'user3',
        senderName: 'Alice Smith',
        text: 'Hi! Can you send me the project files?',
        time: 'Yesterday 4:30 PM',
        status: 'read',
        isSent: false,
        type: 'text'
      },
      {
        id: 'msg2',
        senderId: 'user1',
        senderName: 'You',
        text: 'Sure, I\'ll send them right away.',
        time: 'Yesterday 4:32 PM',
        status: 'read',
        isSent: true,
        type: 'text'
      },
      {
        id: 'msg3',
        senderId: 'user1',
        senderName: 'You',
        text: 'project_final.zip',
        time: 'Yesterday 4:33 PM',
        status: 'read',
        isSent: true,
        type: 'file',
        fileName: 'project_final.zip',
        fileSize: '2.4 MB'
      }
    ]
  };

  // Initialize WhatsApp application
  function initWhatsApp() {
    // Load conversations
    loadConversations();
    
    // Initialize emoji picker
    initEmojiPicker();
    
    // Setup event listeners
    setupEventListeners();
    
    // Set user profile
    document.getElementById('profileName').textContent = currentUser.name;
    document.getElementById('profileAvatar').src = currentUser.avatar;
    
    // Check for dark mode preference
    const darkMode = localStorage.getItem('whatsappDarkMode');
    if (darkMode === 'true') {
      document.body.classList.add('dark-mode');
    }
    
    // Load last active chat
    const lastChatId = localStorage.getItem('lastActiveChat');
    if (lastChatId) {
      const chat = sampleConversations.find(c => c.id === lastChatId);
      if (chat) {
        openChat(chat);
      }
    }
  }

  // Load conversations list
  function loadConversations() {
    const list = document.getElementById('conversationsList');
    list.innerHTML = '';
    
    sampleConversations.forEach(conv => {
      const convElement = createConversationElement(conv);
      list.appendChild(convElement);
    });
    
    conversations = sampleConversations;
  }

  // Create conversation element
  function createConversationElement(conversation) {
    const div = document.createElement('div');
    div.className = 'conversation-item';
    div.dataset.chatId = conversation.id;
    
    const onlineClass = conversation.isOnline ? 'online' : '';
    const statusIcon = getStatusIcon(conversation.lastMessageStatus);
    
    div.innerHTML = `
      <img src="${conversation.userAvatar}" class="conversation-avatar ${onlineClass}" alt="${conversation.userName}">
      <div class="conversation-info">
        <div class="conversation-header">
          <div class="conversation-name">${conversation.userName}</div>
          <div class="conversation-time">${conversation.lastMessageTime}</div>
        </div>
        <div class="conversation-preview">
          <div class="conversation-message">${conversation.lastMessage}</div>
          <div class="message-status ${conversation.lastMessageStatus}">${statusIcon}</div>
          ${conversation.unreadCount > 0 ? `<div class="unread-badge">${conversation.unreadCount}</div>` : ''}
        </div>
      </div>
    `;
    
    div.addEventListener('click', () => openChat(conversation));
    return div;
  }

  // Get status icon for message
  function getStatusIcon(status) {
    switch(status) {
      case 'sent':
        return '<i class="fas fa-check"></i>';
      case 'delivered':
        return '<i class="fas fa-check-double"></i>';
      case 'read':
        return '<i class="fas fa-check-double" style="color: #53bdeb"></i>';
      default:
        return '';
    }
  }

  // Open chat
  function openChat(conversation) {
    currentChat = conversation;
    messages = sampleMessages[conversation.id] || [];
    
    // Update UI
    document.getElementById('emptyChat').style.display = 'none';
    document.getElementById('chatHeader').style.display = 'flex';
    document.getElementById('messagesContainer').style.display = 'flex';
    document.getElementById('messageInputContainer').style.display = 'flex';
    
    // Update chat header
    document.getElementById('chatUserName').textContent = conversation.userName;
    document.getElementById('chatUserAvatar').src = conversation.userAvatar;
    document.getElementById('chatUserStatus').textContent = conversation.status;
    
    if (conversation.isOnline) {
      document.getElementById('chatUserAvatar').classList.add('online');
    } else {
      document.getElementById('chatUserAvatar').classList.remove('online');
    }
    
    // Show back button on mobile
    if (window.innerWidth <= 768) {
      document.getElementById('backButton').style.display = 'block';
      document.getElementById('sidebar').classList.remove('active');
    }
    
    // Clear unread count
    const convItem = document.querySelector(`[data-chat-id="${conversation.id}"]`);
    if (convItem) {
      const unreadBadge = convItem.querySelector('.unread-badge');
      if (unreadBadge) {
        unreadBadge.remove();
      }
    }
    
    // Load messages
    loadMessages();
    
    // Save last active chat
    localStorage.setItem('lastActiveChat', conversation.id);
    
    // Mark conversation as read
    conversation.unreadCount = 0;
  }

  // Load messages for current chat
  function loadMessages() {
    const container = document.getElementById('messagesContainer');
    const messagesList = container.querySelector('.messages-list') || (() => {
      const div = document.createElement('div');
      div.className = 'messages-list';
      container.appendChild(div);
      return div;
    })();
    
    messagesList.innerHTML = '';
    
    messages.forEach(msg => {
      const messageElement = createMessageElement(msg);
      messagesList.appendChild(messageElement);
    });
    
    // Scroll to bottom
    setTimeout(() => {
      container.scrollTop = container.scrollHeight;
      updateScrollButton();
    }, 100);
  }

  // Create message element
  function createMessageElement(message) {
    const wrapper = document.createElement('div');
    wrapper.className = `message-wrapper ${message.isSent ? 'sent' : 'received'}`;
    wrapper.dataset.messageId = message.id;
    
    const bubbleClass = message.isSent ? 'sent' : 'received';
    const statusIcon = getStatusIcon(message.status);
    
    let content = '';
    if (message.type === 'text') {
      content = `<div class="message-text">${message.text}</div>`;
    } else if (message.type === 'voice') {
      content = `
        <div class="voice-note-player">
          <button class="voice-play-btn" onclick="playVoiceNote('${message.id}')">
            <i class="fas fa-play" id="play-icon-${message.id}"></i>
          </button>
          <div class="voice-waveform">
            <div class="voice-wave"></div>
            <div class="voice-progress" id="progress-${message.id}"></div>
          </div>
          <div class="voice-duration" id="duration-${message.id}">${message.duration || '0:30'}</div>
        </div>
      `;
    } else if (message.type === 'file') {
      content = `
        <div class="file-preview">
          <i class="fas fa-file-alt file-icon"></i>
          <div class="file-info">
            <div class="file-name">${message.fileName}</div>
            <div class="file-size">${message.fileSize}</div>
          </div>
        </div>
      `;
    }
    
    wrapper.innerHTML = `
      <div class="message-bubble ${bubbleClass}">
        <div class="message-content">
          ${content}
          <div class="message-meta">
            <span class="message-time">${message.time}</span>
            ${message.isSent ? `<span class="read-receipt ${message.status}">${statusIcon}</span>` : ''}
          </div>
        </div>
      </div>
    `;
    
    // Add context menu
    wrapper.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      showContextMenu(e, message);
    });
    
    wrapper.addEventListener('click', (e) => {
      if (e.button === 0) { // Left click
        hideContextMenu();
      }
    });
    
    return wrapper;
  }

  // Send message
  function sendMessage() {
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    
    if (!text && !isRecording) {
      toggleVoiceRecording();
      return;
    }
    
    if (text) {
      const newMessage = {
        id: 'msg' + Date.now(),
        senderId: 'user1',
        senderName: 'You',
        text: text,
        time: getCurrentTime(),
        status: 'sent',
        isSent: true,
        type: 'text'
      };
      
      // Add to messages
      messages.push(newMessage);
      
      // Add to UI
      const container = document.getElementById('messagesContainer');
      const messagesList = container.querySelector('.messages-list');
      const messageElement = createMessageElement(newMessage);
      messagesList.appendChild(messageElement);
      
      // Clear input
      input.value = '';
      input.style.height = 'auto';
      
      // Scroll to bottom
      container.scrollTop = container.scrollHeight;
      updateScrollButton();
      
      // Play message tone
      playMessageTone();
      
      // Simulate reply after 1 second
      setTimeout(() => {
        simulateReply();
      }, 1000);
      
      // Update message status after 2 seconds
      setTimeout(() => {
        updateMessageStatus(newMessage.id, 'delivered');
      }, 2000);
      
      // Update message status to read after 3 seconds
      setTimeout(() => {
        updateMessageStatus(newMessage.id, 'read');
      }, 3000);
    }
  }

  // Simulate reply from other user
  function simulateReply() {
    if (!currentChat) return;
    
    const replies = [
      "Sounds good!",
      "I'll check that",
      "Thanks for letting me know",
      "See you then!",
      "That's great news!",
      "Can we discuss this tomorrow?",
      "I agree with you",
      "Let me think about it",
      "I'll get back to you",
      "Perfect timing!"
    ];
    
    const randomReply = replies[Math.floor(Math.random() * replies.length)];
    
    const replyMessage = {
      id: 'msg' + Date.now(),
      senderId: currentChat.userId,
      senderName: currentChat.userName,
      text: randomReply,
      time: getCurrentTime(),
      status: 'read',
      isSent: false,
      type: 'text'
    };
    
    // Add to messages
    messages.push(replyMessage);
    
    // Add to UI
    const container = document.getElementById('messagesContainer');
    const messagesList = container.querySelector('.messages-list');
    const messageElement = createMessageElement(replyMessage);
    messagesList.appendChild(messageElement);
    
    // Scroll to bottom
    container.scrollTop = container.scrollHeight;
    updateScrollButton();
    
    // Play message tone for received message
    playMessageTone();
    
    // Update conversation last message
    updateConversationLastMessage(randomReply);
  }

  // Update message status
  function updateMessageStatus(messageId, status) {
    const message = messages.find(m => m.id === messageId);
    if (message) {
      message.status = status;
      
      // Update UI
      const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
      if (messageElement) {
        const statusElement = messageElement.querySelector('.read-receipt');
        if (statusElement) {
          statusElement.className = `read-receipt ${status}`;
          statusElement.innerHTML = getStatusIcon(status);
        }
      }
    }
  }

  // Update conversation last message
  function updateConversationLastMessage(message) {
    if (!currentChat) return;
    
    currentChat.lastMessage = message.length > 30 ? message.substring(0, 30) + '...' : message;
    currentChat.lastMessageTime = 'Just now';
    
    // Update conversation in list
    const convElement = document.querySelector(`[data-chat-id="${currentChat.id}"]`);
    if (convElement) {
      const messageElement = convElement.querySelector('.conversation-message');
      const timeElement = convElement.querySelector('.conversation-time');
      
      if (messageElement) messageElement.textContent = currentChat.lastMessage;
      if (timeElement) timeElement.textContent = currentChat.lastMessageTime;
    }
  }

  // Toggle voice recording
  function toggleVoiceRecording() {
    if (!isRecording) {
      startVoiceRecording();
    } else {
      stopVoiceRecording();
    }
  }

  // Start voice recording
  async function startVoiceRecording() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];
      
      mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          audioChunks.push(event.data);
        }
      };
      
      mediaRecorder.onstop = () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
        sendVoiceMessage(audioBlob);
        
        // Stop all tracks
        stream.getTracks().forEach(track => track.stop());
      };
      
      // Start recording
      mediaRecorder.start();
      isRecording = true;
      
      // Show recording UI
      document.getElementById('inputWrapper').style.display = 'none';
      document.getElementById('voiceRecordingUI').style.display = 'flex';
      document.getElementById('voiceButtonIcon').className = 'fas fa-stop';
      
      // Start timer
      recordingStartTime = Date.now();
      updateRecordingTimer();
      recordingTimer = setInterval(updateRecordingTimer, 1000);
      
    } catch (error) {
      console.error('Error accessing microphone:', error);
      alert('Cannot access microphone. Please check permissions.');
    }
  }

  // Stop voice recording
  function stopVoiceRecording() {
    if (mediaRecorder && isRecording) {
      mediaRecorder.stop();
      isRecording = false;
      
      // Hide recording UI
      document.getElementById('inputWrapper').style.display = 'flex';
      document.getElementById('voiceRecordingUI').style.display = 'none';
      document.getElementById('voiceButtonIcon').className = 'fas fa-microphone';
      
      // Clear timer
      if (recordingTimer) {
        clearInterval(recordingTimer);
        recordingTimer = null;
      }
    }
  }

  // Cancel recording
  function cancelRecording() {
    if (mediaRecorder && isRecording) {
      mediaRecorder.stop();
      isRecording = false;
      
      // Hide recording UI
      document.getElementById('inputWrapper').style.display = 'flex';
      document.getElementById('voiceRecordingUI').style.display = 'none';
      document.getElementById('voiceButtonIcon').className = 'fas fa-microphone';
      
      // Clear timer
      if (recordingTimer) {
        clearInterval(recordingTimer);
        recordingTimer = null;
      }
    }
  }

  // Update recording timer
  function updateRecordingTimer() {
    if (!recordingStartTime) return;
    
    const elapsed = Date.now() - recordingStartTime;
    const minutes = Math.floor(elapsed / 60000);
    const seconds = Math.floor((elapsed % 60000) / 1000);
    
    document.getElementById('recordingTimer').textContent = 
      `${minutes}:${seconds.toString().padStart(2, '0')}`;
  }

  // Send voice message
  function sendVoiceMessage(audioBlob) {
    if (!currentChat) return;
    
    const duration = Math.floor((Date.now() - recordingStartTime) / 1000);
    const durationStr = `0:${duration.toString().padStart(2, '0')}`;
    
    const voiceMessage = {
      id: 'voice' + Date.now(),
      senderId: 'user1',
      senderName: 'You',
      time: getCurrentTime(),
      status: 'sent',
      isSent: true,
      type: 'voice',
      duration: durationStr,
      audioBlob: audioBlob
    };
    
    // Add to messages
    messages.push(voiceMessage);
    
    // Add to UI
    const container = document.getElementById('messagesContainer');
    const messagesList = container.querySelector('.messages-list');
    const messageElement = createMessageElement(voiceMessage);
    messagesList.appendChild(messageElement);
    
    // Scroll to bottom
    container.scrollTop = container.scrollHeight;
    updateScrollButton();
    
    // Play message tone
    playMessageTone();
    
    // Update conversation last message
    updateConversationLastMessage('Voice message');
    
    // Simulate voice reply after 2 seconds
    setTimeout(() => {
      simulateVoiceReply();
    }, 2000);
  }

  // Simulate voice reply
  function simulateVoiceReply() {
    if (!currentChat) return;
    
    const voiceReply = {
      id: 'voice' + Date.now(),
      senderId: currentChat.userId,
      senderName: currentChat.userName,
      time: getCurrentTime(),
      status: 'read',
      isSent: false,
      type: 'voice',
      duration: '0:15'
    };
    
    // Add to messages
    messages.push(voiceReply);
    
    // Add to UI
    const container = document.getElementById('messagesContainer');
    const messagesList = container.querySelector('.messages-list');
    const messageElement = createMessageElement(voiceReply);
    messagesList.appendChild(messageElement);
    
    // Scroll to bottom
    container.scrollTop = container.scrollHeight;
    updateScrollButton();
    
    // Play message tone
    playMessageTone();
    
    // Update conversation last message
    updateConversationLastMessage('Voice message');
  }

  // Play voice note
  function playVoiceNote(messageId) {
    const message = messages.find(m => m.id === messageId);
    if (!message) return;
    
    const playIcon = document.getElementById(`play-icon-${messageId}`);
    const progressBar = document.getElementById(`progress-${messageId}`);
    const durationDisplay = document.getElementById(`duration-${messageId}`);
    
    if (currentlyPlayingAudio && currentlyPlayingAudio.id === messageId) {
      // Pause current audio
      if (currentlyPlayingAudio.audio.paused) {
        currentlyPlayingAudio.audio.play();
        playIcon.className = 'fas fa-pause';
      } else {
        currentlyPlayingAudio.audio.pause();
        playIcon.className = 'fas fa-play';
      }
    } else {
      // Stop any currently playing audio
      if (currentlyPlayingAudio) {
        currentlyPlayingAudio.audio.pause();
        const oldPlayIcon = document.getElementById(`play-icon-${currentlyPlayingAudio.id}`);
        if (oldPlayIcon) oldPlayIcon.className = 'fas fa-play';
        const oldProgressBar = document.getElementById(`progress-${currentlyPlayingAudio.id}`);
        if (oldProgressBar) oldProgressBar.style.width = '0%';
      }
      
      // Create and play audio
      const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3');
      currentlyPlayingAudio = { audio, id: messageId };
      
      audio.play();
      playIcon.className = 'fas fa-pause';
      
      // Simulate progress
      let progress = 0;
      const duration = 15; // 15 seconds for demo
      const interval = setInterval(() => {
        progress += (100 / duration) / 10;
        if (progressBar) progressBar.style.width = `${progress}%`;
        
        if (progress >= 100) {
          clearInterval(interval);
          playIcon.className = 'fas fa-play';
          progressBar.style.width = '0%';
          currentlyPlayingAudio = null;
        }
      }, 100);
      
      audio.onended = () => {
        clearInterval(interval);
        playIcon.className = 'fas fa-play';
        if (progressBar) progressBar.style.width = '0%';
        currentlyPlayingAudio = null;
      };
    }
  }

  // Initialize emoji picker
  function initEmojiPicker() {
    const header = document.getElementById('emojiHeader');
    const content = document.getElementById('emojiContent');
    
    // Add category buttons
    Object.keys(emojiCategories).forEach((category, index) => {
      const button = document.createElement('button');
      button.className = 'emoji-category-btn';
      button.innerHTML = emojiCategories[category][0];
      button.title = category;
      
      if (index === 0) button.classList.add('active');
      
      button.addEventListener('click', () => {
        // Remove active class from all buttons
        document.querySelectorAll('.emoji-category-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        // Add active class to clicked button
        button.classList.add('active');
        
        // Load emojis for this category
        loadEmojis(category);
      });
      
      header.appendChild(button);
    });
    
    // Load first category
    loadEmojis(Object.keys(emojiCategories)[0]);
  }

  // Load emojis for category
  function loadEmojis(category) {
    const content = document.getElementById('emojiContent');
    content.innerHTML = '';
    
    emojiCategories[category].forEach(emoji => {
      const div = document.createElement('div');
      div.className = 'emoji-item';
      div.innerHTML = emoji;
      div.title = emoji;
      
      div.addEventListener('click', () => {
        insertEmoji(emoji);
      });
      
      content.appendChild(div);
    });
  }

  // Insert emoji into message input
  function insertEmoji(emoji) {
    const input = document.getElementById('messageInput');
    const start = input.selectionStart;
    const end = input.selectionEnd;
    
    input.value = input.value.substring(0, start) + emoji + input.value.substring(end);
    input.focus();
    input.selectionStart = input.selectionEnd = start + emoji.length;
    
    // Adjust textarea height
    input.style.height = 'auto';
    input.style.height = input.scrollHeight + 'px';
  }

  // Toggle emoji picker
  function toggleEmojiPicker() {
    const picker = document.getElementById('emojiPicker');
    if (picker.style.display === 'flex') {
      picker.style.display = 'none';
      emojiPickerVisible = false;
    } else {
      picker.style.display = 'flex';
      emojiPickerVisible = true;
      positionEmojiPicker();
    }
  }

  // Position emoji picker
  function positionEmojiPicker() {
    const picker = document.getElementById('emojiPicker');
    const inputContainer = document.getElementById('messageInputContainer');
    
    const rect = inputContainer.getBoundingClientRect();
    picker.style.left = '20px';
    picker.style.bottom = (window.innerHeight - rect.top + 10) + 'px';
  }

  // Show context menu
  function showContextMenu(event, message) {
    contextMenuMessage = message;
    
    const menu = document.getElementById('contextMenu');
    menu.style.display = 'block';
    menu.style.left = event.clientX + 'px';
    menu.style.top = event.clientY + 'px';
    
    // Hide menu when clicking elsewhere
    setTimeout(() => {
      document.addEventListener('click', hideContextMenu);
    }, 100);
  }

  // Hide context menu
  function hideContextMenu() {
    const menu = document.getElementById('contextMenu');
    menu.style.display = 'none';
    document.removeEventListener('click', hideContextMenu);
  }

  // Reply to message
  function replyToMessage() {
    if (!contextMenuMessage) return;
    
    replyToMessage = contextMenuMessage;
    
    const preview = document.getElementById('replyPreview');
    const name = document.getElementById('replyName');
    const text = document.getElementById('replyText');
    
    name.textContent = `Replying to ${contextMenuMessage.senderName}`;
    text.textContent = contextMenuMessage.text || 'Voice message';
    
    preview.style.display = 'flex';
    hideContextMenu();
    
    // Focus message input
    document.getElementById('messageInput').focus();
  }

  // Cancel reply
  function cancelReply() {
    replyToMessage = null;
    document.getElementById('replyPreview').style.display = 'none';
  }

  // Copy message
  function copyMessage() {
    if (!contextMenuMessage) return;
    
    navigator.clipboard.writeText(contextMenuMessage.text || '')
      .then(() => {
        console.log('Message copied to clipboard');
      })
      .catch(err => {
        console.error('Failed to copy: ', err);
      });
    
    hideContextMenu();
  }

  // Forward message
  function forwardMessage() {
    alert('Forward message functionality would open contact selection');
    hideContextMenu();
  }

  // Star message
  function starMessage() {
    alert('Message starred');
    hideContextMenu();
  }

  // Delete message
  function deleteMessage() {
    if (!contextMenuMessage) return;
    
    if (confirm('Delete this message?')) {
      // Remove from messages array
      const index = messages.findIndex(m => m.id === contextMenuMessage.id);
      if (index !== -1) {
        messages.splice(index, 1);
      }
      
      // Remove from UI
      const messageElement = document.querySelector(`[data-message-id="${contextMenuMessage.id}"]`);
      if (messageElement) {
        messageElement.remove();
      }
    }
    
    hideContextMenu();
  }

  // Attach file
  function attachFile() {
    document.getElementById('fileInput').click();
  }

  // Handle file selection
  document.getElementById('fileInput').addEventListener('change', function(e) {
    const files = Array.from(e.target.files);
    
    files.forEach(file => {
      const fileMessage = {
        id: 'file' + Date.now(),
        senderId: 'user1',
        senderName: 'You',
        time: getCurrentTime(),
        status: 'sent',
        isSent: true,
        type: 'file',
        fileName: file.name,
        fileSize: formatFileSize(file.size)
      };
      
      // Add to messages
      messages.push(fileMessage);
      
      // Add to UI
      const container = document.getElementById('messagesContainer');
      const messagesList = container.querySelector('.messages-list');
      const messageElement = createMessageElement(fileMessage);
      messagesList.appendChild(messageElement);
      
      // Scroll to bottom
      container.scrollTop = container.scrollHeight;
      updateScrollButton();
      
      // Play message tone
      playMessageTone();
      
      // Update conversation last message
      updateConversationLastMessage(file.name);
    });
    
    // Reset file input
    e.target.value = '';
  });

  // Format file size
  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    
    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
  }

  // Get current time
  function getCurrentTime() {
    const now = new Date();
    let hours = now.getHours();
    let minutes = now.getMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    
    hours = hours % 12;
    hours = hours ? hours : 12;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    
    return `${hours}:${minutes} ${ampm}`;
  }

  // Play message tone
  function playMessageTone() {
    const tone = document.getElementById('messageTone');
    tone.currentTime = 0;
    tone.play().catch(e => console.log('Audio play failed:', e));
  }

  // Play ringtone
  function playRingtone() {
    const ringtone = document.getElementById('ringtone');
    ringtone.currentTime = 0;
    ringtone.play().catch(e => console.log('Ringtone play failed:', e));
  }

  // Stop ringtone
  function stopRingtone() {
    const ringtone = document.getElementById('ringtone');
    ringtone.pause();
    ringtone.currentTime = 0;
  }

  // Start video call
  function startVideoCall() {
    alert('Video call functionality would be implemented here');
    playRingtone();
  }

  // Start voice call
  function startVoiceCall() {
    alert('Voice call functionality would be implemented here');
    playRingtone();
  }

  // Open new chat
  function openNewChat() {
    alert('New chat functionality would open contact selection');
  }

  // Toggle profile menu
  function toggleProfileMenu() {
    alert('Profile menu would open settings and options');
  }

  // Toggle chat menu
  function toggleChatMenu() {
    alert('Chat menu would open chat settings and options');
  }

  // Update scroll button visibility
  function updateScrollButton() {
    const container = document.getElementById('messagesContainer');
    const button = document.getElementById('scrollBottomBtn');
    
    if (container.scrollHeight - container.scrollTop - container.clientHeight > 100) {
      button.style.display = 'flex';
    } else {
      button.style.display = 'none';
    }
  }

  // Scroll to bottom
  function scrollToBottom() {
    const container = document.getElementById('messagesContainer');
    container.scrollTop = container.scrollHeight;
    document.getElementById('scrollBottomBtn').style.display = 'none';
  }

  // Setup event listeners
  function setupEventListeners() {
    // Message input auto-resize
    const messageInput = document.getElementById('messageInput');
    messageInput.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 100) + 'px';
    });
    
    // Send message on Enter (without Shift)
    messageInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    
    // Toggle voice/send button
    messageInput.addEventListener('input', function() {
      const sendButton = document.getElementById('sendButton');
      const voiceIcon = document.getElementById('voiceButtonIcon');
      
      if (this.value.trim()) {
        voiceIcon.className = 'fas fa-paper-plane';
        sendButton.onclick = sendMessage;
      } else {
        voiceIcon.className = 'fas fa-microphone';
        sendButton.onclick = toggleVoiceRecording;
      }
    });
    
    // Scroll events
    const messagesContainer = document.getElementById('messagesContainer');
    messagesContainer.addEventListener('scroll', updateScrollButton);
    
    // Scroll to bottom button
    document.getElementById('scrollBottomBtn').addEventListener('click', scrollToBottom);
    
    // Back button for mobile
    document.getElementById('backButton').addEventListener('click', function() {
      document.getElementById('sidebar').classList.add('active');
      document.getElementById('chatHeader').style.display = 'none';
      document.getElementById('messagesContainer').style.display = 'none';
      document.getElementById('messageInputContainer').style.display = 'none';
      document.getElementById('emptyChat').style.display = 'flex';
      currentChat = null;
    });
    
    // Close emoji picker when clicking outside
    document.addEventListener('click', function(e) {
      const picker = document.getElementById('emojiPicker');
      const emojiButton = document.querySelector('.input-action .fa-smile');
      
      if (picker.style.display === 'flex' && 
          !picker.contains(e.target) && 
          !emojiButton.contains(e.target)) {
        picker.style.display = 'none';
        emojiPickerVisible = false;
      }
    });
    
    // Search conversations
    const searchInput = document.getElementById('chatSearch');
    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const items = document.querySelectorAll('.conversation-item');
      
      items.forEach(item => {
        const name = item.querySelector('.conversation-name').textContent.toLowerCase();
        const message = item.querySelector('.conversation-message').textContent.toLowerCase();
        
        if (name.includes(searchTerm) || message.includes(searchTerm)) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
      if (emojiPickerVisible) {
        positionEmojiPicker();
      }
      updateScrollButton();
      
      // Hide back button on desktop
      if (window.innerWidth > 768) {
        document.getElementById('backButton').style.display = 'none';
      }
    });
    
    // Handle mobile sidebar toggle
    if (window.innerWidth <= 768) {
      document.getElementById('sidebar').classList.add('active');
    }
  }

  // Initialize on load
  window.addEventListener('load', initWhatsApp);
</script>
</body>
</html>
