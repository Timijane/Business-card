<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MEET | Professional Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #0080FF;
    --primary-dark: #0066CC;
    --bg-color: #f0f2f5;
    --card-bg: #fff;
    --text-color: #111;
    --secondary-text: #65676b;
    --border-color: #dddfe2;
    --error: #EF4444;
    --success: #10B981;
    --warning: #F59E0B;
    --app-height: 100dvh;
    --chat-font: 'Poppins', sans-serif;
    --sent-bubble-bg: #0080FF;
    --sent-text-color: #fff;
    --received-bubble-bg: #fff;
    --received-text-color: #111;
    --shadow-light: 0 2px 10px rgba(0,0,0,0.05);
    --shadow-medium: 0 4px 15px rgba(0,128,255,0.2);
    --shadow-heavy: 0 10px 40px rgba(0,0,0,0.2);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: var(--chat-font);
    background: var(--bg-color);
    color: var(--text-color);
    height: var(--app-height);
    overflow: hidden;
  }

  .app-container {
    display: flex;
    height: var(--app-height);
  }

  /* Sidebar Styles */
  .sidebar {
    width: 260px;
    background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    display: flex;
    flex-direction: column;
    position: fixed;
    height: var(--app-height);
    z-index: 1000;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    box-shadow: var(--shadow-heavy);
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .sidebar-header {
    padding: 25px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .sidebar-header h2 {
    font-size: 28px;
    font-weight: 700;
  }

  .sidebar-menu {
    list-style: none;
    padding: 20px 0;
    flex: 1;
  }

  .sidebar-menu li {
    margin: 5px 0;
  }

  .sidebar-menu a {
    color: rgba(255,255,255,0.9);
    text-decoration: none;
    padding: 15px 25px;
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 16px;
    font-weight: 500;
    transition: all 0.2s ease;
    border-left: 4px solid transparent;
  }

  .sidebar-menu a:hover {
    background: rgba(255,255,255,0.1);
    color: white;
  }

  .sidebar-menu a.active {
    background: rgba(255,255,255,0.15);
    color: white;
    border-left-color: white;
  }

  .sidebar-menu i {
    font-size: 18px;
    width: 24px;
    text-align: center;
  }

  .sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 999;
    display: none;
    backdrop-filter: blur(3px);
  }

  /* Navbar Styles */
  .navbar {
    height: 70px;
    background: var(--card-bg);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 25px;
    box-shadow: var(--shadow-light);
    z-index: 100;
    position: relative;
  }

  .navbar-left, .navbar-right {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .hamburger-btn {
    background: none;
    border: none;
    font-size: 22px;
    color: var(--text-color);
    cursor: pointer;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .hamburger-btn:hover {
    background: var(--bg-color);
  }

  .nav-user-img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--primary);
  }

  .nav-user-name {
    font-weight: 500;
    font-size: 15px;
  }

  .btn {
    background: var(--bg-color);
    border: none;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-color);
    font-size: 18px;
    transition: all 0.2s ease;
  }

  .btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
  }

  /* Main Content */
  .main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: var(--app-height);
  }

  /* Chat Container */
  .chat-container {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  /* Conversations Sidebar */
  .conversations-sidebar {
    width: 350px;
    background: var(--card-bg);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-header {
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border-color);
  }

  .chat-header h3 {
    font-size: 20px;
    font-weight: 600;
  }

  .new-chat-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    border: none;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .new-chat-btn:hover {
    background: var(--primary-dark);
    transform: rotate(90deg);
  }

  .chat-search {
    padding: 15px 20px;
    border-bottom: 1px solid var(--border-color);
  }

  .chat-search input {
    width: 100%;
    padding: 12px 20px;
    border: 1px solid var(--border-color);
    border-radius: 25px;
    font-family: var(--chat-font);
    font-size: 14px;
    background: var(--bg-color);
    color: var(--text-color);
    outline: none;
    transition: all 0.2s ease;
  }

  .chat-search input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0,128,255,0.1);
  }

  .conversations-list {
    flex: 1;
    overflow-y: auto;
    padding: 10px 0;
  }

  .conversation-item {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    gap: 15px;
    cursor: pointer;
    transition: all 0.2s ease;
    border-bottom: 1px solid var(--border-color);
  }

  .conversation-item:hover {
    background: var(--bg-color);
  }

  .conversation-item.active {
    background: rgba(0,128,255,0.1);
    border-left: 4px solid var(--primary);
  }

  .conversation-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--primary);
  }

  .conversation-info {
    flex: 1;
    min-width: 0;
  }

  .conversation-name {
    font-weight: 600;
    font-size: 15px;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .conversation-preview {
    font-size: 13px;
    color: var(--secondary-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .conversation-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 5px;
  }

  .conversation-time {
    font-size: 12px;
    color: var(--secondary-text);
  }

  .unread-badge {
    background: var(--primary);
    color: white;
    font-size: 12px;
    min-width: 20px;
    height: 20px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 6px;
  }

  /* Chat Area */
  .chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;
  }

  .empty-chat {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px;
    color: var(--secondary-text);
  }

  .empty-chat i {
    font-size: 80px;
    margin-bottom: 20px;
    color: var(--border-color);
  }

  .empty-chat h3 {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--text-color);
  }

  .empty-chat p {
    font-size: 15px;
    max-width: 400px;
    line-height: 1.6;
  }

  /* Chat Area Header */
  .chat-area-header {
    height: 70px;
    background: var(--card-bg);
    border-bottom: 1px solid var(--border-color);
    display: none;
    align-items: center;
    padding: 0 25px;
    gap: 15px;
  }

  .chat-user-info {
    flex: 1;
  }

  .chat-user-name {
    font-weight: 600;
    font-size: 17px;
    margin-bottom: 2px;
  }

  .chat-user-status {
    font-size: 13px;
    color: var(--secondary-text);
  }

  .chat-actions {
    display: flex;
    gap: 10px;
  }

  .chat-action-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--bg-color);
    border: none;
    color: var(--text-color);
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .chat-action-btn:hover {
    background: var(--primary);
    color: white;
  }

  /* Messages Container */
  .messages-container {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: none;
    flex-direction: column;
    gap: 10px;
    background: var(--bg-color);
    background-size: cover;
    background-position: center;
  }

  /* Message Bubbles */
  .message-bubble {
    max-width: 60%;
    padding: 12px 16px;
    border-radius: 18px;
    position: relative;
    word-wrap: break-word;
    line-height: 1.4;
  }

  .message-bubble.sent {
    background: var(--sent-bubble-bg);
    color: var(--sent-text-color);
    align-self: flex-end;
    border-bottom-right-radius: 4px;
  }

  .message-bubble.received {
    background: var(--received-bubble-bg);
    color: var(--received-text-color);
    align-self: flex-start;
    border-bottom-left-radius: 4px;
    box-shadow: var(--shadow-light);
  }

  .message-text {
    font-size: 15px;
  }

  .message-time {
    font-size: 11px;
    opacity: 0.7;
    text-align: right;
    margin-top: 5px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 4px;
  }

  .received .message-time {
    color: var(--secondary-text);
  }

  .message-status {
    font-size: 10px;
  }

  /* Image Message */
  .image-message {
    border-radius: 15px;
    overflow: hidden;
    max-width: 300px;
    cursor: pointer;
    transition: transform 0.2s ease;
  }

  .image-message:hover {
    transform: scale(1.02);
  }

  .image-message img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Typing Indicator */
  .typing-indicator {
    padding: 15px 25px;
    background: var(--card-bg);
    border-top: 1px solid var(--border-color);
    display: none;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    color: var(--secondary-text);
  }

  .typing-indicator span:nth-child(2) {
    animation: typing 1.4s infinite;
    animation-delay: 0.2s;
  }

  .typing-indicator span:nth-child(3) {
    animation: typing 1.4s infinite;
    animation-delay: 0.4s;
  }

  .typing-indicator span:nth-child(4) {
    animation: typing 1.4s infinite;
    animation-delay: 0.6s;
  }

  @keyframes typing {
    0%, 100% { opacity: 0.2; }
    50% { opacity: 1; }
  }

  /* Message Input */
  .message-input-container {
    background: var(--card-bg);
    border-top: 1px solid var(--border-color);
    padding: 15px 25px;
    display: none;
  }

  .reply-preview-bar {
    background: var(--bg-color);
    border-left: 4px solid var(--primary);
    padding: 10px 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 15px;
  }

  .reply-preview-content {
    flex: 1;
  }

  .reply-name {
    font-weight: 600;
    font-size: 13px;
    color: var(--primary);
    display: block;
    margin-bottom: 2px;
  }

  .reply-text {
    font-size: 13px;
    color: var(--secondary-text);
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .writing-assist-bar {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }

  .assist-chip {
    background: var(--bg-color);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: 8px 15px;
    font-size: 13px;
    font-family: var(--chat-font);
    color: var(--text-color);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
  }

  .assist-chip:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .message-input-wrapper {
    display: flex;
    align-items: flex-end;
    gap: 10px;
    background: var(--bg-color);
    border-radius: 25px;
    padding: 5px 5px 5px 20px;
  }

  .message-input-actions {
    display: flex;
    gap: 5px;
    margin-right: 5px;
  }

  .input-action {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: transparent;
    border: none;
    color: var(--secondary-text);
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .input-action:hover {
    background: rgba(0,128,255,0.1);
    color: var(--primary);
  }

  .magic-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white !important;
  }

  .magic-btn:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%) !important;
  }

  .message-input {
    flex: 1;
    border: none;
    background: transparent;
    font-family: var(--chat-font);
    font-size: 15px;
    color: var(--text-color);
    resize: none;
    max-height: 120px;
    min-height: 40px;
    padding: 10px 0;
    outline: none;
  }

  .send-button {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    border: none;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .send-button:hover {
    background: var(--primary-dark);
    transform: rotate(30deg);
  }

  /* Emoji Picker */
  .emoji-picker {
    position: absolute;
    bottom: 85px;
    left: 25px;
    width: 350px;
    height: 350px;
    background: var(--card-bg);
    border-radius: 15px;
    box-shadow: var(--shadow-heavy);
    display: none;
    flex-direction: column;
    overflow: hidden;
    z-index: 100;
  }

  .emoji-header {
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .emoji-tab {
    padding: 8px 15px;
    border: none;
    background: var(--bg-color);
    border-radius: 10px;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .emoji-tab:hover {
    background: var(--primary);
    color: white;
  }

  .emoji-content {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 10px;
  }

  .emoji-item {
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .emoji-item:hover {
    background: var(--bg-color);
    transform: scale(1.2);
  }

  /* Modals */
  .settings-modal,
  .user-search-overlay,
  .wallpaper-modal,
  .wallpaper-preview-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
    padding: 20px;
  }

  .modal-content {
    background: var(--card-bg);
    border-radius: 20px;
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: var(--shadow-heavy);
  }

  .modal-header {
    padding: 25px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-header h3 {
    font-size: 20px;
    font-weight: 600;
  }

  .modal-body {
    padding: 25px;
    overflow-y: auto;
    max-height: 60vh;
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--secondary-text);
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .modal-close:hover {
    background: var(--bg-color);
    color: var(--text-color);
  }

  /* Settings Options */
  .settings-option {
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.2s ease;
  }

  .settings-option:hover {
    background: var(--bg-color);
  }

  .option-info {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .option-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
  }

  .option-text h4 {
    font-weight: 600;
    margin-bottom: 2px;
  }

  .option-text p {
    font-size: 13px;
    color: var(--secondary-text);
  }

  .option-switch {
    width: 50px;
    height: 26px;
    background: var(--border-color);
    border-radius: 13px;
    position: relative;
    cursor: pointer;
  }

  .option-switch.active {
    background: var(--success);
  }

  .option-switch::after {
    content: '';
    position: absolute;
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 50%;
    top: 2px;
    left: 2px;
    transition: transform 0.2s ease;
  }

  .option-switch.active::after {
    transform: translateX(24px);
  }

  /* Conversation Options Menu */
  .conversation-options-menu {
    position: fixed;
    background: var(--card-bg);
    border-radius: 15px;
    box-shadow: var(--shadow-heavy);
    min-width: 200px;
    z-index: 1000;
    display: none;
    overflow: hidden;
  }

  .msg-option-item {
    padding: 15px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .msg-option-item:hover {
    background: var(--bg-color);
  }

  .msg-option-item i {
    width: 20px;
    text-align: center;
  }

  /* === WEBRTC CALL INTERFACE STYLES === */
  .call-interface {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 3000;
    display: none;
    flex-direction: column;
  }

  .call-active .call-interface {
    display: flex;
  }

  .video-container {
    flex: 1;
    display: flex;
    position: relative;
    overflow: hidden;
  }

  .local-video-container {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 120px;
    height: 160px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    z-index: 10;
    border: 2px solid var(--primary);
  }

  .remote-video-container {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #000;
    position: relative;
  }

  .video-element {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .local-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transform: scaleX(-1); /* Mirror local video */
  }

  .remote-video-wrapper {
    position: relative;
    width: 90%;
    height: 90%;
    max-width: 1200px;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0,128,255,0.3);
  }

  .call-controls {
    position: absolute;
    bottom: 30px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 20px;
    padding: 20px;
    z-index: 20;
  }

  .call-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    transition: all 0.2s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }

  .call-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
  }

  .end-call-btn {
    background: var(--error);
    color: white;
  }

  .mute-btn {
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    color: white;
  }

  .mute-btn.active {
    background: var(--error);
  }

  .video-toggle-btn {
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    color: white;
  }

  .video-toggle-btn.active {
    background: var(--error);
  }

  .call-info {
    position: absolute;
    top: 30px;
    left: 30px;
    color: white;
    z-index: 10;
    backdrop-filter: blur(10px);
    padding: 15px 25px;
    border-radius: 12px;
    background: rgba(0,0,0,0.5);
  }

  .caller-name {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 5px;
  }

  .call-status {
    font-size: 14px;
    opacity: 0.8;
  }

  /* Shy chat overlay during call */
  .shy-chat-overlay {
    position: absolute;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 12px 20px;
    border-radius: 12px;
    max-width: 80%;
    backdrop-filter: blur(10px);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 15;
    text-align: center;
    font-size: 16px;
    border: 1px solid rgba(255,255,255,0.2);
  }

  .shy-chat-overlay.visible {
    opacity: 1;
  }

  /* Call incoming modal */
  .incoming-call-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 4000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
  }

  .incoming-call-modal.active {
    display: flex;
  }

  .call-modal-content {
    background: var(--card-bg);
    border-radius: 24px;
    padding: 40px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    animation: modalSlideIn 0.3s ease;
  }

  .caller-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    margin: 0 auto 20px;
    border: 4px solid var(--primary);
    object-fit: cover;
  }

  .caller-info h3 {
    font-size: 24px;
    margin-bottom: 10px;
    color: var(--text-color);
  }

  .call-type {
    color: var(--secondary-text);
    margin-bottom: 30px;
    font-size: 16px;
  }

  .call-actions {
    display: flex;
    gap: 20px;
    justify-content: center;
  }

  .accept-call-btn {
    background: var(--success);
    color: white;
    border: none;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 24px;
    transition: all 0.2s ease;
  }

  .decline-call-btn {
    background: var(--error);
    color: white;
    border: none;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 24px;
    transition: all 0.2s ease;
  }

  .accept-call-btn:hover,
  .decline-call-btn:hover {
    transform: scale(1.1);
  }

  /* Voice message recording */
  .voice-message-container {
    display: none;
    position: absolute;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--card-bg);
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    z-index: 100;
    min-width: 300px;
    text-align: center;
    border: 1px solid var(--border-color);
  }

  .voice-message-container.recording {
    display: block;
  }

  .recording-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    margin-bottom: 15px;
  }

  .recording-dot {
    width: 12px;
    height: 12px;
    background: var(--error);
    border-radius: 50%;
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .recording-timer {
    font-size: 16px;
    font-weight: 600;
    color: var(--text-color);
  }

  .recording-controls {
    display: flex;
    gap: 15px;
    justify-content: center;
  }

  .stop-recording-btn {
    background: var(--error);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.2s ease;
  }

  .cancel-recording-btn {
    background: var(--secondary-text);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.2s ease;
  }

  .stop-recording-btn:hover,
  .cancel-recording-btn:hover {
    transform: scale(1.1);
  }

  /* Audio message styling */
  .audio-message {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 15px;
    background: var(--bg-color);
    border-radius: 20px;
    max-width: 250px;
  }

  .audio-message.sent {
    background: var(--primary);
    color: white;
  }

  .audio-controls {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .play-pause-btn {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    font-size: 18px;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
  }

  .play-pause-btn:hover {
    background: rgba(255,255,255,0.1);
  }

  .audio-progress {
    flex: 1;
    height: 4px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
    overflow: hidden;
  }

  .audio-progress-bar {
    height: 100%;
    background: white;
    width: 0%;
    transition: width 0.1s linear;
  }

  .audio-duration {
    font-size: 12px;
    opacity: 0.8;
    min-width: 40px;
  }

  /* Call shy chat input */
  .call-chat-input {
    position: absolute;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    display: none;
    gap: 10px;
    z-index: 20;
  }

  .call-active .call-chat-input {
    display: flex;
  }

  .call-chat-input input {
    padding: 12px 20px;
    border-radius: 25px;
    border: none;
    background: rgba(255,255,255,0.1);
    color: white;
    backdrop-filter: blur(10px);
    width: 300px;
    font-size: 14px;
    outline: none;
  }

  .call-chat-input input::placeholder {
    color: rgba(255,255,255,0.7);
  }

  .call-chat-send-btn {
    background: var(--primary);
    color: white;
    border: none;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.2s ease;
  }

  .call-chat-send-btn:hover {
    background: var(--primary-dark);
    transform: scale(1.1);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .conversations-sidebar {
      width: 100%;
      position: absolute;
      z-index: 10;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    
    .conversations-sidebar.active {
      transform: translateX(0);
    }
    
    .sidebar {
      width: 280px;
    }
    
    .local-video-container {
      width: 80px;
      height: 120px;
      top: 10px;
      right: 10px;
    }

    .call-btn {
      width: 50px;
      height: 50px;
      font-size: 18px;
    }

    .call-info {
      top: 15px;
      left: 15px;
      padding: 10px 15px;
    }

    .caller-name {
      font-size: 18px;
    }

    .call-chat-input {
      width: 90%;
      bottom: 100px;
    }

    .call-chat-input input {
      width: 100%;
    }

    .remote-video-wrapper {
      width: 100%;
      height: 100%;
      border-radius: 0;
    }
    
    .emoji-picker {
      width: 300px;
      left: 50%;
      transform: translateX(-50%);
    }
  }

  @media (max-width: 480px) {
    .navbar {
      padding: 0 15px;
    }
    
    .chat-area-header {
      padding: 0 15px;
    }
    
    .message-input-container {
      padding: 15px;
    }
    
    .call-modal-content {
      padding: 30px 20px;
    }
    
    .voice-message-container {
      min-width: 250px;
    }
  }

  /* Animation */
  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Dark Mode */
  body.dark-mode {
    --bg-color: #0f172a;
    --card-bg: #1e293b;
    --text-color: #f1f5f9;
    --secondary-text: #94a3b8;
    --border-color: #334155;
    --received-bubble-bg: #334155;
    --received-text-color: #f1f5f9;
  }

  /* Loading Spinner */
  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(0,128,255,0.3);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 1s linear infinite;
    margin: 20px auto;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>
</head>
<body>
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<div class="app-container">
  <!-- Sidebar -->
  <div class="sidebar" id="mainSidebar">
    <div class="sidebar-header">
      <h2>MEET</h2>
      <button class="sidebar-close-btn"><i class="fas fa-times"></i></button>
    </div>
    <ul class="sidebar-menu">
      <li><a href="feed.html"><i class="fas fa-home"></i> <span>Feed</span></a></li>
      <li><a href="profile.html"><i class="fas fa-user"></i> <span>Profile</span></a></li>
      <li><a href="chat.html" class="active"><i class="fas fa-comment"></i> <span>Chat</span></a></li>
      <li><a href="conference.html"><i class="fas fa-video"></i> <span>Conference</span></a></li>
      <li><a href="meetrader.html"><i class="fas fa-store"></i> <span>Meetrader</span></a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Navbar -->
    <div class="navbar">
      <div class="navbar-left">
        <button class="hamburger-btn"><i class="fas fa-bars"></i></button>
        <h2 style="font-weight:600; font-size:22px;">Chat</h2>
      </div>
      <div class="navbar-right">
        <img src="https://via.placeholder.com/40" id="navUserImg" class="nav-user-img" alt="Me">
        <span id="navUserName" class="nav-user-name"></span>
        <button class="btn" id="nightToggleBtn"><i class="fas fa-moon"></i></button>
        <button class="btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
      </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container">
      <!-- Conversations sidebar -->
      <div class="conversations-sidebar" id="conversationsSidebar">
        <div class="chat-header">
          <h3>Messages</h3>
          <button class="new-chat-btn"><i class="fas fa-plus"></i></button>
        </div>
        <div class="chat-search">
          <input type="text" placeholder="Search chats..." id="chatSearch">
        </div>
        <div class="conversations-list" id="conversationsList">
          <!-- Conversations will be loaded here -->
          <div class="conversation-item" data-chat-id="1" data-user-id="2" data-user-name="John Doe" data-user-avatar="https://via.placeholder.com/50">
            <img src="https://via.placeholder.com/50" class="conversation-avatar">
            <div class="conversation-info">
              <div class="conversation-name">John Doe</div>
              <div class="conversation-preview">Hello there! How are you doing?</div>
            </div>
            <div class="conversation-meta">
              <div class="conversation-time">10:30 AM</div>
              <div class="unread-badge">3</div>
            </div>
          </div>
          <div class="conversation-item" data-chat-id="2" data-user-id="3" data-user-name="Jane Smith" data-user-avatar="https://via.placeholder.com/50">
            <img src="https://via.placeholder.com/50" class="conversation-avatar">
            <div class="conversation-info">
              <div class="conversation-name">Jane Smith</div>
              <div class="conversation-preview">Meeting tomorrow at 2 PM</div>
            </div>
            <div class="conversation-meta">
              <div class="conversation-time">Yesterday</div>
            </div>
          </div>
          <div class="conversation-item" data-chat-id="3" data-user-id="4" data-user-name="Mike Johnson" data-user-avatar="https://via.placeholder.com/50">
            <img src="https://via.placeholder.com/50" class="conversation-avatar">
            <div class="conversation-info">
              <div class="conversation-name">Mike Johnson</div>
              <div class="conversation-preview">Thanks for your help with the project!</div>
            </div>
            <div class="conversation-meta">
              <div class="conversation-time">Monday</div>
              <div class="unread-badge">1</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Area -->
      <div class="chat-area" id="chatArea">
        <!-- Empty chat state -->
        <div id="emptyChat" class="empty-chat">
          <i class="far fa-comments"></i>
          <h3>Select a conversation</h3>
          <p>Choose a contact to start chatting and stay connected with your network</p>
        </div>

        <!-- Chat header with call buttons -->
        <div class="chat-area-header" id="chatHeader">
          <button class="chat-action-btn" id="backButton"><i class="fas fa-arrow-left"></i></button>
          <img src="https://via.placeholder.com/50" id="currentChatAvatar" class="conversation-avatar">
          <div class="chat-user-info">
            <div class="chat-user-name" id="chatUserName">User</div>
            <div class="chat-user-status">Last seen recently</div>
          </div>
          <div class="chat-actions">
            <button class="chat-action-btn" id="settingsBtn"><i class="fas fa-sliders-h"></i></button>
            <button class="chat-action-btn" id="voiceCallBtn"><i class="fas fa-phone-alt"></i></button>
            <button class="chat-action-btn" id="videoCallBtn"><i class="fas fa-video"></i></button>
            <button class="chat-action-btn" id="wallpaperBtn"><i class="fas fa-image"></i></button>
            <button class="chat-action-btn" id="voiceMessageBtn"><i class="fas fa-microphone"></i></button>
          </div>
        </div>

        <!-- Messages container -->
        <div class="messages-container" id="messagesContainer">
          <!-- Messages will appear here -->
          <div class="message-bubble received">
            <div class="message-text">Hello! How can I help you today?</div>
            <div class="message-time">10:25 AM</div>
          </div>
          <div class="message-bubble sent">
            <div class="message-text">Hi! I need some information about the new project</div>
            <div class="message-time">10:26 AM âœ“</div>
          </div>
        </div>

        <!-- Typing indicator -->
        <div class="typing-indicator" id="typingIndicator">
          <span id="typingUserName">User</span> is typing <span>.</span><span>.</span><span>.</span>
        </div>

        <!-- Message input container with voice message button -->
        <div class="message-input-container" id="messageInputContainer">
          <!-- Reply preview -->
          <div class="reply-preview-bar" id="replyPreview">
            <div class="reply-preview-content">
              <span class="reply-name" id="replyName">Replying to User</span>
              <span class="reply-text" id="replyText">Message text...</span>
            </div>
            <button id="cancelReplyBtn">&times;</button>
          </div>
          
          <!-- Writing assist -->
          <div class="writing-assist-bar" id="assistBar">
            <button class="assist-chip" id="fixGrammarBtn"><i class="fas fa-spell-check"></i> Fix Grammar</button>
            <button class="assist-chip" id="makeFormalBtn"><i class="fas fa-user-tie"></i> Make Formal</button>
            <button class="assist-chip" id="expandTextBtn"><i class="fas fa-expand-alt"></i> Expand Text</button>
          </div>

          <div class="message-input-wrapper">
            <div class="message-input-actions">
              <button class="input-action magic-btn" id="magicBtn"><i class="fas fa-magic"></i></button>
              <button class="input-action" id="emojiBtn"><i class="far fa-smile"></i></button>
              <input type="file" id="imageInputHidden" accept="image/*" style="display:none">
              <input type="file" id="videoInputHidden" accept="video/*" style="display:none">
              <button class="input-action" id="imageBtn"><i class="fas fa-image"></i></button>
              <button class="input-action" id="videoBtn"><i class="fas fa-video"></i></button>
              <button class="input-action" id="voiceMsgToggleBtn"><i class="fas fa-microphone"></i></button>
            </div>
            <textarea class="message-input" id="messageInput" placeholder="Type a message..." rows="1" spellcheck="true"></textarea>
            <button class="send-button" id="sendButton"><i class="fas fa-paper-plane"></i></button>
          </div>
          
          <!-- Emoji picker -->
          <div class="emoji-picker" id="emojiPicker">
            <div class="emoji-header" id="emojiNav"></div>
            <div class="emoji-content" id="emojiContent"></div>
          </div>
        </div>

        <!-- Voice message recording UI -->
        <div class="voice-message-container" id="voiceMessageContainer">
          <div class="recording-indicator">
            <div class="recording-dot"></div>
            <div class="recording-timer" id="recordingTimer">00:00</div>
          </div>
          <div class="recording-controls">
            <button class="cancel-recording-btn" id="cancelRecordingBtn">
              <i class="fas fa-times"></i>
            </button>
            <button class="stop-recording-btn" id="stopRecordingBtn">
              <i class="fas fa-stop"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- WebRTC Call Interface -->
<div class="call-interface" id="callInterface">
  <div class="video-container">
    <div class="local-video-container">
      <video id="localVideo" class="local-video" autoplay muted playsinline></video>
    </div>
    
    <div class="remote-video-container">
      <div class="remote-video-wrapper">
        <video id="remoteVideo" class="video-element" autoplay playsinline></video>
        <!-- Shy chat overlay -->
        <div class="shy-chat-overlay" id="shyChatOverlay"></div>
      </div>
    </div>

    <!-- Call info -->
    <div class="call-info">
      <div class="caller-name" id="callUserName"></div>
      <div class="call-status" id="callStatus">Connecting...</div>
    </div>

    <!-- Call controls -->
    <div class="call-controls">
      <button class="call-btn mute-btn" id="muteBtn">
        <i class="fas fa-microphone"></i>
      </button>
      <button class="call-btn video-toggle-btn" id="videoToggleBtn">
        <i class="fas fa-video"></i>
      </button>
      <button class="call-btn end-call-btn" id="endCallBtn">
        <i class="fas fa-phone"></i>
      </button>
    </div>

    <!-- Shy chat input during call -->
    <div class="call-chat-input">
      <input type="text" id="callChatInput" placeholder="Type a message to appear on screen...">
      <button class="call-chat-send-btn" id="callChatSendBtn">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>

<!-- Incoming Call Modal -->
<div class="incoming-call-modal" id="incomingCallModal">
  <div class="call-modal-content">
    <img src="https://via.placeholder.com/100" class="caller-avatar" id="callerAvatar" alt="Caller">
    <div class="caller-info">
      <h3 id="incomingCallerName">John Doe</h3>
      <div class="call-type" id="incomingCallType">Video Call</div>
    </div>
    <div class="call-actions">
      <button class="decline-call-btn" id="declineCallBtn">
        <i class="fas fa-phone-slash"></i>
      </button>
      <button class="accept-call-btn" id="acceptCallBtn">
        <i class="fas fa-phone"></i>
      </button>
    </div>
  </div>
</div>

<!-- Modals -->
<!-- Conversation Context Menu -->
<div class="conversation-options-menu" id="conversationOptionsMenu">
  <div class="msg-option-item" id="deleteConversationBtn"><i class="fas fa-trash-alt"></i> Delete Conversation</div>
</div>

<!-- Settings Modal -->
<div class="settings-modal" id="settingsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Chat Settings</h3>
      <button class="modal-close" id="closeSettingsBtn">&times;</button>
    </div>
    <div class="modal-body">
      <div class="settings-option" id="darkModeOption">
        <div class="option-info">
          <div class="option-icon">
            <i class="fas fa-moon"></i>
          </div>
          <div class="option-text">
            <h4>Dark Mode</h4>
            <p>Switch between light and dark themes</p>
          </div>
        </div>
        <div class="option-switch" id="darkModeSwitch"></div>
      </div>
      <div class="settings-option" id="clearChatOption">
        <div class="option-info">
          <div class="option-icon">
            <i class="fas fa-trash"></i>
          </div>
          <div class="option-text">
            <h4>Clear Chat</h4>
            <p>Delete all messages in this conversation</p>
          </div>
        </div>
      </div>
      <div class="settings-option" id="changeWallpaperOption">
        <div class="option-info">
          <div class="option-icon">
            <i class="fas fa-image"></i>
          </div>
          <div class="option-text">
            <h4>Change Wallpaper</h4>
            <p>Set a custom background for this chat</p>
          </div>
        </div>
      </div>
      <div class="settings-option" id="notificationsOption">
        <div class="option-info">
          <div class="option-icon">
            <i class="fas fa-bell"></i>
          </div>
          <div class="option-text">
            <h4>Notifications</h4>
            <p>Enable or disable message notifications</p>
          </div>
        </div>
        <div class="option-switch active" id="notificationsSwitch"></div>
      </div>
    </div>
  </div>
</div>

<!-- User Search Modal -->
<div class="user-search-overlay" id="userSearchOverlay">
  <div class="modal-content">
    <div class="modal-header">
      <h3>New Conversation</h3>
      <button class="modal-close" id="closeUserSearchBtn">&times;</button>
    </div>
    <div class="modal-body">
      <div class="chat-search" style="padding:0 0 20px 0;">
        <input type="text" placeholder="Search users..." id="userSearchInput">
      </div>
      <div id="searchResults">
        <!-- Users will be listed here -->
        <div class="conversation-item" data-user-id="5" data-user-name="Sarah Wilson" data-user-avatar="https://via.placeholder.com/50">
          <img src="https://via.placeholder.com/50" class="conversation-avatar">
          <div class="conversation-info">
            <div class="conversation-name">Sarah Wilson</div>
            <div class="conversation-preview">Product Manager</div>
          </div>
        </div>
        <div class="conversation-item" data-user-id="6" data-user-name="David Brown" data-user-avatar="https://via.placeholder.com/50">
          <img src="https://via.placeholder.com/50" class="conversation-avatar">
          <div class="conversation-info">
            <div class="conversation-name">David Brown</div>
            <div class="conversation-preview">UX Designer</div>
          </div>
        </div>
        <div class="conversation-item" data-user-id="7" data-user-name="Emily Davis" data-user-avatar="https://via.placeholder.com/50">
          <img src="https://via.placeholder.com/50" class="conversation-avatar">
          <div class="conversation-info">
            <div class="conversation-name">Emily Davis</div>
            <div class="conversation-preview">Software Engineer</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Wallpaper Modal -->
<div class="wallpaper-modal" id="wallpaperModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Choose Wallpaper</h3>
      <button class="modal-close" id="closeWallpaperBtn">&times;</button>
    </div>
    <div class="modal-body">
      <div class="wallpaper-grid" id="wallpaperGrid">
        <!-- Wallpapers will be loaded here -->
      </div>
    </div>
  </div>
</div>

<!-- Wallpaper Preview Modal -->
<div class="wallpaper-preview-overlay" id="wpPreviewOverlay">
  <div class="modal-content" style="max-width:800px;">
    <div class="modal-header">
      <h3>Preview Wallpaper</h3>
      <button class="modal-close" id="closeWallpaperPreviewBtn">&times;</button>
    </div>
    <div class="modal-body" style="padding:0;">
      <div id="wallpaperPreview" style="height:400px; background-size:cover; background-position:center;"></div>
      <div style="padding:20px; display:flex; gap:15px;">
        <button id="applyWallpaperBtn" style="flex:1; padding:15px; background:var(--primary); color:white; border:none; border-radius:10px; font-family:var(--chat-font); font-weight:600; cursor:pointer; transition:all 0.2s ease;">Apply</button>
        <button id="cancelWallpaperBtn" style="flex:1; padding:15px; background:var(--bg-color); color:var(--text-color); border:none; border-radius:10px; font-family:var(--chat-font); font-weight:600; cursor:pointer; transition:all 0.2s ease;">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script>
// Initialize all buttons and make them functional
document.addEventListener('DOMContentLoaded', function() {
    // Initialize conversation items
    initConversationItems();
    
    // Make the plus button open user search overlay
    const newChatBtn = document.querySelector('.new-chat-btn');
    if (newChatBtn) {
        newChatBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            openUserSearchOverlay();
        });
    }

    // Make sidebar toggle button work
    const hamburgerBtn = document.querySelector('.hamburger-btn');
    if (hamburgerBtn) {
        hamburgerBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleSidebar();
        });
    }

    // Make sidebar close button work
    const sidebarCloseBtn = document.querySelector('.sidebar-close-btn');
    if (sidebarCloseBtn) {
        sidebarCloseBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleSidebar();
        });
    }

    // Make chat action buttons work
    const settingsBtn = document.getElementById('settingsBtn');
    if (settingsBtn) {
        settingsBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            openSettingsModal();
        });
    }

    const voiceCallBtn = document.getElementById('voiceCallBtn');
    if (voiceCallBtn) {
        voiceCallBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            startVoiceCall();
        });
    }

    const videoCallBtn = document.getElementById('videoCallBtn');
    if (videoCallBtn) {
        videoCallBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            startVideoCall();
        });
    }

    const wallpaperBtn = document.getElementById('wallpaperBtn');
    if (wallpaperBtn) {
        wallpaperBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            openWallpaperModal();
        });
    }

    const voiceMessageBtn = document.getElementById('voiceMessageBtn');
    if (voiceMessageBtn) {
        voiceMessageBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleVoiceMessage();
        });
    }

    // Make magic button work
    const magicBtn = document.getElementById('magicBtn');
    if (magicBtn) {
        magicBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleAssistBar();
        });
    }

    // Make emoji button work
    const emojiBtn = document.getElementById('emojiBtn');
    if (emojiBtn) {
        emojiBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleEmojiPicker();
        });
    }

    // Make image upload button work
    const imageBtn = document.getElementById('imageBtn');
    if (imageBtn) {
        imageBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            document.getElementById('imageInputHidden').click();
        });
    }

    // Make video upload button work
    const videoBtn = document.getElementById('videoBtn');
    if (videoBtn) {
        videoBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            document.getElementById('videoInputHidden').click();
        });
    }

    // Make voice message toggle button work
    const voiceMsgToggleBtn = document.getElementById('voiceMsgToggleBtn');
    if (voiceMsgToggleBtn) {
        voiceMsgToggleBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleVoiceMessage();
        });
    }

    // Make assist chips work
    const fixGrammarBtn = document.getElementById('fixGrammarBtn');
    if (fixGrammarBtn) {
        fixGrammarBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            applyWritingAssist('fix');
        });
    }

    const makeFormalBtn = document.getElementById('makeFormalBtn');
    if (makeFormalBtn) {
        makeFormalBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            applyWritingAssist('formal');
        });
    }

    const expandTextBtn = document.getElementById('expandTextBtn');
    if (expandTextBtn) {
        expandTextBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            applyWritingAssist('expand');
        });
    }

    // Make send button work
    const sendBtn = document.getElementById('sendButton');
    if (sendBtn) {
        sendBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            sendMessage();
        });
    }

    // Make cancel reply button work
    const cancelReplyBtn = document.getElementById('cancelReplyBtn');
    if (cancelReplyBtn) {
        cancelReplyBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            cancelReply();
        });
    }

    // Make modal close buttons work
    const closeSettingsBtn = document.getElementById('closeSettingsBtn');
    if (closeSettingsBtn) {
        closeSettingsBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            closeSettingsModal();
        });
    }

    const closeUserSearchBtn = document.getElementById('closeUserSearchBtn');
    if (closeUserSearchBtn) {
        closeUserSearchBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            closeUserSearchOverlay();
        });
    }

    const closeWallpaperBtn = document.getElementById('closeWallpaperBtn');
    if (closeWallpaperBtn) {
        closeWallpaperBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            closeWallpaperModal();
        });
    }

    const closeWallpaperPreviewBtn = document.getElementById('closeWallpaperPreviewBtn');
    if (closeWallpaperPreviewBtn) {
        closeWallpaperPreviewBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            closeWallpaperPreview();
        });
    }

    // Make call action buttons work
    const endCallBtn = document.getElementById('endCallBtn');
    if (endCallBtn) {
        endCallBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            endCall();
        });
    }

    const muteBtn = document.getElementById('muteBtn');
    if (muteBtn) {
        muteBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleMute();
        });
    }

    const videoToggleBtn = document.getElementById('videoToggleBtn');
    if (videoToggleBtn) {
        videoToggleBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleVideo();
        });
    }

    // Make incoming call buttons work
    const acceptCallBtn = document.getElementById('acceptCallBtn');
    if (acceptCallBtn) {
        acceptCallBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            acceptIncomingCall();
        });
    }

    const declineCallBtn = document.getElementById('declineCallBtn');
    if (declineCallBtn) {
        declineCallBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            declineIncomingCall();
        });
    }

    // Make back button work
    const backBtn = document.getElementById('backButton');
    if (backBtn) {
        backBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            showEmptyChatState();
            
            if (window.innerWidth <= 768) {
                document.getElementById('conversationsSidebar').classList.add('active');
            }
        });
    }

    // Make logout button work
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', async function(e) {
            e.stopPropagation();
            try {
                // Simulate logout
                alert('Logout functionality would be implemented here');
            } catch (error) {
                console.error('Error signing out:', error);
            }
        });
    }

    // Make night mode toggle work
    const nightToggleBtn = document.getElementById('nightToggleBtn');
    if (nightToggleBtn) {
        nightToggleBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleDarkMode();
        });
    }

    // Make settings option buttons work
    const darkModeOption = document.getElementById('darkModeOption');
    if (darkModeOption) {
        darkModeOption.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleDarkMode();
        });
    }

    const clearChatOption = document.getElementById('clearChatOption');
    if (clearChatOption) {
        clearChatOption.addEventListener('click', function(e) {
            e.stopPropagation();
            clearChat();
        });
    }

    const changeWallpaperOption = document.getElementById('changeWallpaperOption');
    if (changeWallpaperOption) {
        changeWallpaperOption.addEventListener('click', function(e) {
            e.stopPropagation();
            changeWallpaper();
        });
    }

    const notificationsOption = document.getElementById('notificationsOption');
    if (notificationsOption) {
        notificationsOption.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleNotifications();
        });
    }

    // Make conversation options menu work
    const deleteConversationBtn = document.getElementById('deleteConversationBtn');
    if (deleteConversationBtn) {
        deleteConversationBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            deleteConversation();
        });
    }

    // Make voice recording buttons work
    const stopRecordingBtn = document.getElementById('stopRecordingBtn');
    if (stopRecordingBtn) {
        stopRecordingBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            stopVoiceRecording();
        });
    }

    const cancelRecordingBtn = document.getElementById('cancelRecordingBtn');
    if (cancelRecordingBtn) {
        cancelRecordingBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            cancelVoiceRecording();
        });
    }

    // Make call chat send button work
    const callChatSendBtn = document.getElementById('callChatSendBtn');
    if (callChatSendBtn) {
        callChatSendBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            sendShyChatMessage();
        });
    }

    // Make wallpaper buttons work
    const applyWallpaperBtn = document.getElementById('applyWallpaperBtn');
    if (applyWallpaperBtn) {
        applyWallpaperBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            applyWallpaper();
        });
    }

    const cancelWallpaperBtn = document.getElementById('cancelWallpaperBtn');
    if (cancelWallpaperBtn) {
        cancelWallpaperBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            closeWallpaperPreview();
        });
    }

    // Make sidebar overlay work
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    if (sidebarOverlay) {
        sidebarOverlay.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleSidebar();
        });
    }

    // Add click handlers to close modals when clicking outside
    document.addEventListener('click', function(e) {
        // Close modals when clicking outside
        const modals = document.querySelectorAll('.settings-modal, .user-search-overlay, .wallpaper-modal, .wallpaper-preview-overlay');
        modals.forEach(modal => {
            if (modal.style.display === 'flex' && e.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Close emoji picker when clicking outside
        const emojiPicker = document.getElementById('emojiPicker');
        if (emojiPicker && emojiPicker.style.display === 'flex' && 
            !emojiPicker.contains(e.target) && 
            !e.target.closest('#emojiBtn')) {
            emojiPicker.style.display = 'none';
        }
    });

    // Initialize user search items
    initUserSearchItems();

    // Initialize empty state
    showEmptyChatState();
});

// Function to initialize conversation items
function initConversationItems() {
    const conversationItems = document.querySelectorAll('.conversation-item');
    conversationItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.stopPropagation();
            const chatId = this.dataset.chatId;
            const userId = this.dataset.userId;
            const userName = this.dataset.userName;
            const userAvatar = this.dataset.userAvatar;
            if (chatId && userId) {
                openChat(chatId, userId, userName, userAvatar);
            }
        });
    });
}

// Function to initialize user search items
function initUserSearchItems() {
    const userSearchItems = document.querySelectorAll('#searchResults .conversation-item');
    userSearchItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.stopPropagation();
            const userId = this.dataset.userId;
            const userName = this.dataset.userName;
            const userAvatar = this.dataset.userAvatar;
            if (userId) {
                // Create a new chat with this user
                createNewChat(userId, userName, userAvatar);
                closeUserSearchOverlay();
            }
        });
    });
}

// Function to show empty chat state
function showEmptyChatState() {
    document.getElementById('emptyChat').style.display = 'flex';
    document.getElementById('chatHeader').style.display = 'none';
    document.getElementById('messagesContainer').style.display = 'none';
    document.getElementById('messageInputContainer').style.display = 'none';
}

// Function to toggle sidebar
function toggleSidebar() {
    const sidebar = document.getElementById('mainSidebar');
    const overlay = document.getElementById('sidebarOverlay');
    
    if (sidebar.classList.contains('active')) {
        sidebar.classList.remove('active');
        overlay.style.display = 'none';
    } else {
        sidebar.classList.add('active');
        overlay.style.display = 'block';
    }
}

// Function to open chat
function openChat(chatId, userId, userName, userAvatar) {
    // Set current chat info
    currentChatId = chatId;
    currentChatUser = userId;
    currentChatUserName = userName;
    currentChatUserAvatar = userAvatar;
    
    // Update UI
    document.getElementById('emptyChat').style.display = 'none';
    document.getElementById('chatHeader').style.display = 'flex';
    document.getElementById('messagesContainer').style.display = 'flex';
    document.getElementById('messageInputContainer').style.display = 'block';
    
    // Update header
    document.getElementById('chatUserName').textContent = userName;
    document.getElementById('currentChatAvatar').src = userAvatar || 'https://via.placeholder.com/50';
    
    // Update messages container with sample messages
    const messagesContainer = document.getElementById('messagesContainer');
    messagesContainer.innerHTML = `
        <div class="message-bubble received">
            <div class="message-text">Hello! How can I help you today?</div>
            <div class="message-time">10:25 AM</div>
        </div>
        <div class="message-bubble sent">
            <div class="message-text">Hi ${userName}! I need some information about the new project</div>
            <div class="message-time">10:26 AM âœ“</div>
        </div>
        <div class="message-bubble received">
            <div class="message-text">Sure! What would you like to know?</div>
            <div class="message-time">10:27 AM</div>
        </div>
    `;
    
    // On mobile, hide conversations sidebar
    if (window.innerWidth <= 768) {
        document.getElementById('conversationsSidebar').classList.remove('active');
    }
}

// Function to create new chat
function createNewChat(userId, userName, userAvatar) {
    // Simulate creating a new chat
    alert(`Creating new chat with ${userName}`);
    
    // In a real app, this would create a new chat in the database
    // For now, just open the chat
    openChat('new-' + Date.now(), userId, userName, userAvatar);
}

// Function to open user search overlay
function openUserSearchOverlay() {
    document.getElementById('userSearchOverlay').style.display = 'flex';
}

// Function to close user search overlay
function closeUserSearchOverlay() {
    document.getElementById('userSearchOverlay').style.display = 'none';
}

// Function to open settings modal
function openSettingsModal() {
    document.getElementById('settingsModal').style.display = 'flex';
}

// Function to close settings modal
function closeSettingsModal() {
    document.getElementById('settingsModal').style.display = 'none';
}

// Function to open wallpaper modal
function openWallpaperModal() {
    document.getElementById('wallpaperModal').style.display = 'flex';
    loadWallpapers();
}

// Function to close wallpaper modal
function closeWallpaperModal() {
    document.getElementById('wallpaperModal').style.display = 'none';
}

// Function to open wallpaper preview
function openWallpaperPreview() {
    document.getElementById('wpPreviewOverlay').style.display = 'flex';
}

// Function to close wallpaper preview
function closeWallpaperPreview() {
    document.getElementById('wpPreviewOverlay').style.display = 'none';
}

// Function to load wallpapers
function loadWallpapers() {
    const wallpaperGrid = document.getElementById('wallpaperGrid');
    wallpaperGrid.innerHTML = '';
    
    const wallpapers = [
        'https://images.unsplash.com/photo-1557683316-973673baf926?w=400',
        'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400',
        'https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=400',
        'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=400',
        'https://images.unsplash.com/photo-1465146344425-f00d5f5c8f07?w=400',
        'https://images.unsplash.com/photo-1439066615861-d1af74d74000?w=400'
    ];
    
    wallpapers.forEach((url, index) => {
        const wallpaperItem = document.createElement('div');
        wallpaperItem.style.cssText = `
            width: 100%;
            height: 150px;
            background-image: url(${url});
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-bottom: 15px;
        `;
        
        wallpaperItem.addEventListener('click', () => {
            selectedWallpaper = url;
            openWallpaperPreview();
            const preview = document.getElementById('wallpaperPreview');
            preview.style.backgroundImage = `url(${url})`;
        });
        
        wallpaperItem.addEventListener('mouseenter', () => {
            wallpaperItem.style.transform = 'scale(1.05)';
        });
        
        wallpaperItem.addEventListener('mouseleave', () => {
            wallpaperItem.style.transform = 'scale(1)';
        });
        
        wallpaperGrid.appendChild(wallpaperItem);
    });
}

// Function to apply wallpaper
function applyWallpaper() {
    if (selectedWallpaper) {
        const messagesContainer = document.getElementById('messagesContainer');
        messagesContainer.style.backgroundImage = `url(${selectedWallpaper})`;
        messagesContainer.style.backgroundSize = 'cover';
        messagesContainer.style.backgroundPosition = 'center';
        alert('Wallpaper applied successfully!');
    }
    closeWallpaperPreview();
    closeWallpaperModal();
}

// Function to toggle dark mode
function toggleDarkMode() {
    const body = document.body;
    const switchEl = document.getElementById('darkModeSwitch');
    
    if (body.classList.contains('dark-mode')) {
        body.classList.remove('dark-mode');
        switchEl.classList.remove('active');
        localStorage.setItem('darkMode', 'false');
    } else {
        body.classList.add('dark-mode');
        switchEl.classList.add('active');
        localStorage.setItem('darkMode', 'true');
    }
}

// Function to clear chat
function clearChat() {
    if (confirm('Are you sure you want to clear this chat? This action cannot be undone.')) {
        const messagesContainer = document.getElementById('messagesContainer');
        messagesContainer.innerHTML = '<div class="message-bubble received"><div class="message-text">Chat has been cleared. Start a new conversation!</div><div class="message-time">Just now</div></div>';
        closeSettingsModal();
    }
}

// Function to change wallpaper
function changeWallpaper() {
    closeSettingsModal();
    openWallpaperModal();
}

// Function to toggle notifications
function toggleNotifications() {
    const switchEl = document.getElementById('notificationsSwitch');
    switchEl.classList.toggle('active');
    alert('Notifications ' + (switchEl.classList.contains('active') ? 'enabled' : 'disabled'));
}

// Function to delete conversation
function deleteConversation() {
    if (confirm('Are you sure you want to delete this conversation? This action cannot be undone.')) {
        alert('Conversation deleted!');
        showEmptyChatState();
    }
}

// Function to send message
function sendMessage() {
    const messageInput = document.getElementById('messageInput');
    const text = messageInput.value.trim();
    if (!text) return;
    
    const messagesContainer = document.getElementById('messagesContainer');
    const messageElement = document.createElement('div');
    messageElement.className = 'message-bubble sent';
    messageElement.innerHTML = `
        <div class="message-text">${text}</div>
        <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} âœ“</div>
    `;
    
    messagesContainer.appendChild(messageElement);
    messageInput.value = '';
    
    // Auto-reply after 1 second
    setTimeout(() => {
        const replyElement = document.createElement('div');
        replyElement.className = 'message-bubble received';
        replyElement.innerHTML = `
            <div class="message-text">Thanks for your message! I'll get back to you soon.</div>
            <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
        `;
        messagesContainer.appendChild(replyElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }, 1000);
    
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// Function to cancel reply
function cancelReply() {
    document.getElementById('replyPreview').style.display = 'none';
}

// Function to apply writing assist
function applyWritingAssist(type) {
    const messageInput = document.getElementById('messageInput');
    let text = messageInput.value;
    
    if (!text) {
        text = "This is a sample text that will be improved by the writing assistant.";
    }
    
    switch(type) {
        case 'fix':
            text = text.charAt(0).toUpperCase() + text.slice(1);
            if (!text.endsWith('.')) text += '.';
            alert('Grammar has been fixed!');
            break;
        case 'formal':
            text = "Dear colleague,\n\n" + text + "\n\nBest regards.";
            alert('Text has been made formal!');
            break;
        case 'expand':
            text = text + " This additional text expands upon the original message to provide more detail and context for better understanding.";
            alert('Text has been expanded!');
            break;
    }
    
    messageInput.value = text;
    messageInput.focus();
}

// Function to toggle assist bar
function toggleAssistBar() {
    const assistBar = document.getElementById('assistBar');
    assistBar.style.display = assistBar.style.display === 'none' ? 'flex' : 'none';
}

// Function to toggle emoji picker
function toggleEmojiPicker() {
    const emojiPicker = document.getElementById('emojiPicker');
    emojiPicker.style.display = emojiPicker.style.display === 'none' ? 'flex' : 'none';
    
    if (emojiPicker.style.display === 'flex' && !emojiPicker.innerHTML) {
        loadEmojis();
    }
}

// Function to load emojis
function loadEmojis() {
    const emojiContent = document.getElementById('emojiContent');
    const emojiNav = document.getElementById('emojiNav');
    
    // Common emoji categories
    const emojiCategories = {
        'ðŸ˜€': ['ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ˜‚', 'ðŸ¤£', 'ðŸ˜Š', 'ðŸ˜‡'],
        'â¤ï¸': ['â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ', 'ðŸ–¤', 'ðŸ¤', 'ðŸ¤Ž', 'ðŸ’•'],
        'ðŸ‘': ['ðŸ‘', 'ðŸ‘Ž', 'ðŸ‘Œ', 'âœŒï¸', 'ðŸ¤ž', 'ðŸ¤Ÿ', 'ðŸ¤˜', 'ðŸ‘‹', 'ðŸ‘', 'ðŸ™Œ'],
        'ðŸ¶': ['ðŸ¶', 'ðŸ±', 'ðŸ­', 'ðŸ¹', 'ðŸ°', 'ðŸ¦Š', 'ðŸ»', 'ðŸ¼', 'ðŸ¨', 'ðŸ¯'],
        'ðŸ•': ['ðŸ•', 'ðŸ”', 'ðŸŸ', 'ðŸŒ­', 'ðŸ¿', 'ðŸ§‚', 'ðŸ¥“', 'ðŸ¥š', 'ðŸ³', 'ðŸ§‡']
    };
    
    emojiNav.innerHTML = '';
    emojiContent.innerHTML = '';
    
    // Create tabs
    Object.keys(emojiCategories).forEach((category, index) => {
        const tab = document.createElement('button');
        tab.className = 'emoji-tab';
        tab.textContent = category;
        tab.onclick = () => {
            // Scroll to category
            const categoryStart = index * emojiCategories[category].length;
            // Implementation would scroll to specific category
        };
        emojiNav.appendChild(tab);
    });
    
    // Add all emojis
    Object.values(emojiCategories).flat().forEach(emoji => {
        const emojiItem = document.createElement('div');
        emojiItem.className = 'emoji-item';
        emojiItem.textContent = emoji;
        emojiItem.onclick = () => {
            const messageInput = document.getElementById('messageInput');
            messageInput.value += emoji;
            messageInput.focus();
        };
        emojiContent.appendChild(emojiItem);
    });
}

// WebRTC functions
function startVoiceCall() {
    alert('Starting voice call with ' + currentChatUserName);
    // Show call interface
    document.body.classList.add('call-active');
    document.getElementById('callUserName').textContent = currentChatUserName;
    document.getElementById('callStatus').textContent = 'Calling...';
}

function startVideoCall() {
    alert('Starting video call with ' + currentChatUserName);
    // Show call interface
    document.body.classList.add('call-active');
    document.getElementById('callUserName').textContent = currentChatUserName;
    document.getElementById('callStatus').textContent = 'Calling...';
}

function endCall() {
    document.body.classList.remove('call-active');
    alert('Call ended');
}

function toggleMute() {
    const muteBtn = document.getElementById('muteBtn');
    muteBtn.classList.toggle('active');
    alert('Microphone ' + (muteBtn.classList.contains('active') ? 'muted' : 'unmuted'));
}

function toggleVideo() {
    const videoToggleBtn = document.getElementById('videoToggleBtn');
    videoToggleBtn.classList.toggle('active');
    alert('Video ' + (videoToggleBtn.classList.contains('active') ? 'disabled' : 'enabled'));
}

function acceptIncomingCall() {
    document.getElementById('incomingCallModal').classList.remove('active');
    document.body.classList.add('call-active');
    document.getElementById('callUserName').textContent = document.getElementById('incomingCallerName').textContent;
    document.getElementById('callStatus').textContent = 'Connected';
    alert('Call accepted');
}

function declineIncomingCall() {
    document.getElementById('incomingCallModal').classList.remove('active');
    alert('Call declined');
}

function sendShyChatMessage() {
    const callChatInput = document.getElementById('callChatInput');
    const message = callChatInput.value.trim();
    if (message) {
        const shyChatOverlay = document.getElementById('shyChatOverlay');
        shyChatOverlay.textContent = 'You: ' + message;
        shyChatOverlay.classList.add('visible');
        callChatInput.value = '';
        
        setTimeout(() => {
            shyChatOverlay.classList.remove('visible');
        }, 3000);
    }
}

// Voice message functions
let recordingInterval = null;
let recordingSeconds = 0;

function toggleVoiceMessage() {
    const voiceMessageContainer = document.getElementById('voiceMessageContainer');
    if (voiceMessageContainer.classList.contains('recording')) {
        stopVoiceRecording();
    } else {
        startVoiceRecording();
    }
}

function startVoiceRecording() {
    recordingSeconds = 0;
    const voiceMessageContainer = document.getElementById('voiceMessageContainer');
    voiceMessageContainer.classList.add('recording');
    
    recordingInterval = setInterval(() => {
        recordingSeconds++;
        const minutes = Math.floor(recordingSeconds / 60).toString().padStart(2, '0');
        const seconds = (recordingSeconds % 60).toString().padStart(2, '0');
        document.getElementById('recordingTimer').textContent = `${minutes}:${seconds}`;
    }, 1000);
    
    alert('Voice recording started. Click stop to send or cancel to discard.');
}

function stopVoiceRecording() {
    clearInterval(recordingInterval);
    const voiceMessageContainer = document.getElementById('voiceMessageContainer');
    voiceMessageContainer.classList.remove('recording');
    
    // Add voice message to chat
    const messagesContainer = document.getElementById('messagesContainer');
    const messageElement = document.createElement('div');
    messageElement.className = 'audio-message sent';
    messageElement.innerHTML = `
        <div class="audio-controls">
            <button class="play-pause-btn"><i class="fas fa-play"></i></button>
            <div class="audio-progress">
                <div class="audio-progress-bar" style="width: 0%"></div>
            </div>
            <span class="audio-duration">${Math.floor(recordingSeconds / 60).toString().padStart(2, '0')}:${(recordingSeconds % 60).toString().padStart(2, '0')}</span>
        </div>
    `;
    
    messagesContainer.appendChild(messageElement);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    
    alert('Voice message sent!');
}

function cancelVoiceRecording() {
    clearInterval(recordingInterval);
    const voiceMessageContainer = document.getElementById('voiceMessageContainer');
    voiceMessageContainer.classList.remove('recording');
    alert('Voice recording cancelled');
}

// Initialize dark mode from localStorage
if (localStorage.getItem('darkMode') === 'true') {
    document.body.classList.add('dark-mode');
    document.getElementById('darkModeSwitch').classList.add('active');
}

// Make Enter key send message
document.getElementById('messageInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});

// Make Enter key send shy chat message
document.getElementById('callChatInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendShyChatMessage();
    }
});

// Auto-resize textarea
document.getElementById('messageInput').addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});

// Initialize with sample incoming call after 3 seconds
setTimeout(() => {
    // Uncomment to test incoming call
    // document.getElementById('incomingCallModal').classList.add('active');
    // document.getElementById('incomingCallerName').textContent = 'John Doe';
    // document.getElementById('incomingCallType').textContent = 'Video Call';
}, 3000);
</script>
</body>
</html>
