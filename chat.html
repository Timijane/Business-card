<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MEET â€” Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  /* Your existing CSS remains the same, just adding this fix */
  
  /* Fix for message input area - prevent click propagation */
  .message-input-container,
  .messages-container,
  .chat-area-header {
    pointer-events: auto;
  }
  
  /* Ensure these elements don't trigger navigation */
  .message-input-wrapper,
  .message-input,
  .send-button,
  .message-bubble,
  .message-text {
    pointer-events: auto !important;
  }
</style>
</head>
<body>

<!-- Your existing HTML structure remains the same until the script section -->

<script>
// FIXED Navigation function - more reliable
function navigateTo(page) {
  // Prevent navigation if already on the page
  const currentPage = window.location.pathname.split('/').pop();
  if (currentPage === page) {
    console.log('Already on', page);
    return;
  }
  
  // Use full page navigation to ensure complete reload
  window.location.href = page;
}

// Dark mode toggle and other existing code remains the same...

// Initialize chat
function initChat() {
  renderConversations();
  setupEventListeners();
  
  // Check if mobile and adjust layout
  checkMobileLayout();
  
  // Load first conversation by default on desktop
  if (!isMobile && mockConversations.length > 0) {
    loadConversation(mockConversations[0].id);
  }
}

// Setup event listeners - FIXED VERSION
function setupEventListeners() {
  const messageInput = document.getElementById('messageInput');
  const sendButton = document.getElementById('sendButton');
  
  // Send message on button click
  sendButton.addEventListener('click', sendMessage);
  
  // Send message on Enter key (but allow Shift+Enter for new line)
  messageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
    
    // Auto-resize textarea
    messageInput.style.height = 'auto';
    messageInput.style.height = Math.min(messageInput.scrollHeight, 150) + 'px';
  });
  
  // New chat button
  document.getElementById('newChatBtn').addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    alert('New chat feature would open a modal to start conversation with new contacts');
  });
  
  // Back button for mobile - FIXED with proper event handling
  document.getElementById('backButton').addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    showConversationsView();
  });
  
  // Go Live button
  document.getElementById('goLive').addEventListener('click', goLive);
  
  // AI mode toggle
  document.getElementById('aiModeToggle').addEventListener('click', toggleAIMode);
  
  // Window resize handler
  window.addEventListener('resize', checkMobileLayout);
  
  // FIXED: Enhanced click prevention for chat area
  const chatArea = document.getElementById('chatArea');
  const messageInputContainer = document.getElementById('messageInputContainer');
  const messagesContainer = document.getElementById('messagesContainer');
  
  // Prevent any clicks in these areas from bubbling up
  [chatArea, messageInputContainer, messagesContainer].forEach(element => {
    if (element) {
      element.addEventListener('click', (e) => {
        e.stopPropagation();
      });
    }
  });
  
  // Specifically protect the input area
  const messageInputEl = document.getElementById('messageInput');
  if (messageInputEl) {
    messageInputEl.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  }
  
  // FIXED: Profile navigation - use proper event listeners instead of onclick
  const profileButton = document.querySelector('aside button[onclick*="profile.html"]');
  if (profileButton) {
    // Remove the existing onclick and replace with proper event listener
    profileButton.removeAttribute('onclick');
    profileButton.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      navigateTo('profile.html');
    });
  }
  
  // FIXED: Chat navigation
  const chatButton = document.querySelector('aside button[onclick*="chat.html"]');
  if (chatButton) {
    chatButton.removeAttribute('onclick');
    chatButton.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      // Only navigate if we're not already on chat page
      const currentPage = window.location.pathname.split('/').pop();
      if (currentPage !== 'chat.html') {
        navigateTo('chat.html');
      }
    });
  }
  
  // Add similar protection for other navigation buttons
  const navButtons = document.querySelectorAll('aside button');
  navButtons.forEach(button => {
    const onclickAttr = button.getAttribute('onclick');
    if (onclickAttr && onclickAttr.includes('navigateTo')) {
      button.removeAttribute('onclick');
      const page = onclickAttr.match(/'([^']+)'/)[1];
      button.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        navigateTo(page);
      });
    }
  });
}

// The rest of your existing JavaScript functions remain the same...
// (sendMessage, loadConversation, renderMessages, etc.)

// FIXED: Enhanced mobile view switching
function showChatView() {
  if (!isMobile) return;
  
  document.getElementById('conversationsSidebar').classList.add('hidden');
  document.getElementById('chatArea').classList.add('active');
  
  // Focus input when switching to chat view on mobile
  setTimeout(() => {
    const messageInput = document.getElementById('messageInput');
    if (messageInput) {
      messageInput.focus();
    }
  }, 300);
}

function showConversationsView() {
  if (!isMobile) return;
  
  document.getElementById('conversationsSidebar').classList.remove('hidden');
  document.getElementById('chatArea').classList.remove('active');
}

// Initialize chat when page loads
document.addEventListener('DOMContentLoaded', initChat);
</script>
</body>
</html>
