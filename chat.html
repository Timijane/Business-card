<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MEET â€” Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  /* Your existing CSS remains exactly the same */
  /* ... ALL YOUR ORIGINAL CSS CODE ... */
</style>
</head>
<body>

<!-- Your existing HTML remains exactly the same -->
<!-- ... ALL YOUR ORIGINAL HTML CODE ... -->

<script>
// Your existing JavaScript code remains the same until the setupEventListeners function

// Setup event listeners - ONLY MODIFYING THIS FUNCTION
function setupEventListeners() {
  const messageInput = document.getElementById('messageInput');
  const sendButton = document.getElementById('sendButton');
  
  // Send message on button click
  sendButton.addEventListener('click', sendMessage);
  
  // Send message on Enter key (but allow Shift+Enter for new line)
  messageInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
    
    // Auto-resize textarea
    messageInput.style.height = 'auto';
    messageInput.style.height = Math.min(messageInput.scrollHeight, 150) + 'px';
  });
  
  // New chat button
  document.getElementById('newChatBtn').addEventListener('click', () => {
    alert('New chat feature would open a modal to start conversation with new contacts');
  });
  
  // Back button for mobile - only back button triggers return
  document.getElementById('backButton').addEventListener('click', (e) => {
    e.stopPropagation();
    showConversationsView();
  });
  
  // Go Live button
  document.getElementById('goLive').addEventListener('click', goLive);
  
  // AI mode toggle
  document.getElementById('aiModeToggle').addEventListener('click', toggleAIMode);
  
  // Window resize handler
  window.addEventListener('resize', checkMobileLayout);
  
  // === FIX: Enhanced click protection for chat interface ===
  // Prevent any clicks in the chat interface from closing the chat view
  
  // Protect the entire messages container
  const messagesContainer = document.getElementById('messagesContainer');
  if (messagesContainer) {
    messagesContainer.addEventListener('click', (e) => {
      e.stopPropagation();
      e.preventDefault();
    });
    
    messagesContainer.addEventListener('touchstart', (e) => {
      e.stopPropagation();
    });
  }
  
  // Protect the message input area
  const messageInputContainer = document.getElementById('messageInputContainer');
  if (messageInputContainer) {
    messageInputContainer.addEventListener('click', (e) => {
      e.stopPropagation();
      e.preventDefault();
    });
    
    messageInputContainer.addEventListener('touchstart', (e) => {
      e.stopPropagation();
    });
  }
  
  // Protect the message input field specifically
  if (messageInput) {
    messageInput.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    
    messageInput.addEventListener('touchstart', (e) => {
      e.stopPropagation();
    });
  }
  
  // Protect the send button
  if (sendButton) {
    sendButton.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    
    sendButton.addEventListener('touchstart', (e) => {
      e.stopPropagation();
    });
  }
  
  // Protect smart suggestions
  const smartSuggestions = document.getElementById('smartSuggestions');
  if (smartSuggestions) {
    smartSuggestions.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  }
  
  // Protect AI mode toggle
  const aiModeToggle = document.getElementById('aiModeToggle');
  if (aiModeToggle) {
    aiModeToggle.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  }
  
  // Protect input action buttons
  const inputActions = document.querySelectorAll('.input-action');
  inputActions.forEach(button => {
    button.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  });
  
  // Protect chat action buttons in header
  const chatActionBtns = document.querySelectorAll('.chat-action-btn');
  chatActionBtns.forEach(button => {
    button.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  });
  
  // === END OF FIX ===
  
  // Your existing navigation fixes remain the same
  document.querySelector('aside button[onclick*="profile.html"]').addEventListener('click', (e) => {
    navigateTo('profile.html');
  });
  
  document.querySelector('aside button[onclick*="chat.html"]').addEventListener('click', (e) => {
    navigateTo('chat.html');
  });
}

// ALL YOUR OTHER EXISTING JAVASCRIPT FUNCTIONS REMAIN EXACTLY THE SAME
// ... (No changes to any other functions)
</script>
</body>
</html>
