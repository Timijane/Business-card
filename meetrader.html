I want the way the item are listed to also be at the first code, also  I noticed that the item doesn't appear on the first code, 
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MEET | Meetrader</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #0080FF;
    --primary-dark: #0066CC;
    --accent: #00C6FF;
    --success: #10B981;
    --error: #EF4444;
    --bg-color: #f0f2f5;
    --card-bg: #fff;
    --text-color: #111;
    --secondary-text: #65676b;
    --border-color: #dddfe2;
    --online: #10B981;
    --offline: #EF4444;
    --radius: 12px;
    --shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  body.dark-mode {
    --bg-color: #18191a;
    --card-bg: #242526;
    --text-color: #e4e6eb;
    --secondary-text: #b0b3b8;
    --border-color: #3e4042;
    --shadow: 0 2px 8px rgba(0,0,0,0.3);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  html, body {
    height: 100%;
    overflow-x: hidden;
    font-size: 16px;
  }

  body {
    font-family: 'Poppins', sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    transition: all 0.3s ease;
    min-height: 100vh;
    -webkit-overflow-scrolling: touch;
  }

  .app-container {
    display: flex;
    min-height: 100vh;
    position: relative;
  }

  /* Sidebar */
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    height: 100vh;
    width: 280px;
    background: linear-gradient(180deg, #0080FF 0%, #00C6FF 100%);
    border-right: 1px solid var(--border-color);
    overflow-y: auto;
    z-index: 100;
    padding: 20px;
    transition: all 0.3s ease;
    color: white;
    -webkit-overflow-scrolling: touch;
  }

  .sidebar-header {
    padding: 10px 0 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    margin-bottom: 20px;
  }

  .sidebar-header h2 {
    font-size: 24px;
    font-weight: 700;
  }

  .sidebar-menu {
    list-style: none;
  }

  .sidebar-menu li {
    margin-bottom: 8px;
  }

  .sidebar-menu a {
    display: flex;
    align-items: center;
    padding: 12px;
    text-decoration: none;
    color: white;
    border-radius: 8px;
    transition: background 0.3s;
    min-height: 44px;
    font-size: 16px;
  }

  .sidebar-menu a:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  .sidebar-menu i {
    margin-right: 12px;
    font-size: 18px;
  }

  /* Main Content */
  .main-content {
    flex: 1;
    margin-left: 280px;
    padding: 20px;
    min-height: 100vh;
  }

  /* Navbar */
  .navbar {
    background: linear-gradient(135deg, #0080FF 0%, #00C6FF 100%);
    padding: 15px 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow);
    color: white;
    flex-wrap: wrap;
    gap: 10px;
  }

  .navbar h2 {
    font-size: 20px;
    font-weight: 700;
  }

  .nav-controls {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
  }

  .search-bar {
    display: flex;
    align-items: center;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 8px 15px;
    margin-right: 15px;
  }

  .search-bar input {
    background: transparent;
    border: none;
    color: white;
    outline: none;
    width: 200px;
    font-size: 14px;
  }

  .search-bar input::placeholder {
    color: rgba(255, 255, 255, 0.7);
  }

  .user-profile-nav {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 5px 10px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.2);
    cursor: pointer;
    position: relative;
    min-height: 44px;
  }

  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    cursor: pointer;
    position: relative;
    min-width: 40px;
    font-size: 16px;
    border: 2px solid white;
  }

  .user-avatar.small {
    width: 30px;
    height: 30px;
    font-size: 14px;
    min-width: 30px;
  }

  .status-indicator {
    position: absolute;
    bottom: 0;
    right: 0;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid white;
  }

  .status-online {
    background-color: var(--online);
  }

  .user-profile-nav span {
    font-size: 14px;
    font-weight: 600;
  }

  .btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    min-height: 44px;
  }

  .btn:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  /* Meetrader Container */
  .meetrader-container {
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
  }

  .meetrader-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .meetrader-title {
    font-size: 24px;
    font-weight: 700;
    margin: 0;
  }

  .meetrader-actions {
    display: flex;
    gap: 12px;
  }

  .filter-btn, .sort-btn {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
    color: var(--text-color);
  }

  .filter-btn:hover, .sort-btn:hover {
    background: rgba(0,128,255,0.05);
  }

  .post-item-btn {
    background: linear-gradient(135deg, #0080FF 0%, #00C6FF 100%);
    color: white;
    border: 0;
    padding: 10px 18px;
    border-radius: 10px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: transform 0.2s;
  }

  .post-item-btn:hover {
    transform: translateY(-2px);
  }

  /* Meetrader Filters */
  .meetrader-filters {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 15px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    display: none;
  }

  .filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  .filters-title {
    font-size: 16px;
    font-weight: 700;
    margin: 0;
  }

  .filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .filter-label {
    font-size: 14px;
    font-weight: 600;
  }

  .filter-select, .filter-input {
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background: var(--bg-color);
    font-family: inherit;
    font-size: 14px;
    color: var(--text-color);
  }

  .price-range {
    display: flex;
    gap: 10px;
  }

  .price-input {
    flex: 1;
  }

  .apply-filters-btn {
    background: linear-gradient(135deg, #0080FF 0%, #00C6FF 100%);
    color: white;
    border: 0;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 10px;
    width: 100%;
  }

  /* Item Grid */
  .meetrader-items {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .item-card {
    background: var(--card-bg);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: transform 0.3s, box-shadow 0.3s;
    display: flex;
    flex-direction: column;
  }

  .item-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }

  /* Image Swapping Preview */
  .item-image-container {
      position: relative;
      width: 100%;
      height: 200px;
      cursor: pointer;
      overflow: hidden;
  }

  .item-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    transition: opacity 0.3s;
  }

  .item-details {
    padding: 15px;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
  }

  .item-title {
    font-size: 16px;
    font-weight: 700;
    margin: 0;
    line-height: 1.3;
  }

  .item-price {
    font-size: 18px;
    font-weight: 700;
    color: var(--primary);
    white-space: nowrap;
    margin-left: 10px;
  }

  .item-description {
    font-size: 14px;
    color: var(--secondary-text);
    margin-bottom: 15px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .item-delivery, .item-payment {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--secondary-text);
    margin-bottom: 5px;
  }
  
  .item-location {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--secondary-text);
    margin-bottom: 15px;
  }

  .item-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: auto;
  }

  .item-seller {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .seller-avatar {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
  }

  .seller-name {
    font-size: 13px;
    font-weight: 600;
  }

  .item-actions {
    display: flex;
    gap: 8px;
  }

  .action-btn {
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--secondary-text);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
  }

  .action-btn:hover {
    background: rgba(0,128,255,0.05);
    color: var(--primary);
  }

  .like-btn.liked {
    color: #ff4757;
    border-color: rgba(255,71,87,0.2);
  }

  .review-count {
      font-size: 12px;
      color: var(--secondary-text);
      margin-left: 5px;
  }

  /* Image Upload Grid */
  .image-upload-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 10px;
  }

  .image-upload-box {
    border: 2px dashed var(--border-color);
    border-radius: 8px;
    height: 100px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: border 0.2s;
    position: relative;
    overflow: hidden;
  }

  .image-upload-box:hover {
    border-color: var(--primary);
  }

  .image-preview-thumb {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .remove-image-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(255, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      line-height: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
  }

  /* Checkbox Group Styles */
  .checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    background: var(--bg-color);
  }

  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-content {
    background: var(--card-bg);
    border-radius: 12px;
    width: 500px;
    max-width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    width: 100%;
  }
  
  /* Full Image/Review Modal */
  #imageSwapModal .modal-content, #reviewsModal .modal-content {
      width: 600px;
  }

  .modal-header {
    padding: 16px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    background: var(--card-bg);
    z-index: 10;
  }

  .modal-body {
    padding: 16px;
  }

  .close-modal {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--secondary-text);
    min-width: 44px;
    min-height: 44px;
  }

  .post-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .form-input, .form-textarea, .form-select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background: var(--bg-color);
    font-family: inherit;
    font-size: 14px;
    transition: border 0.2s;
    color: var(--text-color);
  }

  .form-input:focus, .form-textarea:focus, .form-select:focus {
    outline: none;
    border-color: var(--primary);
  }

  .form-textarea {
    resize: vertical;
    min-height: 100px;
  }

  .modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
  }

  .cancel-btn {
    background: transparent;
    border: 1px solid var(--border-color);
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
    color: var(--text-color);
  }

  .cancel-btn:hover {
    background: rgba(0,0,0,0.05);
  }

  .submit-btn {
    background: linear-gradient(135deg, #0080FF 0%, #00C6FF 100%);
    color: white;
    border: 0;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .submit-btn:hover {
    transform: translateY(-2px);
  }

  /* Currency Selector */
  .currency-price-group {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .currency-select {
    width: 120px;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background: var(--bg-color);
    font-family: inherit;
    font-size: 14px;
    color: var(--text-color);
  }

  .price-input-full {
    flex: 1;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--secondary-text);
  }

  .empty-icon {
    font-size: 60px;
    margin-bottom: 15px;
    opacity: 0.5;
  }

  .empty-title {
    font-size: 18px;
    margin-bottom: 10px;
  }

  .empty-description {
    font-size: 14px;
    max-width: 400px;
    margin: 0 auto 20px;
  }

  /* Message Container */
  .message-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    max-width: 300px;
  }

  .message {
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 10px;
    font-weight: 600;
    box-shadow: var(--shadow);
    animation: slideIn 0.3s ease;
  }

  .message.success {
    background: var(--success);
    color: white;
  }

  .message.error {
    background: var(--error);
    color: white;
  }

  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  /* Image Swapping Modal Specific Styles */
  .image-swap-container {
      position: relative;
      overflow: hidden;
  }

  .full-image-display {
      width: 100%;
      height: auto;
      max-height: 80vh;
      object-fit: contain;
      display: block;
      margin: 0 auto;
  }

  .swap-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border: none;
      padding: 10px;
      cursor: pointer;
      z-index: 10;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
  }

  .prev-btn {
      left: 10px;
  }

  .next-btn {
      right: 10px;
  }

  .image-indicators {
      display: flex;
      justify-content: center;
      margin-top: 10px;
      gap: 5px;
  }

  .indicator-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--border-color);
      cursor: pointer;
      transition: background 0.3s;
  }

  .indicator-dot.active {
      background: var(--primary);
  }

  /* Review Modal Specific Styles */
  .reviews-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 20px;
  }

  .review-card {
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--bg-color);
  }

  .review-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
  }

  .review-author {
      font-weight: 600;
  }

  .review-date {
      font-size: 12px;
      color: var(--secondary-text);
  }

  .review-rating {
      color: gold;
      font-size: 14px;
  }

  .review-text {
      font-size: 14px;
      margin-top: 5px;
      line-height: 1.4;
  }
  
  .add-review-form {
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
  }
  
  .rating-stars {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
  }
  
  .rating-stars i {
      color: var(--secondary-text);
      cursor: pointer;
      transition: color 0.2s;
  }
  
  .rating-stars i.rated {
      color: gold;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .sidebar {
      width: 80px;
    }
    .sidebar span {
      display: none;
    }
    .main-content {
      margin-left: 80px;
    }
  }

  @media (max-width: 768px) {
    .sidebar {
      width: 70px;
      padding: 10px 5px;
      height: 100vh;
    }
    
    .sidebar-header {
      display: none;
    }
    
    .sidebar-menu a {
      flex-direction: column;
      padding: 10px 5px;
      font-size: 12px;
      justify-content: center;
      text-align: center;
    }
    
    .sidebar-menu i {
      margin-right: 0;
      margin-bottom: 5px;
      font-size: 16px;
    }
    
    .main-content {
      margin-left: 70px;
      padding: 10px;
      width: calc(100% - 70px);
    }
    
    .navbar {
      padding: 12px;
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }
    
    .search-bar {
      display: none;
    }
    
    .user-profile-nav span {
      display: none;
    }
    
    .nav-controls {
      gap: 5px;
      width: 100%;
      justify-content: space-between;
    }
    
    .btn span {
      display: none;
    }
    
    .btn {
      padding: 8px;
      flex: 1;
      justify-content: center;
    }

    .meetrader-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }

    .meetrader-actions {
      width: 100%;
      justify-content: space-between;
    }

    .meetrader-items {
      grid-template-columns: 1fr;
    }

    .filters-grid {
      grid-template-columns: 1fr;
    }

    .currency-price-group {
      flex-direction: column;
    }

    .currency-select {
      width: 100%;
    }
  }

  @media (max-width: 480px) {
    .sidebar {
      width: 60px;
    }
    
    .main-content {
      margin-left: 60px;
      padding: 8px;
    }

    .navbar h2 {
      font-size: 18px;
    }

    .meetrader-actions {
      flex-direction: column;
      gap: 10px;
    }

    .post-item-btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>
</head>
<body>

<div class="app-container">
  <div class="sidebar">
    <div class="sidebar-header">
      <h2 style="color: white;">MEET</h2>
    </div>
    <ul class="sidebar-menu">
      <li><a href="feed.html"><i class="fas fa-home"></i> <span>Feed</span></a></li>
      <li><a href="profile.html"><i class="fas fa-user"></i> <span>Profile</span></a></li>
      <li><a href="chat.html"><i class="fas fa-comment"></i> <span>Chat</span></a></li>
      <li><a href="conference.html"><i class="fas fa-video"></i> <span>Conference</span></a></li>
      <li><a href="meetrader.html" class="active"><i class="fas fa-store"></i> <span>Meetrader</span></a></li>
      <li><a href="meetversity.html"><i class="fas fa-graduation-cap"></i> <span>Meetversity</span></a></li>
      <li><a href="organization.html"><i class="fas fa-sitemap"></i> <span>Organization</span></a></li>
    </ul>
  </div>

  <div class="main-content">
    <div class="navbar">
      <h2 style="color: white;">MEET Meetrader</h2>
      <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 10px;">
        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Search items..." id="searchInput">
        </div>
        <div class="nav-controls">
          <div class="user-profile-nav">
            <div class="user-avatar small" id="currentUserAvatar">
              U
              <div class="status-indicator status-online"></div>
            </div>
            <span id="userName">User</span>
          </div>
          <button class="btn" id="nightToggleBtn">
            <i class="fas fa-moon"></i> <span>Night Mode</span>
          </button>
          <button class="btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
          </button>
        </div>
      </div>
    </div>

    <div class="message-container" id="messageContainer"></div>

    <div class="meetrader-container">
      <div class="meetrader-header">
        <h1 class="meetrader-title">Meetrader</h1>
        <div class="meetrader-actions">
          <button class="filter-btn" id="filterBtn">
            <i class="fas fa-filter"></i> <span>Filters</span>
          </button>
          <button class="sort-btn" id="sortBtn">
            <i class="fas fa-sort"></i> <span>Sort</span>
          </button>
          <button class="post-item-btn" id="postItemBtn">
            <i class="fas fa-plus"></i> <span>Post Item</span>
          </button>
        </div>
      </div>

      <div class="meetrader-filters" id="meetraderFilters">
        <div class="filters-header">
          <h3 class="filters-title">Filter Items</h3>
          <button class="close-modal" id="closeFilters"><i class="fas fa-times"></i></button>
        </div>
        <div class="filters-grid">
          <div class="filter-group">
            <label class="filter-label">Category</label>
            <select class="filter-select" id="categoryFilter">
              <option value="">All Categories</option>
              <option value="electronics">Electronics</option>
              <option value="furniture">Furniture</option>
              <option value="clothing">Clothing</option>
              <option value="services">Services</option>
              <option value="skills">Skills</option>
              <option value="courses">Courses</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label">Location</label>
            <input type="text" class="filter-input" id="locationFilter" placeholder="City or region">
          </div>
          <div class="filter-group">
            <label class="filter-label">Price Range</label>
            <div class="price-range">
              <input type="number" class="filter-input price-input" id="minPrice" placeholder="Min">
              <input type="number" class="filter-input price-input" id="maxPrice" placeholder="Max">
            </div>
          </div>
          <div class="filter-group">
            <label class="filter-label">Condition</label>
            <select class="filter-select" id="conditionFilter">
              <option value="">Any Condition</option>
              <option value="new">New</option>
              <option value="like-new">Like New</option>
              <option value="good">Good</option>
              <option value="fair">Fair</option>
            </select>
          </div>
        </div>
        <button class="apply-filters-btn" id="applyFilters">Apply Filters</button>
      </div>

      <div class="meetrader-items" id="meetraderItems">
        </div>

      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-icon"><i class="fas fa-store"></i></div>
        <h3 class="empty-title">No items found</h3>
        <p class="empty-description">Try adjusting your filters or be the first to post an item in Meetrader!</p>
        <button class="post-item-btn" id="emptyStatePostBtn"><i class="fas fa-plus"></i> Post an Item</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="postItemModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Post a New Item</h3>
      <button class="close-modal" id="closePostItemModal"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <form class="post-form" id="postItemForm">
        <div class="form-group">
          <label class="form-label" for="itemTitle">Item Title</label>
          <input type="text" class="form-input" id="itemTitle" placeholder="What are you selling or offering?" required>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="itemDescription">Description (Like Jumia)</label>
          <textarea class="form-textarea" id="itemDescription" placeholder="Provide a detailed description of your item, service, or skill..." required></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Price</label>
          <div class="currency-price-group">
            <select class="currency-select" id="itemCurrency" required>
              <option value="USD">USD ($)</option>
              <option value="EUR">EUR (€)</option>
              <option value="GBP">GBP (£)</option>
              <option value="CAD">CAD ($)</option>
              <option value="AUD">AUD ($)</option>
              <option value="JPY">JPY (¥)</option>
              <option value="CNY">CNY (¥)</option>
              <option value="INR">INR (₹)</option>
              <option value="NGN" selected>NGN (₦)</option>
              <option value="GHS">GHS (₵)</option>
              <option value="KES">KES (KSh)</option>
              <option value="ZAR">ZAR (R)</option>
            </select>
            <input type="number" class="form-input price-input-full" id="itemPrice" placeholder="0.00" min="0" step="0.01" required>
          </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Payment Means Options</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="payAtDelivery" name="paymentMeans" value="Pay at Delivery" checked>
                    <label for="payAtDelivery">Pay at Delivery</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="payBeforeDelivery" name="paymentMeans" value="Pay Before Delivery">
                    <label for="payBeforeDelivery">Pay Before Delivery (Requires Secure Escrow)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="payThroughMeetpay" name="paymentMeans" value="Pay Through Meetpay">
                    <label for="payThroughMeetpay">Pay Through Meetpay (Recommended)</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">Delivery Options</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="sellerDelivery" name="deliveryMeans" value="Seller Delivery">
                    <label for="sellerDelivery">Seller Delivery (Specify Costs)</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="buyerPickup" name="deliveryMeans" value="Buyer Pickup" checked>
                    <label for="buyerPickup">Buyer Pickup</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="courierService" name="deliveryMeans" value="Courier Service">
                    <label for="courierService">Courier/Third-party Service</label>
                </div>
            </div>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="itemLocation">Location</label>
          <input type="text" class="form-input" id="itemLocation" placeholder="City, State" required>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="itemCategory">Category</label>
          <select class="form-select" id="itemCategory" required>
            <option value="">Select a category</option>
            <option value="electronics">Electronics</option>
            <option value="furniture">Furniture</option>
            <option value="clothing">Clothing</option>
            <option value="services">Services</option>
            <option value="skills">Skills</option>
            <option value="courses">Courses</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="itemCondition">Condition</label>
          <select class="form-select" id="itemCondition">
            <option value="new">New</option>
            <option value="like-new">Like New</option>
            <option value="good">Good</option>
            <option value="fair">Fair</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Item Images (Min 1, Max 5)</label>
          <div class="image-upload-grid" id="imageUploadGrid">
              <div class="image-upload-box add-image-box" id="addImageBox">
                <div class="image-upload-icon"><i class="fas fa-camera"></i></div>
                <div class="image-upload-text" style="font-size: 12px; color: var(--secondary-text);">Add Image</div>
              </div>
          </div>
          <input type="file" id="itemImages" accept="image/*" multiple style="display: none">
        </div>
        
        <div class="modal-actions">
          <button type="button" class="cancel-btn" id="cancelPostItem">Cancel</button>
          <button type="submit" class="submit-btn">Post Item</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal" id="imageSwapModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="imageSwapTitle">Item Images</h3>
            <button class="close-modal" id="closeImageSwapModal"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="image-swap-container">
                <img id="fullImageDisplay" class="full-image-display" src="" alt="Full Item Image">
                <button class="swap-btn prev-btn" id="prevImageBtn"><i class="fas fa-chevron-left"></i></button>
                <button class="swap-btn next-btn" id="nextImageBtn"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="image-indicators" id="imageIndicators">
                </div>
        </div>
    </div>
</div>

<div class="modal" id="reviewsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="reviewsModalTitle">Reviews for [Item Title]</h3>
            <button class="close-modal" id="closeReviewsModal"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <div class="reviews-list" id="reviewsList">
                <p id="noReviewsMessage">No reviews yet. Be the first!</p>
            </div>
            
            <div class="add-review-form">
                <h4>Add Your Review</h4>
                <form id="addReviewForm">
                    <div class="form-group">
                        <label class="form-label">Rating</label>
                        <div class="rating-stars" id="ratingStars">
                            <i class="fas fa-star" data-rating="1"></i>
                            <i class="fas fa-star" data-rating="2"></i>
                            <i class="fas fa-star" data-rating="3"></i>
                            <i class="fas fa-star" data-rating="4"></i>
                            <i class="fas fa-star" data-rating="5"></i>
                        </div>
                        <input type="hidden" id="reviewRating" value="0" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="reviewText">Your Comment</label>
                        <textarea class="form-textarea" id="reviewText" placeholder="Share your experience..." required></textarea>
                    </div>
                    <div class="modal-actions" style="margin-top: 10px;">
                        <button type="submit" class="submit-btn">Submit Review</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script type="module">
  // Firebase imports
  import { 
    getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDoc, getDocs, onSnapshot, serverTimestamp, 
    query, orderBy, where, setDoc, arrayUnion, arrayRemove
  } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyDtqM_pMGIYkUgy0OWGsQbfS9MtYQhrgZM",
    authDomain: "meet-6e159.firebaseapp.com",
    databaseURL: "https://meet-6e159-default-rtdb.firebaseio.com",
    projectId: "meet-6e159",
    storageBucket: "meet-6e159.firebasestorage.app",
    messagingSenderId: "252353608421",
    appId: "1:252353608421:web:6706056048e9a8f12db20c",
    measurementId: "G-9BFPPVMMRF"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  
  // File size limits (5MB per file)
  const MAX_FILE_SIZE = 5 * 1024 * 1024;
  const MAX_IMAGES = 5; 

  // DOM Elements
  const meetraderItems = document.getElementById('meetraderItems');
  const emptyState = document.getElementById('emptyState');
  const filterBtn = document.getElementById('filterBtn');
  const meetraderFilters = document.getElementById('meetraderFilters');
  const closeFilters = document.getElementById('closeFilters');
  const applyFilters = document.getElementById('applyFilters');
  const postItemBtn = document.getElementById('postItemBtn');
  const postItemModal = document.getElementById('postItemModal');
  const closePostItemModal = document.getElementById('closePostItemModal');
  const cancelPostItem = document.getElementById('cancelPostItem');
  const postItemForm = document.getElementById('postItemForm');
  const imageUploadGrid = document.getElementById('imageUploadGrid');
  const addImageBox = document.getElementById('addImageBox');
  const itemImagesInput = document.getElementById('itemImages');
  const searchInput = document.getElementById('searchInput');
  const logoutBtn = document.getElementById('logoutBtn');
  const nightToggleBtn = document.getElementById('nightToggleBtn');
  const currentUserAvatar = document.getElementById('currentUserAvatar');
  const userName = document.getElementById('userName');
  const messageContainer = document.getElementById('messageContainer');
  const emptyStatePostBtn = document.getElementById('emptyStatePostBtn');

  // Image Swapping Modal Elements
  const imageSwapModal = document.getElementById('imageSwapModal');
  const closeImageSwapModal = document.getElementById('closeImageSwapModal');
  const fullImageDisplay = document.getElementById('fullImageDisplay');
  const prevImageBtn = document.getElementById('prevImageBtn');
  const nextImageBtn = document.getElementById('nextImageBtn');
  const imageIndicators = document.getElementById('imageIndicators');
  let currentImageUrls = [];
  let currentImageIndex = 0;

  // Reviews Modal Elements
  const reviewsModal = document.getElementById('reviewsModal');
  const closeReviewsModal = document.getElementById('closeReviewsModal');
  const reviewsModalTitle = document.getElementById('reviewsModalTitle');
  const reviewsList = document.getElementById('reviewsList');
  const noReviewsMessage = document.getElementById('noReviewsMessage');
  const addReviewForm = document.getElementById('addReviewForm');
  const ratingStars = document.getElementById('ratingStars');
  const reviewRatingInput = document.getElementById('reviewRating');
  const reviewText = document.getElementById('reviewText');
  let currentItemIdForReview = null;


  // State
  let currentUser = null;
  let items = [];
  let filteredItems = [];
  let uploadedImageFiles = []; // Array to hold base64 strings of uploaded images

  // Currency symbols
  const currencySymbols = {
    'USD': '$',
    'EUR': '€',
    'GBP': '£',
    'CAD': '$',
    'AUD': '$',
    'JPY': '¥',
    'CNY': '¥',
    'INR': '₹',
    'NGN': '₦',
    'GHS': '₵',
    'KES': 'KSh',
    'ZAR': 'R'
  };

  // Default item images by category
  const defaultImages = {
    electronics: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80',
    furniture: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80',
    clothing: 'https://images.unsplash.com/photo-1445205170230-053b83016050?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80',
    services: 'https://images.unsplash.com/photo-1581094794329-c8112a89af12?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80',
    skills: 'https://images.unsplash.com/photo-1553877522-43269d4ea984?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80',
    courses: 'https://images.unsplash.com/photo-1501504905252-473c47e087f8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80',
    other: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'
  };
  
  // Utility to get image URL (first in array or default)
  function getItemImage(item) {
      if (item.images && item.images.length > 0) {
          return item.images[0];
      }
      return defaultImages[item.category] || defaultImages.other;
  }

  // Theme management
  function initTheme() {
    const savedTheme = localStorage.getItem('meet_theme');
    if (savedTheme === 'dark') {
      document.body.classList.add('dark-mode');
      nightToggleBtn.innerHTML = '<i class="fas fa-sun"></i> <span>Day Mode</span>';
    } else {
      document.body.classList.remove('dark-mode');
      nightToggleBtn.innerHTML = '<i class="fas fa-moon"></i> <span>Night Mode</span>';
    }
  }

  // Message display
  function showMessage(message, type = 'error') {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}`;
    messageDiv.textContent = message;
    messageContainer.appendChild(messageDiv);
    
    setTimeout(() => {
      if (messageDiv.parentNode) {
        messageDiv.parentNode.removeChild(messageDiv);
      }
    }, 5000);
  }

  // Convert image file to base64 for storage
  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
    });
  }

  // Get user profile data
  async function getUserProfile(userId) {
    try {
      const userDoc = await getDoc(doc(db, "users", userId));
      if (userDoc.exists()) {
        return userDoc.data();
      }
      return null;
    } catch (error) {
      console.error('Error getting user profile:', error);
      return null;
    }
  }
  
  // Calculate average rating
  function calculateAvgRating(reviews) {
      if (!reviews || reviews.length === 0) return 0;
      const total = reviews.reduce((sum, review) => sum + review.rating, 0);
      return (total / reviews.length).toFixed(1);
  }
  
  // Render star rating
  function renderRating(rating, size = '14px') {
      let stars = '';
      for (let i = 1; i <= 5; i++) {
          stars += `<i class="fas fa-star" style="color: ${i <= rating ? 'gold' : 'var(--border-color)'}; font-size: ${size};"></i>`;
      }
      return stars;
  }

  // CREATE ITEM
  async function createItem(itemData) {
    const user = auth.currentUser;
    if (!user) throw new Error("Please login first!");

    // Get user profile data
    const userProfile = await getUserProfile(user.uid);
    const userName = user.displayName || userProfile?.name || "Anonymous";
    const userInitial = userName.charAt(0).toUpperCase();

    // Use the provided images or a default image based on category
    const images = itemData.images.length > 0 ? itemData.images : [defaultImages[itemData.category] || defaultImages.other];

    // Create the item in Firestore
    const docRef = await addDoc(collection(db, "meetrader"), {
      userId: user.uid,
      userName: userName,
      userInitial: userInitial,
      title: itemData.title,
      price: parseFloat(itemData.price),
      currency: itemData.currency,
      location: itemData.location,
      description: itemData.description,
      category: itemData.category,
      condition: itemData.condition,
      images: images, // Store array of image base64 strings
      paymentMeans: itemData.paymentMeans, // Store array of payment means
      deliveryOptions: itemData.deliveryOptions, // Store array of delivery options
      timestamp: serverTimestamp(),
      likes: 0,
      reviews: [], // Initialize reviews array
      status: 'active'
    });

    return docRef.id;
  }

  // TOGGLE LIKE
  async function toggleLike(itemId) {
    const user = auth.currentUser;
    if (!user) {
        showMessage('You must be logged in to like an item.');
        return;
    }

    const itemRef = doc(db, "meetrader", itemId);
    const likeRef = doc(db, "meetrader", itemId, "likes", user.uid);
    
    try {
      const likeSnap = await getDoc(likeRef);
      const itemDoc = await getDoc(itemRef);
      if (!itemDoc.exists()) return;

      if (likeSnap.exists()) {
        // Unlike: remove the like document and decrement likes count
        await deleteDoc(likeRef);
        await updateDoc(itemRef, {
            likes: (itemDoc.data().likes || 1) - 1
        });
      } else {
        // Like: create a like document and increment likes count
        await setDoc(likeRef, {
          userId: user.uid,
          timestamp: serverTimestamp()
        });
        await updateDoc(itemRef, {
            likes: (itemDoc.data().likes || 0) + 1
        });
      }
    } catch (error) {
      console.error('Error toggling like:', error);
      showMessage('Failed to update like. Please try again.');
    }
  }

  // DELETE ITEM
  async function deleteItem(itemId) {
    if (!confirm('Are you sure you want to delete this item?')) return;
    
    try {
      await deleteDoc(doc(db, "meetrader", itemId));
      showMessage('Item deleted successfully!', 'success');
    } catch (error) {
      console.error('Error deleting item:', error);
      showMessage('Failed to delete item. Please try again.');
    }
  }
  
  // SUBMIT REVIEW
  async function submitReview(e) {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user) {
          showMessage('You must be logged in to leave a review.');
          return;
      }
      if (!currentItemIdForReview) return;
      
      const rating = parseInt(reviewRatingInput.value);
      const comment = reviewText.value.trim();
      
      if (rating === 0 || !comment) {
          showMessage('Please provide a rating and a comment.');
          return;
      }
      
      try {
          const itemRef = doc(db, "meetrader", currentItemIdForReview);
          const userProfile = await getUserProfile(user.uid);
          const reviewerName = user.displayName || userProfile?.name || "Anonymous";

          const newReview = {
              userId: user.uid,
              userName: reviewerName,
              rating: rating,
              comment: comment,
              timestamp: new Date().toISOString()
          };
          
          await updateDoc(itemRef, {
              reviews: arrayUnion(newReview)
          });
          
          showMessage('Review submitted successfully!', 'success');
          // Update the reviews list in the modal
          const item = items.find(i => i.id === currentItemIdForReview);
          if (item) {
              item.reviews.push(newReview);
              renderReviews(item);
          }
          addReviewForm.reset();
          reviewRatingInput.value = 0;
          document.querySelectorAll('#ratingStars i').forEach(star => star.classList.remove('rated'));
      } catch (error) {
          console.error('Error submitting review:', error);
          showMessage('Failed to submit review. Please try again.');
      }
  }

  // Authentication state listener
  onAuthStateChanged(auth, async user => {
    if (!user) {
      window.location.href = 'login.html';
    } else {
      currentUser = user;
      // Update user info in UI
      const userNameText = user.displayName || 'User';
      const userInitial = userNameText.charAt(0).toUpperCase();
      
      currentUserAvatar.textContent = userInitial;
      userName.textContent = userNameText;
      
      setupRealTimeListener();
    }
  });

  // Setup real-time listener for items
  const setupRealTimeListener = () => {
    const itemsQuery = query(collection(db, "meetrader"), orderBy("timestamp", "desc"));
    
    onSnapshot(itemsQuery, async (snapshot) => {
      items = [];
      const likePromises = [];
      snapshot.docs.forEach((doc) => {
        const item = doc.data();
        const timestamp = item.timestamp ? item.timestamp.toDate() : new Date();
        const itemData = {
          id: doc.id,
          ...item,
          timestamp: timestamp,
          isLiked: false // Temporary state for rendering
        };
        items.push(itemData);

        // Fetch like status for the current user
        if (currentUser) {
            const likeRef = doc(db, "meetrader", doc.id, "likes", currentUser.uid);
            likePromises.push(getDoc(likeRef).then(snap => {
                if (snap.exists()) itemData.isLiked = true;
            }).catch(e => console.error('Error fetching like status:', e)));
        }
      });
      
      // Wait for all like status checks to complete
      await Promise.all(likePromises);

      filteredItems = [...items];
      renderItems();
    }, error => {
      console.error('Real-time listener error:', error);
      showMessage('Failed to load items. Please refresh the page.');
    });
  };

  // Render reviews in the modal
  function renderReviews(item) {
      reviewsModalTitle.textContent = `Reviews for ${item.title}`;
      reviewsList.innerHTML = '';
      const reviews = item.reviews || [];

      if (reviews.length === 0) {
          noReviewsMessage.style.display = 'block';
      } else {
          noReviewsMessage.style.display = 'none';
          reviews.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).forEach(review => {
              const reviewCard = document.createElement('div');
              reviewCard.className = 'review-card';
              
              const date = review.timestamp ? new Date(review.timestamp).toLocaleDateString() : 'N/A';
              
              reviewCard.innerHTML = `
                  <div class="review-header">
                      <div class="seller-avatar small">${review.userName.charAt(0).toUpperCase()}</div>
                      <span class="review-author">${review.userName}</span>
                      <span class="review-date">${date}</span>
                      <span class="review-rating">${renderRating(review.rating)}</span>
                  </div>
                  <p class="review-text">${review.comment}</p>
              `;
              reviewsList.appendChild(reviewCard);
          });
      }
      reviewsModal.style.display = 'flex';
  }

  // Render items
  function renderItems() {
    if (filteredItems.length === 0) {
      meetraderItems.style.display = 'none';
      emptyState.style.display = 'block';
      return;
    }
    
    meetraderItems.style.display = 'grid';
    emptyState.style.display = 'none';
    
    meetraderItems.innerHTML = '';
    
    filteredItems.forEach(item => {
      const itemCard = document.createElement('div');
      itemCard.className = 'item-card';
      
      const currencySymbol = currencySymbols[item.currency] || item.currency;
      const isOwner = currentUser && currentUser.uid === item.userId;
      const firstImage = getItemImage(item);
      const avgRating = calculateAvgRating(item.reviews);
      
      itemCard.innerHTML = `
        <div class="item-image-container" data-id="${item.id}">
            <img src="${firstImage}" alt="${item.title}" class="item-image" onerror="this.src='${defaultImages.other}'">
        </div>
        <div class="item-details">
          <div class="item-header">
            <h3 class="item-title">${item.title}</h3>
            <div class="item-price">${currencySymbol}${item.price}</div>
          </div>
          <p class="item-description">${item.description}</p>
          <div class="item-payment">
              <i class="fas fa-money-check-alt"></i> ${item.paymentMeans.join(', ')}
          </div>
          <div class="item-delivery">
              <i class="fas fa-shipping-fast"></i> ${item.deliveryOptions.join(', ')}
          </div>
          <div class="item-location">
            <i class="fas fa-map-marker-alt"></i> ${item.location}
          </div>
          <div class="item-footer">
            <div class="item-seller">
              <div class="seller-avatar">${item.userInitial}</div>
              <span class="seller-name">${item.userName}</span>
            </div>
            <div class="item-actions">
              <button class="action-btn like-btn ${item.isLiked ? 'liked' : ''}" data-id="${item.id}" title="${item.isLiked ? 'Unlike' : 'Like'}">
                <i class="fas fa-heart"></i>
                <span class="review-count">${item.likes || 0}</span>
              </button>
              <button class="action-btn review-btn" data-id="${item.id}" title="Reviews (${item.reviews.length || 0})">
                <i class="fas fa-star"></i>
                <span class="review-count">${avgRating} (${item.reviews.length || 0})</span>
              </button>
              <button class="action-btn message-btn" data-id="${item.id}" title="Message Seller">
                <i class="fas fa-comment"></i>
              </button>
              ${isOwner ? `
                <button class="action-btn delete-btn" data-id="${item.id}" title="Delete Item">
                  <i class="fas fa-trash"></i>
                </button>
              ` : ''}
            </div>
          </div>
        </div>
      `;
      
      meetraderItems.appendChild(itemCard);
    });
    
    // Add event listeners for new elements
    attachItemActionListeners();
  }
  
  // Attach listeners to dynamically generated items
  function attachItemActionListeners() {
      // Like button
      document.querySelectorAll('.like-btn').forEach(btn => {
          btn.removeEventListener('click', handleLikeClick);
          btn.addEventListener('click', handleLikeClick);
      });
      
      // Message button
      document.querySelectorAll('.message-btn').forEach(btn => {
          btn.removeEventListener('click', handleMessageClick);
          btn.addEventListener('click', handleMessageClick);
      });
      
      // Delete button
      document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.removeEventListener('click', handleDeleteClick);
          btn.addEventListener('click', handleDeleteClick);
      });

      // Review button
      document.querySelectorAll('.review-btn').forEach(btn => {
          btn.removeEventListener('click', handleReviewClick);
          btn.addEventListener('click', handleReviewClick);
      });

      // Image click (for swapping)
      document.querySelectorAll('.item-image-container').forEach(container => {
          container.removeEventListener('click', handleImageContainerClick);
          container.addEventListener('click', handleImageContainerClick);
      });
  }

  function handleLikeClick(e) {
      const itemId = e.currentTarget.getAttribute('data-id');
      toggleLike(itemId);
  }

  function handleMessageClick(e) {
      const itemId = e.currentTarget.getAttribute('data-id');
      messageSeller(itemId);
  }

  function handleDeleteClick(e) {
      const itemId = e.currentTarget.getAttribute('data-id');
      deleteItem(itemId);
  }

  function handleReviewClick(e) {
      const itemId = e.currentTarget.getAttribute('data-id');
      const item = items.find(i => i.id === itemId);
      if (item) {
          currentItemIdForReview = itemId;
          renderReviews(item);
      }
  }

  function handleImageContainerClick(e) {
      const itemId = e.currentTarget.getAttribute('data-id');
      const item = items.find(i => i.id === itemId);
      if (item && item.images && item.images.length > 0) {
          currentImageUrls = item.images;
          currentImageIndex = 0;
          updateImageSwapModal();
          imageSwapModal.style.display = 'flex';
      } else {
          showMessage('No additional images to display.', 'error');
      }
  }

  // Image Swapping Logic
  function updateImageSwapModal() {
      if (currentImageUrls.length === 0) return;

      fullImageDisplay.src = currentImageUrls[currentImageIndex];
      prevImageBtn.disabled = currentImageIndex === 0;
      nextImageBtn.disabled = currentImageIndex === currentImageUrls.length - 1;
      
      // Update indicators
      imageIndicators.innerHTML = '';
      currentImageUrls.forEach((url, index) => {
          const dot = document.createElement('div');
          dot.className = `indicator-dot ${index === currentImageIndex ? 'active' : ''}`;
          dot.dataset.index = index;
          dot.addEventListener('click', () => {
              currentImageIndex = index;
              updateImageSwapModal();
          });
          imageIndicators.appendChild(dot);
      });
  }

  prevImageBtn.addEventListener('click', () => {
      if (currentImageIndex > 0) {
          currentImageIndex--;
          updateImageSwapModal();
      }
  });

  nextImageBtn.addEventListener('click', () => {
      if (currentImageIndex < currentImageUrls.length - 1) {
          currentImageIndex++;
          updateImageSwapModal();
      }
  });

  closeImageSwapModal.addEventListener('click', () => {
      imageSwapModal.style.display = 'none';
  });
  
  // Close Reviews Modal
  closeReviewsModal.addEventListener('click', () => {
      reviewsModal.style.display = 'none';
      currentItemIdForReview = null;
      addReviewForm.reset();
      reviewRatingInput.value = 0;
      document.querySelectorAll('#ratingStars i').forEach(star => star.classList.remove('rated'));
  });

  // Message seller
  function messageSeller(itemId) {
    const item = items.find(i => i.id === itemId);
    if (!item) return;
    
    showMessage(`Would open chat with ${item.userName} about "${item.title}"`, 'success');
  }

  // Initialize
  function initMeetrader() {
    setupEventListeners();
    initTheme();
  }

  // Setup event listeners
  function setupEventListeners() {
    // Theme toggle
    nightToggleBtn.addEventListener('click', () => {
      if (document.body.classList.contains('dark-mode')) {
        document.body.classList.remove('dark-mode');
        localStorage.setItem('meet_theme', 'light');
        nightToggleBtn.innerHTML = '<i class="fas fa-moon"></i> <span>Night Mode</span>';
      } else {
        document.body.classList.add('dark-mode');
        localStorage.setItem('meet_theme', 'dark');
        nightToggleBtn.innerHTML = '<i class="fas fa-sun"></i> <span>Day Mode</span>';
      }
    });

    // Logout functionality
    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
        window.location.href = 'login.html';
      } catch (error) {
        console.error('Logout error:', error);
        showMessage('Failed to logout. Please try again.');
      }
    });

    // Filter button
    filterBtn.addEventListener('click', () => {
      meetraderFilters.style.display = meetraderFilters.style.display === 'block' ? 'none' : 'block';
    });

    // Close filters
    closeFilters.addEventListener('click', () => {
      meetraderFilters.style.display = 'none';
    });

    // Apply filters
    applyFilters.addEventListener('click', applyFiltersHandler);

    // Post item button
    postItemBtn.addEventListener('click', openPostItemModal);
    emptyStatePostBtn.addEventListener('click', openPostItemModal);

    // Close post item modal
    closePostItemModal.addEventListener('click', closePostItemModalHandler);
    cancelPostItem.addEventListener('click', closePostItemModalHandler);
    postItemModal.addEventListener('click', (e) => {
      if (e.target === postItemModal) {
        closePostItemModalHandler();
      }
    });

    // Post item form
    postItemForm.addEventListener('submit', submitItemForm);

    // Image upload (Click handler for the 'Add Image' box)
    addImageBox.addEventListener('click', () => {
      itemImagesInput.click();
    });
    itemImagesInput.addEventListener('change', handleImageUpload);

    // Search
    searchInput.addEventListener('input', handleSearch);
    
    // Review form submission
    addReviewForm.addEventListener('submit', submitReview);
    
    // Rating star clicks
    ratingStars.querySelectorAll('i').forEach(star => {
        star.addEventListener('click', (e) => {
            const rating = parseInt(e.currentTarget.dataset.rating);
            reviewRatingInput.value = rating;
            ratingStars.querySelectorAll('i').forEach(s => {
                s.classList.toggle('rated', parseInt(s.dataset.rating) <= rating);
            });
        });
    });
  }

  // Apply filters
  function applyFiltersHandler() {
    const category = document.getElementById('categoryFilter').value;
    const location = document.getElementById('locationFilter').value.toLowerCase();
    const minPrice = document.getElementById('minPrice').value;
    const maxPrice = document.getElementById('maxPrice').value;
    const condition = document.getElementById('conditionFilter').value;
    
    filteredItems = items.filter(item => {
      // Category filter
      if (category && item.category !== category) return false;
      
      // Location filter
      if (location && !item.location.toLowerCase().includes(location)) return false;
      
      // Price filter
      if (minPrice && item.price < parseFloat(minPrice)) return false;
      if (maxPrice && item.price > parseFloat(maxPrice)) return false;
      
      // Condition filter
      if (condition && item.condition !== condition) return false;
      
      return true;
    });
    
    renderItems();
    meetraderFilters.style.display = 'none';
  }

  // Open post item modal
  function openPostItemModal() {
    postItemModal.style.display = 'flex';
  }

  // Close post item modal
  function closePostItemModalHandler() {
    postItemModal.style.display = 'none';
    postItemForm.reset();
    itemImagesInput.value = ''; // Clear file input
    uploadedImageFiles = []; // Clear state
    renderUploadedImages(); // Clear previews
    // Reset checkboxes
    document.querySelectorAll('#postItemForm input[type="checkbox"]').forEach(cb => {
        cb.checked = (cb.id === 'payAtDelivery' || cb.id === 'buyerPickup');
    });
  }

  // Render uploaded images in the modal
  function renderUploadedImages() {
      // Clear all existing previews (but keep the 'Add Image' box)
      document.querySelectorAll('.image-upload-box:not(.add-image-box)').forEach(box => box.remove());

      // Append previews before the 'Add Image' box
      uploadedImageFiles.forEach((base64String, index) => {
          const box = document.createElement('div');
          box.className = 'image-upload-box';
          box.dataset.index = index;
          box.innerHTML = `
              <img src="${base64String}" alt="Image ${index + 1}" class="image-preview-thumb">
              <button type="button" class="remove-image-btn" data-index="${index}"><i class="fas fa-times"></i></button>
          `;
          imageUploadGrid.insertBefore(box, addImageBox);
      });
      
      // Handle visibility of the 'Add Image' box
      if (uploadedImageFiles.length >= MAX_IMAGES) {
          addImageBox.style.display = 'none';
      } else {
          addImageBox.style.display = 'flex';
      }
      
      // Attach remove button listeners
      document.querySelectorAll('.remove-image-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
              const indexToRemove = parseInt(e.currentTarget.dataset.index);
              uploadedImageFiles.splice(indexToRemove, 1); // Remove from array
              itemImagesInput.value = ''; // Clear actual file input (prevents re-uploading removed file)
              renderUploadedImages(); // Re-render the grid
          });
      });
  }

  // Handle image upload
  async function handleImageUpload(e) {
    const files = Array.from(e.target.files);
    
    // Filter and process files
    for (const file of files) {
        if (uploadedImageFiles.length >= MAX_IMAGES) {
            showMessage(`Maximum of ${MAX_IMAGES} images reached.`);
            break;
        }

        if (file.size > MAX_FILE_SIZE) {
            showMessage(`File "${file.name}" size too large. Max is 5MB.`);
            continue;
        }
        
        if (!file.type.startsWith('image/')) {
            showMessage(`File "${file.name}" is not a valid image.`);
            continue;
        }
        
        try {
            const base64String = await fileToBase64(file);
            uploadedImageFiles.push(base64String);
        } catch (error) {
            console.error('Error converting file to base64:', error);
            showMessage(`Failed to process image "${file.name}".`);
        }
    }
    
    // Clear file input to allow uploading the same file again if needed
    e.target.value = ''; 
    renderUploadedImages();
  }


  // Submit item form
  async function submitItemForm(e) {
    e.preventDefault();
    
    // Get form values
    const title = document.getElementById('itemTitle').value.trim();
    const description = document.getElementById('itemDescription').value.trim();
    const price = document.getElementById('itemPrice').value;
    const currency = document.getElementById('itemCurrency').value;
    const location = document.getElementById('itemLocation').value.trim();
    const category = document.getElementById('itemCategory').value;
    const condition = document.getElementById('itemCondition').value;
    
    // Get checkbox values
    const paymentMeans = Array.from(document.querySelectorAll('input[name="paymentMeans"]:checked')).map(cb => cb.value);
    const deliveryOptions = Array.from(document.querySelectorAll('input[name="deliveryMeans"]:checked')).map(cb => cb.value);
    
    // Validate form
    if (!title || !price || !location || !category || !description) {
      showMessage('Please fill in all required fields.');
      return;
    }
    
    if (parseFloat(price) <= 0) {
      showMessage('Please enter a valid price.');
      return;
    }
    
    if (paymentMeans.length === 0 || deliveryOptions.length === 0) {
        showMessage('Please select at least one payment mean and one delivery option.');
        return;
    }

    if (uploadedImageFiles.length === 0) {
        showMessage('Please upload at least one image for your item.');
        return;
    }
    
    // Show loading state
    const submitBtn = postItemForm.querySelector('.submit-btn');
    const originalText = submitBtn.textContent;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Posting...';
    submitBtn.disabled = true;
    
    try {
      // Create item data
      const itemData = {
        title,
        price: parseFloat(price),
        currency,
        location,
        description,
        category,
        condition,
        images: uploadedImageFiles, // Array of base64 strings
        paymentMeans,
        deliveryOptions
      };
      
      // Create the item in Firebase
      await createItem(itemData);
      
      // Success
      showMessage('Item posted successfully
