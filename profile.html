<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cloudinary Upload</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { margin: 5px 0; }
    video { max-width: 400px; margin-top: 10px; display: block; }
  </style>
</head>
<body>
  <h1>Upload Video to Cloudinary</h1>

  <input type="file" id="fileInput" accept="video/*,image/*" />
  <button id="uploadBtn">Upload</button>

  <h3>Preview:</h3>
  <video id="preview" controls></video>

  <h3>Uploaded URL:</h3>
  <a id="uploadedUrl" href="#" target="_blank"></a>

  <script>
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");
    const preview = document.getElementById("preview");
    const uploadedUrl = document.getElementById("uploadedUrl");

    let file;

    // Show file preview
    fileInput.addEventListener("change", (e) => {
      file = e.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      preview.src = url;
    });

    uploadBtn.addEventListener("click", async () => {
      if (!file) {
        alert("Please select a file first!");
        return;
      }

      try {
        // Step 1: Get signature from your backend
        const sigRes = await fetch("https://super-robot-4jwqjpv5j76pc479-5000.app.github.dev/signature");
        const sigData = await sigRes.json();

        // Step 2: Prepare form data for Cloudinary
        const formData = new FormData();
        formData.append("file", file);
        formData.append("api_key", "767477973776429"); // your Cloudinary API key
        formData.append("timestamp", sigData.timestamp);
        formData.append("signature", sigData.signature);

        // Step 3: Upload to Cloudinary
        const cloudName = "dcwof2ngn";
        const uploadRes = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/auto/upload`, {
          method: "POST",
          body: formData
        });

        const uploadData = await uploadRes.json();

        if (uploadData.secure_url) {
          uploadedUrl.href = uploadData.secure_url;
          uploadedUrl.textContent = uploadData.secure_url;
          alert("Upload successful!");
        } else {
          console.error(uploadData);
          alert("Upload failed. Check console.");
        }
      } catch (err) {
        console.error(err);
        alert("Error uploading file.");
      }
    });
  </script>
</body>
</html>
